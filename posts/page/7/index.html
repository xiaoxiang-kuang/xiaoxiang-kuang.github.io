<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/c%E8%AF%AD%E8%A8%80/C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">C语言基础</a>
    </h2>
    
  <h5>2021-09-26</h5>



  

  
  <div>
    
      <a href="/tags/c%E8%AF%AD%E8%A8%80/">c语言</a>
  </div>
  




    <p><h2 id="变量和初始化">
  变量和初始化
  <a class="anchor" href="#%e5%8f%98%e9%87%8f%e5%92%8c%e5%88%9d%e5%a7%8b%e5%8c%96">#</a>
</h2>
<h3 id="外部变量">
  外部变量
  <a class="anchor" href="#%e5%a4%96%e9%83%a8%e5%8f%98%e9%87%8f">#</a>
</h3>
<ul>
<li>外部变量和函数具有如下性质：通过同一个名字引用的所有外部变量实际上都是引用同一个对象。</li>
<li>如果外部变量的定义和变量的使用不在同一个文件中，需要在相应的变量声明中强制性的使用关键字extern。</li>
<li>变量的声明用于说明变量的属性(主要是变量的类型)，而变量的定义除此外还将引起存储器的分配。以下语句如果放在所有函数的外部，那么这两条语句将定义外部变量sp和val，并为其分配存储单元。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> sp;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//声明外部变量必须指定数组长度。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">double</span> val[<span style="color:#ae81ff">100</span>];
</span></span></code></pre></div><ul>
<li>下面这两行声明了两个外部变量，并没有建立变量或分配存储空间。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">int</span> sp;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">double</span> val[];
</span></span></code></pre></div><h3 id="静态变量">
  静态变量
  <a class="anchor" href="#%e9%9d%99%e6%80%81%e5%8f%98%e9%87%8f">#</a>
</h3>
<ul>
<li>用static声明限定<code>外部变量和函数</code>，可以将其声明后的对象的作用域限定为被编译源文件的剩余部分，通过static限定外部对象，可以<code>隐藏外部对象</code>。</li>
<li>通常情况下，函数名是全局可访问的，对于整个程序各个部分而言都可见。但如果将函数声明为static类型，则该函数除了对该函数声明所在的文件可见外，其他文件都无法访问。</li>
<li>static也可用于声明内部变量，但是不管函数是否被调用，它一直存在。static类型的内部变量是一种只能在某个特定函数中使用但是一直占用存储空间的变量。</li>
</ul>
<h3 id="初始化">
  初始化
  <a class="anchor" href="#%e5%88%9d%e5%a7%8b%e5%8c%96">#</a>
</h3>
<ul>
<li>在不进行显式初始化的情况下，<code>外部变量和静态变量都将被初始化为0</code>，而内部变量和寄存器变量的初值则没有定义。</li>
<li>对于外部变量和静态变量来说，初始化变量表达式必须是常量表达式，且只初始化一次。</li>
<li>数组的初始化实在声明后紧跟一个初始化列表。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//当省略数组的长度时，编译器将把花括号中的长度作为数组的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> days[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">31</span>,<span style="color:#ae81ff">30</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//字符数组的初始化方式如下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> pattern[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;oule&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//等价于
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> pattern <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;u&#39;</span>, <span style="color:#e6db74">&#39;l&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;\0&#39;</span>};
</span></span></code></pre></div><h3 id="运算">
  运算
  <a class="anchor" href="#%e8%bf%90%e7%ae%97">#</a>
</h3>
<ul>
<li>计算char类型或short类型时，会将其转化为int类型来计算。</li>
</ul>
<h2 id="预处理器">
  预处理器
  <a class="anchor" href="#%e9%a2%84%e5%a4%84%e7%90%86%e5%99%a8">#</a>
</h2>
<ul>
<li><code>#include</code>将指定文件的内容包含到当前文件中。</li>
<li><code>#define 名字 替换文本</code>将<code>名字</code>替换为<code>替换文本</code>。</li>
<li><code>sizeof</code>可以用来计算任一对象的长度，如<code>sizeof(int)</code>。</li>
<li>条件包括</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#if SYSTEM == SYSV
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#define HDR &#34;sysv.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#elif SYSTEM == BSD
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#define HDR &#34;bsd.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#define HDR &#34;default.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">HDR</span><span style="color:#75715e">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#ifdef HDR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;DEF HDR&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span></code></pre></div><h2 id="指针与数组">
  指针与数组
  <a class="anchor" href="#%e6%8c%87%e9%92%88%e4%b8%8e%e6%95%b0%e7%bb%84">#</a>
</h2>
<ul>
<li><code>&amp;</code>表示取一个对象的地址</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//把c的地址给p
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>p <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>c 
</span></span></code></pre></div><ul>
<li><code>*</code>作用于指针时，将访问指针所指向的对象。</li>
<li>指针只能指向某种特定类型的对象（void*除外）。</li>
<li>通过数组下表能实现的操作都可以通过指针来实现。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">19</span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">//将指针pa指向数组的第0个元素，pa的值为a[0]的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//等价于pa = a;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>pa <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>a[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">//*pa 和 a[0] 的含义是相同的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> x1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>pa;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;x1 的值为 %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, x1);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//&amp;a[1] 和 a + 1 的含义是相同的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> x2 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;x2 的值为 %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, x2);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//pa[2] 和 *pa[2] 的含义是相同的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> x3 <span style="color:#f92672">=</span> pa[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;x3 的值为 %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, x3);
</span></span></code></pre></div><ul>
<li>
<p>数组和指针的不同点</p>
<ul>
<li>指针是一个变量，所以<code>pa = a</code>和<code>pa++</code>都是合法的。</li>
<li>数组名不是变量，<code>a = pa</code>和<code>a++</code>非法。</li>
</ul>
</li>
<li>
<p>在函数的定义中，以下两种形参是等价的：</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>s;
</span></span></code></pre></div><ul>
<li>可以将数组的一部分传递给函数：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//将起始于a[2]的子数组的地址传递给函数f
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">f</span>(<span style="color:#f92672">&amp;</span>a[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//或
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">f</span>(a <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>);
</span></span></code></pre></div><h2 id="字符指针">
  字符指针
  <a class="anchor" href="#%e5%ad%97%e7%ac%a6%e6%8c%87%e9%92%88">#</a>
</h2>
<ul>
<li>
<p>字符串常量是一个字符数组，在字符串的内部表示中，字符数组以空字符<code>\0</code>结尾。</p>
</li>
<li>
<p>下面两个定义之间有很大的差别：</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//定义了一个指针，指向了一个字符串常量，不能修改字符串的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pmessage <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;now is the time&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//定义了一个数组，数组中的单个字符可以修改
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> a[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;now is the time&#34;</span>;
</span></span></code></pre></div><h2 id="二维数组和指针数组">
  二维数组和指针数组
  <a class="anchor" href="#%e4%ba%8c%e7%bb%b4%e6%95%b0%e7%bb%84%e5%92%8c%e6%8c%87%e9%92%88%e6%95%b0%e7%bb%84">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//真正的二维数组，分配了200个int类型长度的存储空间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> a[<span style="color:#ae81ff">10</span>][<span style="color:#ae81ff">20</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">//仅分配了10个指针，并没有对指针进行初始化，需要显式的进行初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//b的每个元素都是int *类型的指针，b并非是二维数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//例：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>b[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>x1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x2[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">22</span>};
</span></span><span style="display:flex;"><span>b[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> x2;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//相当于是一维数组，数组中的每个元素是字符串指针
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name[] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;illegal month&#34;</span>, <span style="color:#e6db74">&#34;jan&#34;</span>, <span style="color:#e6db74">&#34;feb&#34;</span>, <span style="color:#e6db74">&#34;mar&#34;</span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">//二维数组，数组中的每个元素的长度是15，不够补充\0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> aname[][<span style="color:#ae81ff">15</span>] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;illegal month&#34;</span>, <span style="color:#e6db74">&#34;jan&#34;</span>, <span style="color:#e6db74">&#34;feb&#34;</span>, <span style="color:#e6db74">&#34;mar&#34;</span>};
</span></span></code></pre></div><h2 id="结构">
  结构
  <a class="anchor" href="#%e7%bb%93%e6%9e%84">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//声明方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> point {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> y;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print1</span>(<span style="color:#66d9ef">struct</span> point <span style="color:#f92672">*</span>pt);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> point pt;
</span></span><span style="display:flex;"><span>    pt.x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    pt.y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print1</span>(<span style="color:#f92672">&amp;</span>pt);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print1</span>(<span style="color:#66d9ef">struct</span> point <span style="color:#f92672">*</span>pt)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//pt-&gt;x 等价于 (*pt).x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;x is %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">y is %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, pt<span style="color:#f92672">-&gt;</span>x, pt<span style="color:#f92672">-&gt;</span>y);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="类型定义typedef">
  类型定义typedef
  <a class="anchor" href="#%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89typedef">#</a>
</h2>
<ul>
<li>typedef用来建立新的数据类型名。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//类型定义
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">int</span> Length;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//声明变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Length len, maxlen;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> point {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> y;
</span></span><span style="display:flex;"><span>} Pointx;
</span></span><span style="display:flex;"><span>Pointx px;
</span></span></code></pre></div><h2 id="union">
  union
  <a class="anchor" href="#union">#</a>
</h2>
<ul>
<li>一个变量可以合法的保存多种数据类型中的任何一种类型的对象。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">union</span> u_tag {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ival;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> fval;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>swal;
</span></span><span style="display:flex;"><span>}u;
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/linux/ubuntu/">ubuntu</a>
    </h2>
    
  <h5>2021-09-25</h5>



  

  
  <div>
    
      <a href="/tags/linux/">linux</a>
  </div>
  




    <p><p><strong>记录使用ubuntu的一些发现</strong></p>
<ul>
<li>
<p><del>提升体验的一个软件<code>apt install gnome-shell-extension-dash-to-panel;apt remove gnome-shell-extension-ubuntu-dock</code>重启之后在gnome-tweaks中打开该扩展即可。它类似于windows的状态栏，比之前ubuntu自带的收藏栏和状态栏分开的情况好多了，而且可定制的程度高</del>。 此种方式下载的已经过时，在ubuntu20上会有bug，最新版本可以通过
  <a href="https://extensions.gnome.org/">GNOME Shell Extensions</a>下载，该网站需要安装浏览器扩展插件、本地主机安装chrome-gnome-shell，安装完后和直接在该网站下载Dash to Panel即可。<strong>参考链接：</strong>
  <a href="https://github.com/home-sweet-gnome/dash-to-panel/wiki/Installation#ubuntu">Installation · home-sweet-gnome/dash-to-panel Wiki · GitHub</a></p>
</li>
<li>
<p><code>neofetch</code> 命令行显示系统信息、logo。</p>
</li>
<li>
<p><code>ctrl + d</code> 文件夹添加到左边栏</p>
</li>
<li>
<p><code>gnome-screenshot --interactive --area</code> 截图</p>
</li>
<li>
<p><code>sudo apt install papirus-icon-theme</code> 好看的图标</p>
</li>
<li>
<p>创建一个桌面应用图标：</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#/usr/share/applications目录下</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Desktop Entry<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Name<span style="color:#f92672">=</span>Typora
</span></span><span style="display:flex;"><span>Exec<span style="color:#f92672">=</span>/opt/Typora-linux-x64/Typora %f
</span></span><span style="display:flex;"><span>Icon<span style="color:#f92672">=</span>/opt/Typora-linux-x64/resources/assets/icon/icon_256x256.png
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>Application
</span></span></code></pre></div><p>
  <a href="https://specifications.freedesktop.org/desktop-entry-spec/1.1/ar01s06.html">The Exec key</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/linux/linux%E5%BC%80%E6%9C%BA/">linux开机</a>
    </h2>
    
  <h5>2021-09-24</h5>



  

  
  <div>
    
      <a href="/tags/linux/">linux</a>
  </div>
  




    <p><h3 id="流程如下">
  流程如下
  <a class="anchor" href="#%e6%b5%81%e7%a8%8b%e5%a6%82%e4%b8%8b">#</a>
</h3>
<ol>
<li>加载BIOS的硬件信息、进行自我测试，根据设定取得第一个可开机的装置；</li>
<li>读取并执行第一个开机装置内的MBR的bootloader（如grub2）；</li>
<li>依据bootloader的设定载入kernel，kernel会开始侦测硬件和载入驱动程序；</li>
<li>在硬件驱动成功后，kernel会主动呼叫systemd程序，并以default.target流程开机；
<ol>
<li>systemd执行sysinit.target初始化系统及basic.target准备操作系统；</li>
<li>systemd启动multi-user.target下的服务；</li>
<li>systemd执行multi-user.target下的/etc/rc.d/rc.local文件；</li>
<li>systemd执行multi-user.target下的getty.target及登入服务；</li>
<li>systed执行graphical需要的服务。</li>
</ol>
</li>
</ol>
<h3 id="biosuefimbrgptbootloader">
  BIOS（UEFI）、MBR（GPT）、bootloader
  <a class="anchor" href="#biosuefimbrgptbootloader">#</a>
</h3>
<ul>
<li>BIOS（固件）是开机的时候，计算机系统会主动执行的第一个程序。通过BIOS去加载CMOS的信息，通过CMOS内的设置取得主机的各项硬件设置。例：CPU与周边设备的沟通时钟、开机设备的搜寻顺序、硬盘的大小和类型等，取得这些信息后，BIOS还会进行开机自测试（Power-on Self Test），然后开始执行硬件侦测的初始化，并设定PnP设备。之后再定义出可开机设备顺序，接下来就会开始进行开机设备的读取了。BIOS通过硬件的INT13中断功能来读取MBR，只要BIOS能检测到硬盘，就能通过INT13来读取磁盘的第一个磁区内的MBR软件。</li>
<li>UEFI（Unified Extension Firmware Interface）是取代BIOS的。</li>
<li>整颗磁盘的第一个扇区特别重要，它记录了整颗磁盘的重要信息，早期磁盘的第一个扇区的包含重要的分区格式MBR（master boot record），后来多了一个新的磁盘分区格式，称为GPT（guid partition table）。</li>
<li>MBR可以安装开机管理程序，其和分区表通常放在磁盘的第一个扇区，这个扇区通常是512字节。开机管理程序占446字节，分区表占64字节。分区表最多只能有四组记录。</li>
<li>GPT将磁盘的所有区块以LBA（logical block address，预设为512字节）来规划，GPT使用34个LBA区块来记录分区信息，整个磁盘的最后33个LBA拿来作为备份。</li>
<li>boot loader的功能：①提供菜单；②装入核心文件；③转交其他loader。每个文件系统都会保留一块开机扇区提供操作系统安装bootloader，通常操作系统会安装一份boot loader到他自己的文件系统中。</li>
</ul>
<p>
  <img src="/img/linux/linux%e5%9f%ba%e7%a1%80%e8%ae%be%e5%ae%9a/1.png" alt="" /></p>
<ul>
<li>
<p>当boot loader开始读取内核文件后，linux会将核心解压到内存中，并使用核心的功能，开始测试cpu、网卡、声卡等装置，此时linux核心会以自己的功能重新侦测一次硬件。一般来说，核心文件被放在/boot中，并取名为/boot/vmlinuz。linux核心可以动态加载模块，这些核心模块放在/lib/modules目录中，开机过程中根目录采用只读方式挂载。虚拟文件系统（Initial RAM Filesystem）一般使用的文件名为/boot/initrd或/boot/initramfs。</p>
</li>
<li>
<p>linux预设情况下会提供6个终端让使用者登陆，切换方式为[ctrl]+[alt]+[f1]~[f6]，6个终端命名为tty1～tty6。在centos7中，开机后系统只会提供一个tty，其他的是不存在的，当要切换时，系统才产生额外的tty2，tty3&hellip;。</p>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/linux/make/">make</a>
    </h2>
    
  <h5>2021-09-16</h5>



  

  
  <div>
    
      <a href="/tags/linux/">linux</a>
  </div>
  




    <p><ul>
<li>当执行make时，make会在当时的目录下搜索Makefile（makefile）文件，而makefile里面则记录了原始码如何编译的详细信息，make按照makefile去编译这些文件。当在编译完成之后，修改了某个源码文件，执行make时，make只会针对被修改的文件进行编译。通常软件开发商会写一支侦测程序来侦测使用者的作业环境，以及该作业环境是否有软件开发商所需要的其他功能，在侦测程序侦测完毕后，会主动建立Makefile，通常这个检查程序的文件名为configure或config。</li>
<li>tarball就是将软件的所有原始码文件先以tar打包，然后再压缩。tarball文件通常包括：源代码文件；侦测程序文件（configure或config）；本软件的简易说明和安装说明（INSTALL或README）。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#-lm表示的是使用libm.so这个库，这个命令可以拆成两部分来看：l表示加入到某个函数库，m表示使用libm.so这个库，lib和扩展名.so或.a不需要写。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-L/lib表示在这个路径下寻找库。</span>
</span></span><span style="display:flex;"><span>gcc test.c -lm -L/lib -L/lib64
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-I后面跟的路径就是设置要去搜索的include文件（如c语言的头文件）的目录。</span>
</span></span><span style="display:flex;"><span>gcc test.c -lm -I/usr/include
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将源码编译为目标文件，不链接</span>
</span></span><span style="display:flex;"><span>gcc -c hello.c
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-o将编译的结果输出为特定的文件，-Wall会输出经过信息。</span>
</span></span><span style="display:flex;"><span>gcc -o hello hello.c -Wall
</span></span></code></pre></div><h4 id="makefile文件规则">
  makefile文件规则
  <a class="anchor" href="#makefile%e6%96%87%e4%bb%b6%e8%a7%84%e5%88%99">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e">#变量左右可以有空格，变量左边不能有tab键；变量和变量内容在等号两边不能有&#34;:&#34;。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#变量习惯以大写字母为主。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#使用${xxx}或者$(xxx)来使用变量。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>LIBS <span style="color:#f92672">=</span> -lm
</span></span><span style="display:flex;"><span>OBJS <span style="color:#f92672">=</span> hello.o test.o
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">main</span><span style="color:#f92672">:</span>${OBJS}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#tab必须是命令的第一个字符</span>
</span></span><span style="display:flex;"><span>	GCC -O MAIN <span style="color:#e6db74">${</span>OBJS<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>LIBS<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	rm -rf main <span style="color:#e6db74">${</span>OBJS<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e">#通过make clean来执行命令
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#$@表示当前的目标，如这里的clean或main
</span></span></span></code></pre></div><ul>
<li>
<p>一般情况下，安装的基本步骤是：①./configure；②make clean；③make；④make install。</p>
</li>
<li>
<p>通常会将自己安装的软件放到/usr/local下，将源代码放到/usr/local/src下。</p>
</li>
</ul>
<p>
  <a href="http://linux.vbird.org/linux_basic/0520source_code_and_tarball.php#intro_make">鸟哥的 Linux 私房菜 &ndash; 第二十一章、软件安装：源代码与 Tarball (vbird.org)</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/nginx/nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">nginx负载均衡</a>
    </h2>
    
  <h5>2021-09-13</h5>



  

  
  <div>
    
      <a href="/tags/nginx/">nginx</a>
  </div>
  




    <p><p>nginx支持三种负载均衡的方法：</p>
<ol>
<li>轮询（round-robin）：按照顺序分配服务。</li>
<li>least-connected：下一个请求被分配给连接数最少的服务。</li>
<li>ip-hash：通过一个哈希算法来决定一个ip地址访问哪个后台服务，能保证一个ip一定会访问一个相同的后台服务（除非后台服务不可访问）。这种方式解决的问题是：如果某个ip已经登录了某个服务，当用户再次访问时会定位到该服务，解决了会话丢失的问题。</li>
</ol>
<h3 id="轮询算法默认情况">
  轮询算法（默认情况）
  <a class="anchor" href="#%e8%bd%ae%e8%af%a2%e7%ae%97%e6%b3%95%e9%bb%98%e8%ae%a4%e6%83%85%e5%86%b5">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">upstream</span> <span style="color:#e6db74">myapp1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example1.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example2.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example3.com</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://myapp1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="使用least_conn命令的least-connected算法">
  使用least_conn命令的least-connected算法。
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8least_conn%e5%91%bd%e4%bb%a4%e7%9a%84least-connected%e7%ae%97%e6%b3%95">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span>    <span style="color:#66d9ef">upstream</span> <span style="color:#e6db74">myapp1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">least_conn</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example1.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example2.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example3.com</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="使用ip_hash命令的ip-hash算法">
  使用ip_hash命令的ip-hash算法。
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8ip_hash%e5%91%bd%e4%bb%a4%e7%9a%84ip-hash%e7%ae%97%e6%b3%95">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span>    <span style="color:#66d9ef">upstream</span> <span style="color:#e6db74">myapp1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ip_hash</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example1.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example2.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">example3.com</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="权重">
  权重
  <a class="anchor" href="#%e6%9d%83%e9%87%8d">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">upstream</span> <span style="color:#e6db74">myapp1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">srv1.example.com</span> <span style="color:#e6db74">weight=3</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">srv2.example.com</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span> <span style="color:#e6db74">srv3.example.com</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="http://nginx.org/en/docs/http/load_balancing.html">Using nginx as HTTP load balancer</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">shell脚本</a>
    </h2>
    
  <h5>2021-09-09</h5>



  

  
  <div>
    
      <a href="/tags/linux/">linux</a>
  </div>
  




    <p><ul>
<li>
<p>用户可以透过应用程序来指挥kernel，让kernel来完成我们所需要的硬件任务，因为程序是在最外层，类似鸡蛋的外壳一样，所以就叫壳程序（shell）。shell是提供用户操作系统的一个接口。</p>
</li>
<li>
<p>bash全称就是Bourne Again SHell，是linux预设的shell。</p>
</li>
<li>
<p>系统中合法的shell都会写入到/etc/shells这个文件。当用户登录的时候，系统会提供一个shell，这个shell就记录在/etc/passwd这个文件中。</p>
</li>
<li>
<p>bash有很多内建指令，如cd等，可以通过type这个指令观察。</p>
</li>
<li>
<p>一行输不完，可以通过\来换行。</p>
</li>
<li>
<p>shell脚本中第一行的<code>#!/bin/bash</code>宣告这个script使用的是bash的语法。</p>
</li>
<li>
<p>当使用bash（sh）或者./xxx.sh来下达指令时，是在子程序中执行的；通过source来执行脚本时，是在父程序中执行的。子程序：在当前shell的情况下，去启动另一个新的shell，新的shell就是子程序。子程序会继承父进程的环境变量，但不会继承父进程的自定义变量。</p>
</li>
<li>
<p>login shell是取得bash时需要输入完整的登录账号密码的就是login shell。</p>
</li>
<li>
<p>non-login shell就是取得bash接口不需要重复的登入。如从图形化界面进入linux后，开启每个bash都不需要再次输入用户名和密码。这就是non-login shell。</p>
</li>
<li>
<p>login shell会读取<code>/etc/profile</code>（系统整体的设定，每个使用者登入取得bash时一定会读取的配置文件。）和<code>~/.bash_profile或~/.bash_login或~/.profile</code>（个人的设定）的文件。</p>
</li>
<li>
<p>non-login shell会读取~/.bashrc、/etc/bashrc、/etc/profile.d（不同的linux会有些不同）。</p>
</li>
<li>
<p>source可以立即读入配置文件的内容。</p>
</li>
</ul>
<h2 id="变量定义">
  变量定义
  <a class="anchor" href="#%e5%8f%98%e9%87%8f%e5%ae%9a%e4%b9%89">#</a>
</h2>
<ul>
<li>环境变量如PATH等，通常使用大写字符来表示，当输入了一个命令ls，系统会通过PATH这个遍历里面的内容记录的路径来顺序搜索指令。</li>
<li>变量在使用时，需要加上在前面加上<code>$</code>。如<code>$PATH,${PATH}</code>。</li>
<li>通过<code>env</code>和<code>export</code>可以查询系统中所有的环境变量。</li>
</ul>
<h3 id="变量">
  变量
  <a class="anchor" href="#%e5%8f%98%e9%87%8f">#</a>
</h3>
<ol>
<li>设定变量直接使用等号=，如<code>myname=xiaoxiang</code>，等号两边不能有空格；</li>
<li>变量内容若有空格可以使用单引号或者双引号括起来，但是双引号内的特殊符号如<code>$</code>会保持原本的特性，而单引号内的特殊字符则是<strong>纯文字</strong>。</li>
<li>当需要为变量扩增内容内容时，可以使用<code>PATH=$PATH:/home/bin</code></li>
<li>通过<code>export JAVA_HOME</code>使得变量JAVA_HOME变成了环境变量。</li>
<li>通常大写字符为系统默认变量，自行设定的变量可以使用小写字符。</li>
<li>取消变量可以使用<code>unset myname</code>。</li>
</ol>
<h3 id="readarraydeclare">
  read，array，declare
  <a class="anchor" href="#readarraydeclare">#</a>
</h3>
<ul>
<li>read可以读取键盘输入的变量。如<code>read -p &quot;please input:&quot; -t 10 name </code>。其中-p是提示信息，-t是倒计时，系统不会一直等待输入，name就是变量，会将输入的信息给这个变量。</li>
<li>declare、typeset是宣告变量的类型（shell默认类型是字符串）。<code>declare</code>命令如果用在函数中，声明的变量只在函数内部有效，等同于<code>local</code>命令。
<ul>
<li><code>declare -a var</code>将var声明为数组类型array。</li>
<li><code>declare -i var</code>将var声明为整数类型integer（bash中的数值计算最多只能达到整数形态）。</li>
<li><code>declare -x var</code>将var声明为环境变量。</li>
<li><code>declare -r var</code>将变量声明为只读类型readonly，改变量不可更改，不能unset。</li>
<li><code>declare -p var</code>查看变量的类型。</li>
</ul>
</li>
</ul>
<h3 id="数组">
  数组
  <a class="anchor" href="#%e6%95%b0%e7%bb%84">#</a>
</h3>
<ul>
<li>数组可以采用逐个赋值的方法创建。也可以一次性赋值。</li>
</ul>
<pre tabindex="0"><code>ARRAY[INDEX]=value
ARRAY=(value1 value2 ... valueN)
</code></pre><ul>
<li>读取元素</li>
</ul>
<pre tabindex="0"><code>#输出单个元素，${}是必须的
echo ${array[0]}
#输出所有元素
echo ${foo[@]}
#循环遍历所有元素，数据要放在双引号中
for i in &#34;${names[@]}&#34;; do
  echo $i
done

#数组赋值
hobbies=( &#34;${activities[@]}&#34; )
#获取数组长度
echo ${#a[@]}
</code></pre><h2 id="通配符与特殊符号">
  通配符与特殊符号
  <a class="anchor" href="#%e9%80%9a%e9%85%8d%e7%ac%a6%e4%b8%8e%e7%89%b9%e6%ae%8a%e7%ac%a6%e5%8f%b7">#</a>
</h2>
<table>
<thead>
<tr>
<th>符号</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>代表0到无穷多个任意字符</td>
</tr>
<tr>
<td>？</td>
<td>代表一定有一个的任意字符</td>
</tr>
<tr>
<td>[]</td>
<td>代表一定有一个在括号内的字符</td>
</tr>
<tr>
<td>[-]</td>
<td>表示一定有一个在编码顺序内的所有字符，如[0-9]表示一定有一个数字</td>
</tr>
<tr>
<td>[^]</td>
<td>表示反向选择，如[^abc]就表示一定有一个字符，但不是abc中的一个。</td>
</tr>
</tbody>
</table>
<h2 id="变量内容的删除与取代">
  变量内容的删除与取代
  <a class="anchor" href="#%e5%8f%98%e9%87%8f%e5%86%85%e5%ae%b9%e7%9a%84%e5%88%a0%e9%99%a4%e4%b8%8e%e5%8f%96%e4%bb%a3">#</a>
</h2>
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>#</td>
<td>从最左边开始，删除匹配最短的那个</td>
</tr>
<tr>
<td>##</td>
<td>从最左边开始，删除匹配最长的那个</td>
</tr>
<tr>
<td>%</td>
<td>从最右边开始，删除匹配最短的那个</td>
</tr>
<tr>
<td>%%</td>
<td>从最右边开始，删除匹配最长的那个</td>
</tr>
<tr>
<td>/旧字符串/新字符串</td>
<td>若变量内容符合旧字符串，则第一个旧字符串会被新字符串取代</td>
</tr>
<tr>
<td>//旧字符串/新字符串</td>
<td>若变量内容符合旧字符串，则全部旧字符串会被新字符串取代</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#例:</span>
</span></span><span style="display:flex;"><span>path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#去掉了开始的/usr/local/sbin:</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path#/*:<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#输出为空</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path##/*:<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#去掉了末尾的/bin:</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path%/*:<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#输出为空</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path%%/*:<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将第一个出现的usr替换为USR</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path/usr/USR<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将所有的sbin替换为SBIN</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">${</span>path//sbin/SBIN<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h3 id="tr删除字符串中的一段文字或者进行文字的替换">
  tr：删除字符串中的一段文字，或者进行文字的替换。
  <a class="anchor" href="#tr%e5%88%a0%e9%99%a4%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%b8%ad%e7%9a%84%e4%b8%80%e6%ae%b5%e6%96%87%e5%ad%97%e6%88%96%e8%80%85%e8%bf%9b%e8%a1%8c%e6%96%87%e5%ad%97%e7%9a%84%e6%9b%bf%e6%8d%a2">#</a>
</h3>
<ul>
<li><code>cat example.txt | tr [a-z] [A-Z]</code>将输出的文件中的所有小写字符变成大写字符。</li>
<li><code>cat /etc/passwd | tr -d ':'</code>删除输出文件中的所有冒号:</li>
</ul>
<h3 id="变量的测试与内容替换">
  变量的测试与内容替换
  <a class="anchor" href="#%e5%8f%98%e9%87%8f%e7%9a%84%e6%b5%8b%e8%af%95%e4%b8%8e%e5%86%85%e5%ae%b9%e6%9b%bf%e6%8d%a2">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#减号-：当str不存在的时候，str=root，而当str存在（为空也视为存在）则str=$str</span>
</span></span><span style="display:flex;"><span>str<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>username-root<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#:- 当str为空或不存在，str=root；str不为空则str=$str</span>
</span></span><span style="display:flex;"><span>str<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>str<span style="color:#66d9ef">:-</span>root<span style="color:#e6db74">}</span>
</span></span></code></pre></div><h3 id="cut将一段数据切出来">
  cut：将一段数据切出来
  <a class="anchor" href="#cut%e5%b0%86%e4%b8%80%e6%ae%b5%e6%95%b0%e6%8d%ae%e5%88%87%e5%87%ba%e6%9d%a5">#</a>
</h3>
<ul>
<li><code> cat filename |cut -d '分隔字符'  -f num</code>：-d后面跟分隔字符，将数据分为几段，-f表示取出第几段。</li>
<li><code>cat filename  |cut -c 12-</code>：-c表示每一行都获取从第12个字符后面的所有字符（注意12后面有个减号）。</li>
</ul>
<h2 id="命令执行的判断依据-----">
  命令执行的判断依据 ;  &amp;&amp;  ||
  <a class="anchor" href="#%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e7%9a%84%e5%88%a4%e6%96%ad%e4%be%9d%e6%8d%ae-----">#</a>
</h2>
<ul>
<li>命令之间用<code>;</code>隔开，分号前的指令执行完后会立刻接着执行后面的指令。</li>
<li>命令之间用<code>&amp;&amp;</code>连接，表示当上一个指令<strong>正确</strong>执行完成后，才会接着执行下一个命令，这里使用到了上面提到的<code>$?</code>变量。如<code>ls /tmp/abc &amp;&amp; touch /tmp/abc/hehe</code>，当不存在abc这个目录时，touch命令不会执行。</li>
<li>命令之间用<code>||</code>连接，当上一个指令<strong>错误</strong>执行完成后，才会接着执行下一个命令。如<code>ls /tmp/abc || mkdir /tmp/abc &amp;&amp; touch /tmp/abc/hehe</code>，当abc路径不存在时，会创建abc路径，并执行touch命令；而如果abc路径存在，则会直接执行touch命名。</li>
</ul>
<h2 id="格式化打印输出">
  格式化打印输出
  <a class="anchor" href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e6%89%93%e5%8d%b0%e8%be%93%e5%87%ba">#</a>
</h2>
<ul>
<li>%ns表示n个字符；%ni表示n个整数数字数；%N.nf表示一共N个数字，小数点占n个。</li>
<li><code>\n表示换行，\t表示tab键</code>。</li>
</ul>
<h2 id="正则">
  正则
  <a class="anchor" href="#%e6%ad%a3%e5%88%99">#</a>
</h2>
<ul>
<li>vi、grep、awk、seq等工具支持正则表达式；cp、ls不支持正则表达式，只能使用bash本身的通配符。</li>
</ul>
<table>
<thead>
<tr>
<th>规则</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>^word</td>
<td>寻找以word开始的行</td>
</tr>
<tr>
<td>word$</td>
<td>寻找以行尾为word的行</td>
</tr>
<tr>
<td>.</td>
<td>代表任意一个字符</td>
</tr>
<tr>
<td>\</td>
<td>转义字符</td>
</tr>
<tr>
<td>*</td>
<td>重复前一个字符0到无穷次</td>
</tr>
<tr>
<td>[abc]</td>
<td>搜寻含有a或b或c的那一行，[]只代表一个待搜寻的字符</td>
</tr>
<tr>
<td>[a-z]</td>
<td>搜寻两个字符间的所有连续字符，这个连续与ASCII编码有关。</td>
</tr>
<tr>
<td>[^abc]</td>
<td>反向选择，不要有a或者b或者c的行</td>
</tr>
<tr>
<td>\{n,m\}</td>
<td>\{n,m\} 连续n到m个的前一个字符<br>\{n\} 连续n个前一个字符<br>\{n,\} 连续n个以上的前一个字符</td>
</tr>
<tr>
<td>[:alnum:]</td>
<td>代表a-z,A-Z,0-9</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>代表A-Z,a-z</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>代表空格和[Tab]</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>代表数字</td>
</tr>
<tr>
<td>[:lower:]、[:upper:]</td>
<td>代表小写字符、代表大写字符</td>
</tr>
<tr>
<td>[:space:]</td>
<td>任何会产生空白的字符，包括空格，[Tab]，CR等</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>代表16进位的数字类型。</td>
</tr>
</tbody>
</table>
<h2 id="test指令">
  test指令
  <a class="anchor" href="#test%e6%8c%87%e4%bb%a4">#</a>
</h2>
<h3 id="文件的判断">
  文件的判断
  <a class="anchor" href="#%e6%96%87%e4%bb%b6%e7%9a%84%e5%88%a4%e6%96%ad">#</a>
</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>test -e filename</td>
<td>判断文件是否存在</td>
</tr>
<tr>
<td>-f</td>
<td>是否为文件</td>
</tr>
<tr>
<td>-d</td>
<td>是否为目录</td>
</tr>
<tr>
<td>-r</td>
<td>是否有可读的权限</td>
</tr>
<tr>
<td>-w</td>
<td>是否有可写的权限</td>
</tr>
<tr>
<td>-x</td>
<td>是否有可执行的权限</td>
</tr>
<tr>
<td>-nt（newer than）</td>
<td>判断file1是否比file2新，例：test file1 -nt file2</td>
</tr>
<tr>
<td>-ot（older than）</td>
<td>判断file1是否比file2旧</td>
</tr>
<tr>
<td>-ef</td>
<td>判断两个文件是否是同一个文件，其实是判断两个文件是否指向同一个inode。</td>
</tr>
</tbody>
</table>
<h3 id="两个整数之间的判断-如test-n1--eq-n2">
  两个整数之间的判断 如：test n1 -eq n2
  <a class="anchor" href="#%e4%b8%a4%e4%b8%aa%e6%95%b4%e6%95%b0%e4%b9%8b%e9%97%b4%e7%9a%84%e5%88%a4%e6%96%ad-%e5%a6%82test-n1--eq-n2">#</a>
</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>-eq</td>
<td>两数值相等</td>
</tr>
<tr>
<td>-ne</td>
<td>两数值不等</td>
</tr>
<tr>
<td>-gt（greater than）/ -ge（greater than or equal）</td>
<td>n1大于 / 大于等于n2</td>
</tr>
<tr>
<td>-lt / -le</td>
<td>n1小于 / 小于等于n2</td>
</tr>
</tbody>
</table>
<h3 id="判断字符串的数据">
  判断字符串的数据
  <a class="anchor" href="#%e5%88%a4%e6%96%ad%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e6%95%b0%e6%8d%ae">#</a>
</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>test -z string</td>
<td>若字符串为空串，则为true</td>
</tr>
<tr>
<td>test -n string</td>
<td>若字符串为非空串，则为true</td>
</tr>
<tr>
<td>test str1 == str2（bash中一个等号和两个等号是一样的）</td>
<td>若str1等于str2，则返回true</td>
</tr>
<tr>
<td>test str1 != str2</td>
<td>若str1不等于str2，则返回true</td>
</tr>
</tbody>
</table>
<h3 id="条件判断如test--r-filename--a--x-filename">
  条件判断，如test -r filename -a -x filename
  <a class="anchor" href="#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad%e5%a6%82test--r-filename--a--x-filename">#</a>
</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a（and）</td>
<td>与，两条件同时成立返回true</td>
</tr>
<tr>
<td>-o（or）</td>
<td>或，任何一个条件成立就返回true</td>
</tr>
<tr>
<td>!</td>
<td>非，如test ! -x file,当file不具备执行条件时返回true</td>
</tr>
</tbody>
</table>
<h2 id="shell中的默认变量">
  shell中的默认变量
  <a class="anchor" href="#shell%e4%b8%ad%e7%9a%84%e9%bb%98%e8%ae%a4%e5%8f%98%e9%87%8f">#</a>
</h2>
<ul>
<li>shell定义了一些默认的变量。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>tar -c -v -f example.tar example/
</span></span><span style="display:flex;"><span>$0  $1 $2 $3    $4       $5
</span></span></code></pre></div><ul>
<li><code>$#</code>表示命令后面的参数个数，上面就是5。</li>
<li><code>$@</code>表示&quot;$1&quot; &ldquo;$2&rdquo; &ldquo;$3&rdquo; &ldquo;$4&rdquo; &ldquo;$5&rdquo;。</li>
<li><code>$*</code> 表示&quot;$1 $2 $3 $4 $5&quot;</li>
<li><code>$$</code> 当前shell的PID。</li>
<li><code>$?</code> 上一个执行指令的回传值，一般一个指令执行完后，会回传一个0值。</li>
<li><code>$</code>本身也是一个变量，代表着当前shell的PID，通过<code>$$</code>使用该变量。</li>
<li><code>?</code>是一个变量，代表上一个指令传回来的值，一般来说，当我们成功执行了一个指令，则会返回0值，如果执行错误，就会传回一个错误代码，通过<code>$?</code>来调用。</li>
</ul>
<h2 id="算数运算">
  算数运算
  <a class="anchor" href="#%e7%ae%97%e6%95%b0%e8%bf%90%e7%ae%97">#</a>
</h2>
<ul>
<li><code>((...))</code>语法可以进行整数的算术运算，<code>((...))</code>会自动忽略内部的空格。</li>
</ul>
<pre tabindex="0"><code>((foo = 5 + 5))
echo $foo
</code></pre><ul>
<li>如果要结果，需要在<code>((...))</code>前面加上美元符号<code>$((...))</code></li>
</ul>
<pre tabindex="0"><code>total_mem=$(( 1 + 2 ))
#可以使用括号来改变运算顺序
echo $(( (2 + 3) * 4 ))
</code></pre><ul>
<li><code>((...))</code>支持<code>+ - * / %(取余) **(指数) ++ --</code>，<code>++</code>和<code>--</code>这两个运算符有前缀和后缀的区别。作为前缀是先运算后返回值，作为后缀是先返回值后运算。</li>
</ul>
<h3 id="expr">
  expr
  <a class="anchor" href="#expr">#</a>
</h3>
<ul>
<li><code>expr</code>命令支持算术运算，可以不使用<code>((...))</code>语法，只支持整数。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>foo<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>expr $foo + <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h2 id="条件判断式">
  条件判断式
  <a class="anchor" href="#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad%e5%bc%8f">#</a>
</h2>
<h3 id="if">
  if
  <a class="anchor" href="#if">#</a>
</h3>
<ul>
<li>中括号[  ]和test类似，也可以来进行数据的判断，中括号的两端需要有空格来分割。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> 条件判断式1 <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> 条件判断式2 <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#可以if后面可以跟上多个条件</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> 条件判断式1 <span style="color:#f92672">]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[</span> 条件判断式2 <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> 条件判断式1 <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> 条件判断式2 <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span></code></pre></div><h3 id="case">
  case
  <a class="anchor" href="#case">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> $变量名称 in
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;第一个变量名称&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		;;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;第二个变量名称&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		;;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#下面这个有点类似于C语言的default</span>
</span></span><span style="display:flex;"><span>	*<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		指令
</span></span><span style="display:flex;"><span>		;;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">esac</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#例：</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span> in 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;--host&#34;</span>|<span style="color:#e6db74">&#34;--ip&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        init_dir
</span></span><span style="display:flex;"><span>        build_image
</span></span><span style="display:flex;"><span>        modify_ip_address <span style="color:#e6db74">${</span>2<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>        echo -e <span style="color:#e6db74">&#34;文件已安装到\e[36m</span><span style="color:#e6db74">${</span>base_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">\e[0m下, 稍后请进入该目录下执行后续操作&#34;</span>
</span></span><span style="display:flex;"><span>        ;;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;build_image&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        build_image
</span></span><span style="display:flex;"><span>        ;;
</span></span><span style="display:flex;"><span>    *<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        display_help
</span></span><span style="display:flex;"><span>        ;;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">esac</span>
</span></span></code></pre></div><h2 id="函数function">
  函数function
  <a class="anchor" href="#%e5%87%bd%e6%95%b0function">#</a>
</h2>
<ul>
<li>shell是从上往下执行，所以函数要放在程序的最前面。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#function关键字是可选的</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#可以通过test abc来给函数传递参数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> test<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li><code>return</code>命令用于从函数返回一个值。函数执行到这条命令，就不再往下执行了，直接返回了。return后面可以不跟参数。</li>
</ul>
<h2 id="循环">
  循环
  <a class="anchor" href="#%e5%be%aa%e7%8e%af">#</a>
</h2>
<h3 id="不定循环">
  不定循环
  <a class="anchor" href="#%e4%b8%8d%e5%ae%9a%e5%be%aa%e7%8e%af">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#当condition条件不成立时终止循环</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> condition <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#当condition条件成立时终止循环</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">until</span> <span style="color:#f92672">[</span> conditon <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="固定循环">
  固定循环
  <a class="anchor" href="#%e5%9b%ba%e5%ae%9a%e5%be%aa%e7%8e%af">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> var in con1 con2 con3
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#或</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span> 初始值; 限制值；执行步阶<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span>	指令
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#一个案例</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span> i<span style="color:#f92672">=</span>1; i&lt;<span style="color:#f92672">=</span>10; i<span style="color:#f92672">=</span>i+1<span style="color:#f92672">))</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	printf <span style="color:#e6db74">&#34;%i\n&#34;</span> $i
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#一个ping很多机器的shell脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!bin/bash</span>
</span></span><span style="display:flex;"><span>network<span style="color:#f92672">=</span>82.156.3
</span></span><span style="display:flex;"><span><span style="color:#75715e">#seq是sequence，会连续生成1到254之间的数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> site in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 254<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#-c表示ping几次，-w表示超时时间，单位是秒</span>
</span></span><span style="display:flex;"><span>        ping -c <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">1</span> <span style="color:#e6db74">${</span>network<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>site<span style="color:#e6db74">}</span> &gt; /dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>                echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>network<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>site<span style="color:#e6db74">}</span><span style="color:#e6db74"> is ok&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>network<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>site<span style="color:#e6db74">}</span><span style="color:#e6db74"> id down&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#计算多个容器使用内存之和</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>total_mem<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取要计算内存的容器名称</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item in <span style="color:#66d9ef">$(</span>docker ps | grep kuam | awk <span style="color:#e6db74">&#39;{print $NF}&#39;</span><span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#获取容器的pid</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> pid in <span style="color:#66d9ef">$(</span>docker top <span style="color:#e6db74">${</span>item<span style="color:#e6db74">}</span>  | grep -v PID | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#获取占用的内存</span>
</span></span><span style="display:flex;"><span>        mem<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat /proc/<span style="color:#e6db74">${</span>pid<span style="color:#e6db74">}</span>/status | grep -i vmrss | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74"> PID:</span><span style="color:#e6db74">${</span>pid<span style="color:#e6db74">}</span><span style="color:#e6db74"> MEM:</span><span style="color:#e6db74">${</span>mem<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#内存求和</span>
</span></span><span style="display:flex;"><span>        total_mem<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span> <span style="color:#e6db74">${</span>total_mem<span style="color:#e6db74">}</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">${</span>mem<span style="color:#e6db74">}</span> <span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;total mem: </span><span style="color:#e6db74">${</span>total_mem<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h2 id="shell调试">
  shell调试
  <a class="anchor" href="#shell%e8%b0%83%e8%af%95">#</a>
</h2>
<ul>
<li><code>shell [-nvx] xxx.sh</code>：-n查询语法是否正确；-v先输出文件内容再执行shell脚本；-x执行前先将使用到的script输出到屏幕上。</li>
</ul>
<h2 id="例">
  例
  <a class="anchor" href="#%e4%be%8b">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#上传的文件路径</span>
</span></span><span style="display:flex;"><span>file_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/tmp/blog.tar&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#文件放的位置</span>
</span></span><span style="display:flex;"><span>blog_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/web/front/xiaoxiang.space&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#检查上传的文件是否存在</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> !  -e <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;文件不存在&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#检查当前是否有scp进程，没有就说明文件已经上传完成</span>
</span></span><span style="display:flex;"><span>scp_status<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>ps aux | grep scp | grep -v grep<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>scp_status<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    sleep 1s
</span></span><span style="display:flex;"><span>    scp_status<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>ps aux | grep scp | grep -v grep<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;传输完成...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将上传的文件解压到对应位置</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#e6db74">${</span>blog_dir<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>rm -rf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>blog_dir:?<span style="color:#e6db74">}</span><span style="color:#e6db74">/*&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> tar -xvf <span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span> -C <span style="color:#e6db74">${</span>blog_dir<span style="color:#e6db74">}</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;部署成功,文件位置为</span><span style="color:#e6db74">${</span>blog_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删掉上传的文件</span>
</span></span><span style="display:flex;"><span>rm -f <span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/jmeter/">jmeter</a>
    </h2>
    
  <h5>2021-09-06</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><ul>
<li>默认情况下JMeter的堆大小为1GB，可以调整堆的大小。可以在启动脚本时指定这些参数，也可以在bin路径下创建setenv.bat（windows）或setenv.sh（linux），格式如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#windows</span>
</span></span><span style="display:flex;"><span>set HEAP<span style="color:#f92672">=</span>-Xms2g -Xmx2g -XX:MaxMetaspaceSize<span style="color:#f92672">=</span>256m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#linux</span>
</span></span><span style="display:flex;"><span>export HEAP<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-Xms1024m -Xmx1024m&#34;</span>
</span></span></code></pre></div><ul>
<li>解决cookie跨域<code>CookieManager.check.cookies=false</code></li>
</ul>
<!--

#### 创建web测试

##### 1. 添加Users 

![](/img/javaee/jmeter/1.png)

![](/img/javaee/jmeter/2.png)

* Number of Threads：启动的线程数。
* Ramp-Up Period：每秒启动的用户=user/seconds，0表示立即启动所有的用户。
* Loop Count：每个线程执行每个HTTP请求的次数。

##### 2. 添加默认HTTP请求属性

* HTTP Request Defaults 只是定义了一些默认值，不发送HTTP请求，发送请求的是HTTP Request。

![](/img/javaee/jmeter/3.png)

![](/img/javaee/jmeter/4.png)

##### 3. 添加cookie

* 添加cookie管理后不需要做配置，除非需要在多个请求间共享cookie。添加了cookie管理后cookie会为每个请求管理cookie。

![](/img/javaee/jmeter/5.png)

![](/img/javaee/jmeter/6.png)

##### 4. 添加HTTP请求

* 这里创建两个HTTP请求，HTTP发送请求的顺序是从上到下。

![](/img/javaee/jmeter/7.png)

* HTTP请求1，因为在Request Defaults中指定了域名，所以这里可以不写，这里还修改了Name，方便和其他的HTTP请求区分。

![](/img/javaee/jmeter/8.png)

* HTTP请求2

![](/img/javaee/jmeter/9.png)

##### 5. 添加监听器来查看存储的测试结果

* 查看HTTP结果，响应数据。

![](/img/javaee/jmeter/10.png)

* 查看总结

![](/img/javaee/jmeter/11.png)

##### 点击绿色三角执行测试，点击靠右边的扫帚清除之前的测试数据。

* 官方不建议在GUI模式下加载测试，GUI模式下用来创建测试案例和调试bug，测试需要在CLI模式下执行（命令行模式）。

**参考链接：**[Apache JMeter - User's Manual: Building a Web Test Plan](https://jmeter.apache.org/usermanual/build-web-test-plan.html)

-->
<h4 id="命令行模式cli-mode">
  命令行模式（CLI Mode）
  <a class="anchor" href="#%e5%91%bd%e4%bb%a4%e8%a1%8c%e6%a8%a1%e5%bc%8fcli-mode">#</a>
</h4>
<ul>
<li>-n指定JMeter运行在cli模式。</li>
<li>-t指定JMX文件。</li>
<li>-l 指定jtl文件的名称，该文件是用来记录结果。</li>
<li>-e加载完测试后生成报告。</li>
<li>-o生成报告的文件夹的位置，必须为空或者不存在。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jmeter -n -t  test.jmx -l sso.jtl -e -o test
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="http://jmeter.apache.org/usermanual/get-started.html#non_gui">Apache JMeter - User&rsquo;s Manual: Getting Started</a></p>
<ul>
<li>类似于JDBC的jar包需要放在JMETER_HOME/lib路径下；开发的jmeter工具应放在JMETER_HOME/lib/ext路径下。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/spring/springboot%E9%85%8D%E7%BD%AE/">springboot配置</a>
    </h2>
    
  <h5>2021-09-01</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h2 id="springboot配置">
  springboot配置
  <a class="anchor" href="#springboot%e9%85%8d%e7%bd%ae">#</a>
</h2>
<h3 id="配置加载顺序">
  配置加载顺序
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e5%8a%a0%e8%bd%bd%e9%a1%ba%e5%ba%8f">#</a>
</h3>
<ul>
<li>优先级从高到低</li>
</ul>
<ol>
<li><strong>命令行传入的参数。</strong></li>
<li>SPRING_APPLICATION_JSON中的属性，是以JSON格式配置在系统环境变量中的内容。</li>
<li>java:comp/env中的JNDI属性。</li>
<li>java的系统属性，可以通过System.getProperties()获得的内容。</li>
<li>操作系统的环境变量。</li>
<li>通过random.*配置的随机属性。</li>
<li>**位于当前jar包之外，针对于特定的环境的而指定的配置文件。**如application-prod.yml。</li>
<li><strong>位于当前jar包内，针对于特定环境的而指定配置文件。</strong></li>
<li><strong>位于当前jar包外的application.properties和yml文件。</strong></li>
<li><strong>位于当前jar包内的application.properties和yml文件。</strong></li>
<li>在@Configuration注解修饰的类中，通过@PropertySource注解定义的属性。</li>
<li>应用默认属性，使用SpringAppication.setDefaultProperties定义的内容。</li>
</ol>
<h3 id="注入到类">
  注入到类
  <a class="anchor" href="#%e6%b3%a8%e5%85%a5%e5%88%b0%e7%b1%bb">#</a>
</h3>
<ol>
<li>resources/properties/person.properties</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">person.name</span><span style="color:#f92672">=</span><span style="color:#e6db74">xiaoxiang</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">person.age</span><span style="color:#f92672">=</span><span style="color:#e6db74">21</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">person.sex</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">person.weight</span><span style="color:#f92672">=</span><span style="color:#e6db74">67</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">person.height</span><span style="color:#f92672">=</span><span style="color:#e6db74">177</span>
</span></span></code></pre></div><ol start="2">
<li>java/space/xiaoxiang/properties/Person</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@PropertySource</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;classpath:properties/person.properties&#34;</span><span style="color:#f92672">,</span>ignoreResourceNotFound <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ConfigurationProperties</span><span style="color:#f92672">(</span>prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;person&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span> <span style="color:#75715e">//必须要有setter方法，否则无法注入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> sex<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> weight<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> height<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String description<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="3">
<li>controller中注入</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Person person<span style="color:#f92672">;</span>
</span></span></code></pre></div><h3 id="注入某个字段">
  注入某个字段
  <a class="anchor" href="#%e6%b3%a8%e5%85%a5%e6%9f%90%e4%b8%aa%e5%ad%97%e6%ae%b5">#</a>
</h3>
<ol>
<li>application.yml</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">sbl</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">xiaoxiang.space</span>
</span></span></code></pre></div><ol start="2">
<li>controller</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexController</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//注入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${sbl.hostname}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String sblHostname<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="参数引用">
  参数引用
  <a class="anchor" href="#%e5%8f%82%e6%95%b0%e5%bc%95%e7%94%a8">#</a>
</h3>
<ul>
<li>在application.yml中的各个参数之间，可以通过placeholder的方式进行引用。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">sbl</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">${hostname}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">xiaoxiang.space</span>
</span></span></code></pre></div><h3 id="使用随机数">
  使用随机数
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8%e9%9a%8f%e6%9c%ba%e6%95%b0">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">#随机字符串</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value1</span>: <span style="color:#ae81ff">${random.value}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#随机int</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value2</span>: <span style="color:#ae81ff">${random.int}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#随机long</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value3</span>: <span style="color:#ae81ff">${random.long}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#10以内的随机数</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value4</span>: <span style="color:#ae81ff">${random.int(10)}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#10-20的随机数</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value5</span>: <span style="color:#ae81ff">${random.int[10,20]}</span>
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="https://blog.didispace.com/spring-boot-learning-21-1-3/">Spring Boot 2.x基础教程：配置文件详解 | 程序猿DD</a></p>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/6/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Page 5" class="page-link" role="button">5</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/6/" aria-label="Page 6" class="page-link" role="button">6</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 7" class="page-link" role="button">7</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/8/" aria-label="Page 8" class="page-link" role="button">8</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Page 9" class="page-link" role="button">9</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/8/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  
<a href="https://beian.miit.gov.cn" target="_blank" style="color:gray;">备案号：陕ICP备2022008774号</a>

 
      </footer>
    </div>

  </main>

</body>
</html>











