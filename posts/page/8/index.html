<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/docker/">docker</a>
    </h2>
    
  <h5>2021-08-31</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><ul>
<li>容器container是一个进程，容器运行于属于自己的独立的命名空间，因此容器可以拥有自己的root文件系统、网络配置、进程空间等。容器内的应用进程直接运行于宿主机的内核。</li>
<li>镜像image包含了容器的文件系统，也包含了很多其他的配置。（镜像运行起来就是容器）。docker镜像是分层的结构，镜像构建时会一层层的构建，前一层是后一层的基础，每一层构建完就不会再发生改变，后一层的任何改变只会发生在自己的这一层。如删除前一层的文件，实际上不是真的删除前一层的文件，而是仅在当前层标记该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是该文件实际上会一直跟随镜像。</li>
<li>Dockerfile用来创建镜像，docker-compose指定如何运行镜像。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker ps <span style="color:#75715e">#获取已运行的容器</span>
</span></span><span style="display:flex;"><span>docker ps -a <span style="color:#75715e">#获取所有的容器</span>
</span></span><span style="display:flex;"><span>docker images <span style="color:#75715e">#获取所有镜像</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#从仓库下载一个镜像</span>
</span></span><span style="display:flex;"><span>docker pull nginx:latest
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将镜像保存到本地</span>
</span></span><span style="display:flex;"><span>docker save -o docker-nginx.tar nginx
</span></span><span style="display:flex;"><span><span style="color:#75715e">#从本地导入镜像</span>
</span></span><span style="display:flex;"><span>docker load -i docker-nginx.tar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#运行一个镜像，-d后台运行。-p将主机的端口映射到容器的端口。</span>
</span></span><span style="display:flex;"><span>docker run -d -p 80:80 image_name:image_version
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启动一个shell，执行了两个命令，第一个命令随机挑选了一个数并写到了txt文件中，第二个命令让容器保持运行</span>
</span></span><span style="display:flex;"><span>docker run -d ubuntu bash -c <span style="color:#e6db74">&#34;shuf -i 1-10000 -n 1 -o /data.txt &amp;&amp; tail -f /dev/null&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启动镜像，并执行后面的命令</span>
</span></span><span style="display:flex;"><span>docker run -it ubuntu ls /
</span></span><span style="display:flex;"><span><span style="color:#75715e">#--name 指定容器的名称</span>
</span></span><span style="display:flex;"><span>docker run -d -p 17106:3306 --name 171-mysql  mysql8:171-uam
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#进入容器中，-i保持stdin打开，-t分配一个终端</span>
</span></span><span style="display:flex;"><span>docker exec -i -t &lt;container-id&gt; /bin/bash 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看容器内此txt文件内容</span>
</span></span><span style="display:flex;"><span>docker exec &lt;container-id&gt; cat /data.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#停止容器运行</span>
</span></span><span style="display:flex;"><span>docker stop &lt;container-id&gt; 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#移除容器</span>
</span></span><span style="display:flex;"><span>docker rm &lt;container-id&gt; 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#停止并移除容器运行</span>
</span></span><span style="display:flex;"><span>docker rm -f &lt;container-id&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#根据当前路径的dockerfile构建一个镜像。-t给镜像起个名字。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># . 表示在当前路径下，可以使用一个.dockerignore文件来忽略某些文件。</span>
</span></span><span style="display:flex;"><span>docker build -f Dockerfile -t image_name:image_version .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建一个named volume</span>
</span></span><span style="display:flex;"><span>docker volume create todo-db
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将volumn挂载到/etc/todos路径下</span>
</span></span><span style="display:flex;"><span>docker run -dp 3000:3000 -v todo_db:/etc/todos image_name:image_version
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看此named volume的信息</span>
</span></span><span style="display:flex;"><span>docker volume inspect todo-db 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#使用了一个bind mounts，将主机的当前路径挂载到容器内的/app路径</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-w表示当前的工作路径，-d表示后台运行，-c表示执行后面的命令，-p表示端口映射</span>
</span></span><span style="display:flex;"><span>docker run -dp 3000:3000  -w /app -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">:/app&#34;</span> node:12-alpine sh -c <span style="color:#e6db74">&#34;yarn install &amp;&amp; yarn run dev&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看logs，-f表示跟随日志输出</span>
</span></span><span style="display:flex;"><span>docker logs -f &lt;container-id&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建了一个network</span>
</span></span><span style="display:flex;"><span>docker network create todo-app
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启动了一个mysql容器，并接入到network，使用-e定义了初始化数据库用的环境变量，</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mysql还支持MYSQL_HOST（mysql server的主机名）,MYSQL_USER。docker自动创建了一个todo-mysql-data的volume。</span>
</span></span><span style="display:flex;"><span>docker run -d --network todo-app --network-alias mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v todo-mysql-data:/var/lib/mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>secret <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e MYSQL_DATABASE<span style="color:#f92672">=</span>todos <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>mysql:5.7
</span></span><span style="display:flex;"><span><span style="color:#75715e">#输入密码后就能进入到mysql中</span>
</span></span><span style="display:flex;"><span>docker exec -it &lt;mysql-container-id&gt; mysql -p
</span></span><span style="display:flex;"><span><span style="color:#75715e">#加入到这个网络，并进入到bash</span>
</span></span><span style="display:flex;"><span>docker run -it --network todo-app image_name:image_version /bin/sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#扫描一个镜像</span>
</span></span><span style="display:flex;"><span>docker scan image_name:image_version
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看创建历史，--no-trunc获取全部输出</span>
</span></span><span style="display:flex;"><span>docker image history <span style="color:#f92672">[</span>--no-trunc<span style="color:#f92672">]</span> mysql:5.7
</span></span></code></pre></div><h3 id="restart策略">
  restart策略
  <a class="anchor" href="#restart%e7%ad%96%e7%95%a5">#</a>
</h3>
<ul>
<li>当使用<code>docker run</code>命令时可以使用<code>--restart</code>来配置容器的重启策略。可选的标志如下：</li>
</ul>
<table>
<thead>
<tr>
<th>flag</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>no</td>
<td>任何情况下不会自动重启容器(默认)</td>
</tr>
<tr>
<td>on-failure[:max-retries]</td>
<td>当容器由于错误(退出代码为非0)而退出时会重启容器。使用<code>:max-retries</code>来限制容器尝试重启的次数。</td>
</tr>
<tr>
<td>always</td>
<td>始终在容器停止时重启，除非容器是被手动停止的。在docker重新启动时容器也会重启。</td>
</tr>
<tr>
<td>unless-stopped</td>
<td>类似于always，但是当容器停止后，重启docker容器并不会启动。</td>
</tr>
</tbody>
</table>
<p>参考链接: 
  <a href="https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy">use-a-restart-policy</a></p>
<h2 id="docker-compose">
  docker-compose
  <a class="anchor" href="#docker-compose">#</a>
</h2>
<ul>
<li><code>docker-compose version</code>获取版本信息。</li>
<li>创建一个叫<code>docker-compose.yml</code>的文件，如将下面这个命令转化为docker-compose。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#转换前</span>
</span></span><span style="display:flex;"><span>docker run -dp 3000:3000 -w /app -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">:/app&#34;</span> --network todo-app <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -e MYSQL_HOST<span style="color:#f92672">=</span>mysql -e MYSQL_USER<span style="color:#f92672">=</span>root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -e MYSQL_PASSWORD<span style="color:#f92672">=</span>secret -e MYSQL_DB<span style="color:#f92672">=</span>todos <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  node:12-alpine  sh -c <span style="color:#e6db74">&#34;yarn install &amp;&amp; yarn run dev&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#转换前</span>
</span></span><span style="display:flex;"><span>docker run -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --network todo-app --network-alias mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v todo-mysql-data:/var/lib/mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>secret -e MYSQL_DATABASE<span style="color:#f92672">=</span>todos <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  mysql:5.7
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">#转换后</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3.7&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">app</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">node:12-alpine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">3000</span>:<span style="color:#ae81ff">3000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">working_dir</span>: <span style="color:#ae81ff">/app</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#docker compose中volume定义可以使用相对路径。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./:/app</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh -c &#34;yarn install &amp;&amp; yarn run dev&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_HOST</span>: <span style="color:#ae81ff">mysql</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_USER</span>: <span style="color:#ae81ff">root</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_PASSWORD</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_DB</span>: <span style="color:#ae81ff">todos</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mysql</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mysql:5.7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">todo-mysql-data:/var/lib/mysql</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_ROOT_PASSWORD</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_DATABASE</span>: <span style="color:#ae81ff">todos</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">todo-mysql-data</span>:
</span></span></code></pre></div><ul>
<li>使用<code>docker-compose up -d</code>命令执行，-d参数使得在后台运行，这个命令会自动在应用间创建network。</li>
<li>使用<code>docker-compose logs -f</code>来查看日志。-f表示follow，会将日志的变化输出到控制台。
<ul>
<li>使用<code>docker-compose logs -f app</code>来查看特定服务的日志。</li>
</ul>
</li>
<li><code>docker-compose down [--volumes]</code>关闭并移除，&ndash;volumes指定是否删除volumes。</li>
</ul>
<h2 id="dockerfile">
  dockerfile
  <a class="anchor" href="#dockerfile">#</a>
</h2>
<ul>
<li>一个Dockerfile大部分情况下以FROM指令开始，FROM指令指定了构建的父镜像。</li>
<li><code>ENV</code>用来设置环境变量，通过<code>${xxx}</code>的方式使用。</li>
<li>CMD在docker run时运行，RUN在docker build时运行。</li>
<li>RUN会在新的一层执行命令。</li>
</ul>
<h3 id="多阶段构建">
  多阶段构建
  <a class="anchor" href="#%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> maven AS build</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mvn package<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> tomcat</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /app/target/file.war /usr/local/tomcat/webapps <span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="https://docs.docker.com/get-started/">Orientation and setup | Docker Documentation</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/gradle/">gradle</a>
    </h2>
    
  <h5>2021-08-30</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h5 id="settingsgradle">
  <code>settings.gradle</code>
  <a class="anchor" href="#settingsgradle">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>rootProject<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;demo&#39;</span>
</span></span><span style="display:flex;"><span>include<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;app&#39;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><ul>
<li>rootProject指定了构建的名称，默认以上级目录命名。</li>
<li>include(&rsquo;&hellip;&rsquo;)定义了一个叫app的子项目，子项目包含自己的代码和构建逻辑。</li>
</ul>
<h5 id="gradleproperties">
  <code>gradle.properties</code>
  <a class="anchor" href="#gradleproperties">#</a>
</h5>
<p>最终的配置组合了所有的命令行提供的属性和gradle.properties文件。</p>
<h6 id="配置优先级">
  配置优先级：
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e4%bc%98%e5%85%88%e7%ba%a7">#</a>
</h6>
<ol>
<li>命令行使用-P/&ndash;project-prop传递的参数；</li>
<li>GRADLE_USER_HOME目录的gradle.properties;</li>
<li>项目根目录的gradle.properties;</li>
<li>gradle安装目录的gradle.properties.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e">#指定构建时jvm参数。</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.jvmargs</span><span style="color:#f92672">=</span><span style="color:#e6db74">-Xms2g</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#并行编译，会使用org.gradle.workers.max参数</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.parallel</span><span style="color:#f92672">=</span><span style="color:#e6db74">(true,false)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#默认为CPU的数量</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.workers.max</span><span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#使用systemProp.前缀可在gradle.properties中配置系统属性，或者命令行中使用-D（不加systemProp，有多个project时，只有根路径下的以systemProp开头的属性会被使用，其他的都会被忽略。</span>
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="https://docs.gradle.org/current/userguide/build_environment.html">Build Environment (gradle.org)</a></p>
<h2 id="构建">
  构建
  <a class="anchor" href="#%e6%9e%84%e5%bb%ba">#</a>
</h2>
<h3 id="tasks">
  tasks
  <a class="anchor" href="#tasks">#</a>
</h3>
<ul>
<li>每个gradle build由多个projects组成，一个project又由多个tasks组成。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;upper&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String someString <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mY_nAmE&#39;</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#34;Original: $someString&#34;</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#34;Upper case: ${someString.toUpperCase()}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    dependsOn tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">upper</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#39;hello world&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#执行</span>gradle <span style="color:#f92672">-</span>q hello<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#f92672">-</span>q<span style="color:#960050;background-color:#1e0010">表示抑制日志消息</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Earth&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doFirst <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Venus&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Mars&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Jupiter&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#执行</span>gradle <span style="color:#f92672">-</span>q hello
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>doFirst<span style="color:#960050;background-color:#1e0010">和</span>doLast<span style="color:#960050;background-color:#1e0010">可以被执行多次，他们被添加到</span>task<span style="color:#960050;background-color:#1e0010">的</span>actions list<span style="color:#960050;background-color:#1e0010">的开始或结束位置，当</span>task<span style="color:#960050;background-color:#1e0010">执行时，在</span>action list<span style="color:#960050;background-color:#1e0010">中的</span>action<span style="color:#960050;background-color:#1e0010">会被按顺序执行。</span>
</span></span></code></pre></div><h4 id="默认task">
  默认task
  <a class="anchor" href="#%e9%bb%98%e8%ae%a4task">#</a>
</h4>
<ul>
<li>gradle允许定义多个默认的task</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>defaultTasks <span style="color:#e6db74">&#39;clean&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;run&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;clean&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Default Cleaning!&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;run&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Default Running!&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#通过</span>gradle <span style="color:#f92672">-</span>q<span style="color:#960050;background-color:#1e0010">执行</span>
</span></span></code></pre></div><h4 id="为构建脚本添加外部依赖">
  为构建脚本添加外部依赖
  <a class="anchor" href="#%e4%b8%ba%e6%9e%84%e5%bb%ba%e8%84%9a%e6%9c%ac%e6%b7%bb%e5%8a%a0%e5%a4%96%e9%83%a8%e4%be%9d%e8%b5%96">#</a>
</h4>
<ul>
<li>如果构建脚本需要使用外部的库，可以使用buildscript，buildscript中添加的依赖只对构建脚本有效。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#75715e">//使用库中的某个类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">import</span> org.apache.commons.codec.binary.Base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>buildscript <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    repositories <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        mavenCentral<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//将库添加到classpath路径下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classpath group: <span style="color:#e6db74">&#39;commons-codec&#39;</span><span style="color:#f92672">,</span> name: <span style="color:#e6db74">&#39;commons-codec&#39;</span><span style="color:#f92672">,</span> version: <span style="color:#e6db74">&#39;1.2&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;encode&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> encodedString <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Base64<span style="color:#f92672">().</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello world\n&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">String</span><span style="color:#f92672">(</span>encodedString<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>gradle <span style="color:#f92672">-</span>q encode
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/slf4j/">slf4j</a>
    </h2>
    
  <h5>2021-08-30</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><p>SLF4J：the simple logging facade for java。</p>
<ul>
<li>作为各种日志框架的门面。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
    </h2>
    
  <h5>2021-08-27</h5>



  

  
  <div>
    
      <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
  </div>
  




    <p><ul>
<li>Internet是全球最大的互联网络，是一个世界范围的计算机网络，互联了遍及全世界的数以亿计的计算设备的网络。</li>
<li>主机（host）：也叫端系统。是与因特网相连的计算机和其他设备，如PC、服务器、手机等。主机通过通信链路（电缆、光纤、无线电等）和分组交换机（路由器、链路层交换机）连接到一起。当一台主机向另一台主机发送数据，发送主机将数据分组（将数据分段，每段加上首部字节）。分组交换机从他的一条入通信链路接收到达的分组，从它的出通信链路转发该分组。路由器通常位于网络核心，链路层交换机位于接入网中。</li>
<li>ISP(Internet Service Provider)：因特网服务提供商。主机通过ISP介入到因特网，每个交换机由多个通信链路和分组交换机组成。</li>
</ul>
<blockquote class="book-hint info">
  <ul>
<li>协议：计算机网络中数据交换必须遵守事先约定的规则。协议规定了网络中所有信息发送和接收过程。协议的三要素：
<ol>
<li>语法，数据和控制信息的结构或格式。</li>
<li>语义，需要发出何种控制信息；完成何种动作及做出何种响应；以及差错控制。</li>
<li>时许，事件的顺序；速度匹配。</li>
</ol>
</li>
<li>报文指的是发送信息的整体，比如一个文件、一首音乐。</li>
<li>分组是报文分拆出来的一系列相对较小的数据包。</li>
</ul>

</blockquote>

<ul>
<li>接入网络：①DSL(Digital Subscriber Line)，即数字电话线；②电缆网络；③无线局域网和广域无线接入。</li>
<li>计算机网络结构：
<ul>
<li>网络边缘，指主机和网络应用。</li>
<li>接入网络，有线和无线通信链路。</li>
<li>网络核心(核心网络)，互联的路由器。网络核心的关键功能是路由和转发，路由是确定分组从源到目的的传输路径，转发是将分组从路由器的输入端交换至正确的输出端口。</li>
</ul>
</li>
</ul>
<h2 id="数据交换">
  数据交换
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e4%ba%a4%e6%8d%a2">#</a>
</h2>
<ul>
<li>网络核心需要通过数据交换将数据从源主机发送到目的主机，数据交换有以下类型：1. 电路交换。2. 报文交换。3. 分组交换。</li>
<li>电路交换的三个阶段是：1. 建立通信；2. 通信；3. 释放连接。会独占资源。为了共享中继线，引入了多路复用(Multiplexing)。典型的多路复用有：1. 频分多路复用(FDM)；2. 时分多路复用(TDM)；3. 波分多路复用(WDM)；4. 码分多路复用(CDM)。</li>
<li>频分多路复用是各用户占用不同的频率带宽。用户在分派到一定的频带后，在通信过程中始终占用此频带。</li>
<li>
  <img src="/img/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/1.png" alt="FDM" /></li>
<li>时分复用则是将时间划分为一段段等长的时分复用帧（TDM 帧），每个用户在每个TDM帧中占用固定序号的时隙。时分复用的所有用户是在不同的时间占用相同的频带宽度。</li>
<li>
  <img src="/img/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/2.png" alt="TDM" /></li>
<li>波分复用就是光的频分复用。</li>
<li>
  <img src="/img/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/3.png" alt="WDM" /></li>
<li>码分多路复用是为每个用户分配一个唯一的mbit码片序列，各用户码片序列相互正交。</li>
<li>报文交换和分组交换均采用存储转发的方式交换数据，报文交换以完整的报文进行存储转发，分组交换以较小的分组进行存储转发。</li>
<li>分组交换的报文的交付时间:</li>
<li>
  <img src="/img/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/4.png" alt="FDM" /></li>
<li>分组交换和电路交换的比较：
<ol>
<li>分组交换适合突发数据传输网络。</li>
<li>电路交换会独占资源，分组交换不会，所以分组交换可能产生拥堵和分组丢失。</li>
</ol>
</li>
</ul>
<h2 id="网络性能指标">
  网络性能指标
  <a class="anchor" href="#%e7%bd%91%e7%bb%9c%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87">#</a>
</h2>
<ol>
<li>速率或比特率，使用单位时间中传输信息的比特量。1Gbps=10^3Mbps=10^6kbps=10^9bps</li>
<li>带宽指的是数字信道所能传输的最高数据率。单位是bps</li>
<li>分组交换可能会发生丢包和时延。因为分组在路由器缓存中排队时，如果分组到达速率超过输出链路容量时就会丢包；分组排队等待输出链路可用时就会产生时延，时延包括节点处理延迟(通常小于毫秒级别)、数据报排队延迟、路由器中传输延迟和物理链路传播延迟。</li>
<li>时延带宽积又被称为以比特为单位的链路长度，时延带宽积=传播时延x带宽。</li>
<li>丢包率=丢包数/已发分组数。</li>
<li>吞吐量标识在发送端和接收端之间传送数据速率。吞吐量取决于链路上最小的带宽。</li>
</ol>
<h2 id="osi参考模型和tcpip参考模型">
  OSI参考模型和TCP/IP参考模型
  <a class="anchor" href="#osi%e5%8f%82%e8%80%83%e6%a8%a1%e5%9e%8b%e5%92%8ctcpip%e5%8f%82%e8%80%83%e6%a8%a1%e5%9e%8b">#</a>
</h2>
<ul>
<li>现实中基本上都用的TCP/IP参考模型。</li>
<li>每一层都会封装上层的数据，增加一些控制信息用来构建协议数据单元(PDU)。</li>
<li>
  <img src="/img/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c/5.png" alt="OSI参考模型" />
<ul>
<li>物理层定义了接口特性、传输模式、比特编码、比特同步和数据率。</li>
<li>数据链路层是相邻网络元素（主机、交换机、路由器等）的数据传输，负责节点之间的数据传输、组帧、物理寻址、流量控制、差错控制和访问控制(决定某一时刻哪个设备拥有物理介质的使用权)。</li>
<li>网络层负责源主机到目的主机的数据分组路由与转发以及逻辑寻址。</li>
<li>传输层负责进程间完整报文的传输。包括分段与重组、SAP寻址、连接控制、流量控制、差错控制。</li>
<li>会话层负责对话的建立、维护和同步。</li>
<li>表示层负责数据的加密解密、压缩解压等。</li>
<li>应用层支持用户通过用户代理(如浏览器)或网络接口使用网络。</li>
</ul>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%B9%E7%A7%B0%E5%AF%86%E9%92%A5/">对称密钥</a>
    </h2>
    
  <h5>2021-08-25</h5>



  

  
  <div>
    
      <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/">信息安全</a>
  </div>
  




    <p><p>用相同的密钥进行加密和解密</p>
<ul>
<li>异或（XOR）（exclusive or）⊕</li>
<li>如果将01001100记为A，10101010记为B，A于B的xor运算结果为（不进位）11100110。将结果在xorB，又得到了A。只选择一个合适的B，仅仅使用XOR就能得到一个高强度的密文。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A6%E8%B5%B7%E6%AD%A5/">密码学起步</a>
    </h2>
    
  <h5>2021-08-25</h5>



  

  
  <div>
    
      <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/">信息安全</a>
  </div>
  




    <p><ul>
<li>
<p>信息安全面临的威胁：</p>
<ul>
<li>机密性：秘密被泄露</li>
<li>完整性：信息被篡改</li>
<li>认证：伪装成发送者</li>
<li>不可否认性：事后否认自己没做</li>
</ul>
</li>
<li>
<p>密码的常识：</p>
<ul>
<li>不要使用保密的密码算法</li>
<li>使用低强度的密码比不进行任何加密更危险</li>
<li>任何密码总有一天都会被破解</li>
<li>密码只是信息安全的一部分</li>
</ul>
</li>
<li>
<p>报文的最初形式称为<strong>明文</strong></p>
</li>
<li>
<p>使用<strong>加密算法</strong>加密明文，生成的加密报文称为<strong>密文</strong>，加密算法往往是已知的。</p>
</li>
<li>
<p><strong>密钥</strong>K<sub>A</sub>是一串数字或者字符，加密算法以密钥和明文报文m为输入，生成的密文为输出。用K<sub>A</sub>(m)表示。</p>
</li>
<li>
<p>解密算法使用密钥K<sub>B</sub>和密文作为输入，通过计算K<sub>B</sub>(K<sub>A</sub>(m))得到m。</p>
</li>
<li>
<p><strong>对称密码</strong>（symmetric cryptography）是指在加密和解密时使用同一密钥的方式。</p>
</li>
<li>
<p><strong>公钥密码</strong>（pulbic-key cryptography）是指在加密和解密时使用不同密钥的方式。又称为非对称密码（asymmetric cryptography）。</p>
</li>
<li>
<p>混合密码系统（hybrid cryptosystem）是将对称密钥和公钥密码结合起来的密码方式。</p>
</li>
<li>
<p><strong>单向散列函数</strong>（one-way hash function）是一种保证完整性的密码技术。</p>
</li>
<li>
<p><strong>消息认证码</strong>（message authentication code）是一种能够保证消息完整性和提供认证的密码技术。</p>
</li>
<li>
<p><strong>数字签名</strong>（digital signature）是一种能确保完整性、提供认证并防止否认的密码技术。</p>
</li>
<li>
<p><strong>伪随机数生成器</strong>（Pseudo Random Number Generator，PRNG）是一种能够模拟产生随机数列的算法，随机数承担着密钥生成的重要职责，在web中进行SSL/TLS通信时，会生成一个仅用于当前通信的临时密钥，这个密钥是基于伪随机数器生成的。</p>
</li>
</ul>
<h4 id="凯撒密码">
  凯撒密码
  <a class="anchor" href="#%e5%87%af%e6%92%92%e5%af%86%e7%a0%81">#</a>
</h4>
<ul>
<li>将明文报文中的每个字母用字母表中该字母后第k个字母进行替换，允许回绕。</li>
<li>密钥空间（keyspace）是指能够使用的“所有密钥的集合”，所有可以使用的密钥的总数越大，密钥空间越大，凯撒密码的密钥空间的大小是25。</li>
<li>很容易进行暴力破解。</li>
</ul>
<h4 id="简单替换密码">
  简单替换密码
  <a class="anchor" href="#%e7%ae%80%e5%8d%95%e6%9b%bf%e6%8d%a2%e5%af%86%e7%a0%81">#</a>
</h4>
<ul>
<li>将字母表中的26个字母，分别将这26个字母本身建立一对一对应关系（替换表）。加密过程是依次将明文中的每一个字母按照替换表替换成另一个字母。</li>
<li>很难通过暴力破解，因为它的密钥总数是26x25x24&hellip;x2x1。</li>
<li>通过频率分析，就能破解。其利用明文中的字母出现的频率和密文中的字母出现的频率一致的特性。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/logback/">logback</a>
    </h2>
    
  <h5>2021-08-23</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h3 id="例">
  例：
  <a class="anchor" href="#%e4%be%8b">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;appender</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style="color:#f92672">&gt;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style="color:#f92672">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;appender</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;FILE&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;ch.qos.logback.core.FileAppender&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;file&gt;</span>testFile.log<span style="color:#f92672">&lt;/file&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--         将 immediateFlush 设置为 false 可以获得更高的日志吞吐量 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;immediateFlush&gt;</span>false<span style="color:#f92672">&lt;/immediateFlush&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--         默认为 ch.qos.logback.classic.encoder.PatternLayoutEncoder --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;pattern&gt;</span>%-4relative [%thread] %-5level %logger{35} - %msg%n<span style="color:#f92672">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;appender</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;SYSLOG&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;ch.qos.logback.classic.net.SyslogAppender&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;syslogHost&gt;</span>remote_home<span style="color:#f92672">&lt;/syslogHost&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;port&gt;</span>5140<span style="color:#f92672">&lt;/port&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;facility&gt;</span>AUTH<span style="color:#f92672">&lt;/facility&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;suffixPattern&gt;</span>[%thread] %logger %msg<span style="color:#f92672">&lt;/suffixPattern&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;root</span> <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;INFO&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;appender-ref</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/root&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;logger</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;space.xiaoxiang&#34;</span> <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;debug&#34;</span> <span style="color:#a6e22e">additivity=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span></code></pre></div><h2 id="appender">
  appender
  <a class="anchor" href="#appender">#</a>
</h2>
<h3 id="appenderbase">
  AppenderBase
  <a class="anchor" href="#appenderbase">#</a>
</h3>
<ul>
<li>是一个抽象类，实现了Appender接口，提供了基本方法供appender使用。</li>
</ul>
<h3 id="outputstreamappender">
  OutputStreamAppender
  <a class="anchor" href="#outputstreamappender">#</a>
</h3>
<ul>
<li>是ConsoleAppender、FileAppender以及 RollingFileAppender的父类。</li>
</ul>
<h3 id="consoleappender">
  ConsoleAppender
  <a class="anchor" href="#consoleappender">#</a>
</h3>
<ul>
<li>将日志输出到控制台，ConsoleAppender通过用户指定的encoder格式化日志事件。</li>
</ul>
<h3 id="fileappender">
  FileAppender
  <a class="anchor" href="#fileappender">#</a>
</h3>
<ul>
<li>将日志输出到文件中，通过<code>file</code>来指定目标文件。</li>
</ul>
<h3 id="rollingfileappender">
  RollingFileAppender
  <a class="anchor" href="#rollingfileappender">#</a>
</h3>
<ul>
<li>具有轮转日志文件的功能。比如在满足特定的条件后，将日志输出到另一个文件。</li>
</ul>
<h3 id="socketappender-和-sslsocketappender">
  SocketAppender 和 SSLSocketAppender
  <a class="anchor" href="#socketappender-%e5%92%8c-sslsocketappender">#</a>
</h3>
<ul>
<li>可以将日志传输到远端机器。</li>
</ul>
<h3 id="smtpappender">
  SMTPAppender
  <a class="anchor" href="#smtpappender">#</a>
</h3>
<ul>
<li>收集日志到缓冲区中，当用户指定的事件发生时，将从缓冲区中取出适当的内容进行发送。</li>
</ul>
<h3 id="dbappender">
  DBAppender
  <a class="anchor" href="#dbappender">#</a>
</h3>
<ul>
<li>将日志插到三张数据库表中，三张表分别是logging_event, logging_event_property 与 logging_event_exception。</li>
</ul>
<h3 id="syslogappender">
  SyslogAppender
  <a class="anchor" href="#syslogappender">#</a>
</h3>
<ul>
<li>可以将日志发送给远程的syslog守护线程。</li>
<li>日志事件的严重程度是根据日志事件的级别转换来的，DEBUG被转换为7，INFO被转换为6，WARN为4，ERROR为3。</li>
</ul>
<h3 id="siftingappender">
  SiftingAppender
  <a class="anchor" href="#siftingappender">#</a>
</h3>
<ul>
<li>根据给定的运行时属性分离或者过滤日志。</li>
</ul>
<h3 id="asyncappender">
  AsyncAppender
  <a class="anchor" href="#asyncappender">#</a>
</h3>
<ul>
<li>作为一个事件调度器存在，必须调用其他appender来完成操作。</li>
</ul>
<h2 id="encoder">
  encoder
  <a class="anchor" href="#encoder">#</a>
</h2>
<ul>
<li>encoder将日志事件转换为字节数组，同时将字节数组写入到一个OutputStream中。</li>
<li>PatternLayoutEncoder是目前唯一真正有用的encoder，它仅包裹了一个PatternLayout就完成了大部分的工作。</li>
</ul>
<h2 id="layout">
  layout
  <a class="anchor" href="#layout">#</a>
</h2>
<ul>
<li>layout负责将日志事件转化为字符串。</li>
</ul>
<h3 id="patternlayout">
  PatternLayout
  <a class="anchor" href="#patternlayout">#</a>
</h3>
<ul>
<li>
<p>可以通过调整PatternLayout的转换模式来进行定制，PatternLayout的转换模式由字面量和转换说明符组成，每一个转换说明符由一个百分号开始<code>%</code>，后面跟随格式修改器，以及可用大括号括起来的转换字符和可选的参数。格式修改器可以对字段进行对齐，修改最大最小宽度等。</p>
</li>
<li>
<p>括号用于对转换模式进行分组，<code>(</code>和<code>)</code>都有特殊的含义。</p>
</li>
<li>
<p>名为<code>com.foo</code>的logger是名为<code>com.foo.bar</code>的logger的父级。（命名层次结构）</p>
</li>
<li>
<p>root logger的默认层级为DEBUG。</p>
</li>
<li>
<p>层级的排序：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR。</p>
</li>
<li>
<p>appender具有叠加性：logger L的日志输出会遍历L和它父级中所有的appender，如果L的某个上级P，P设置了additivity=false，那么L的日志输出会遍历从L到P（不包括P）的所有appender。additivity默认为true。</p>
</li>
</ul>
<h3 id="logback初始化步骤">
  logback初始化步骤
  <a class="anchor" href="#logback%e5%88%9d%e5%a7%8b%e5%8c%96%e6%ad%a5%e9%aa%a4">#</a>
</h3>
<ol>
<li>在类路径下寻找名为logback-test.xml。</li>
<li>如果没找到，找名为logback.groovy的文件。</li>
<li>如果没找到，找名为logback.xml的文件。</li>
<li>如果没找到，会用ServiceLoader工具去解析<code>META-INF\services\ch.qos.logback.classic.spi.Configutator</code>路径下实现了Configurator接口的类</li>
<li>如果还没找到，logback会通过BasicConfigurator为自己进行配置，日志将会全部打印在控制台。</li>
</ol>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/oAuth/">oAuth</a>
    </h2>
    
  <h5>2021-08-20</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><ul>
<li>oAuth是一种授权机制，数据所有者告诉授权系统，允许第三方应用获取这些数据，授权系统从而产生一个短期的进入令牌（token），第三方应用通过令牌获取数据。</li>
</ul>
<h3 id="授权码方式">
  授权码方式
  <a class="anchor" href="#%e6%8e%88%e6%9d%83%e7%a0%81%e6%96%b9%e5%bc%8f">#</a>
</h3>
<p>第三方应用（记为a）访问CALLBACK_URL这个网站，会重定向到授权系统（记为b），url如1所示</p>
<h4 id="1-请求授权码">
  1. 请求授权码
  <a class="anchor" href="#1-%e8%af%b7%e6%b1%82%e6%8e%88%e6%9d%83%e7%a0%81">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>https:<span style="color:#f92672">//</span>b.com<span style="color:#f92672">/</span>oauth<span style="color:#f92672">/</span>authorize<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>  response_type<span style="color:#f92672">=</span>code<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">表示参数要求返回授权码</span>
</span></span><span style="display:flex;"><span>  client_id<span style="color:#f92672">=</span>CLIENT_ID<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">客户端</span>id<span style="color:#960050;background-color:#1e0010">，</span>b<span style="color:#960050;background-color:#1e0010">就知道是谁在请求</span>
</span></span><span style="display:flex;"><span>  redirect_uri<span style="color:#f92672">=</span>CALLBACK_URL<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span>b<span style="color:#960050;background-color:#1e0010">接收请求后跳转的网站</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">scope</span><span style="color:#f92672">=</span><span style="color:#66d9ef">read</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">授权范围</span>
</span></span></code></pre></div><h4 id="2-返回授权码">
  2. 返回授权码
  <a class="anchor" href="#2-%e8%bf%94%e5%9b%9e%e6%8e%88%e6%9d%83%e7%a0%81">#</a>
</h4>
<p>在授权系统登录成功后，会重定向到<code>CALLBACK_URL?code=AUTHORIZATION_CODE</code>，code就是授权码。</p>
<h4 id="3-请求令牌">
  3. 请求令牌
  <a class="anchor" href="#3-%e8%af%b7%e6%b1%82%e4%bb%a4%e7%89%8c">#</a>
</h4>
<p>CALLBACK_URL这个网站会重定向到授权系统，url如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>https:<span style="color:#f92672">//</span>b.com<span style="color:#f92672">/</span>oauth<span style="color:#f92672">/</span>token<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span> client_id<span style="color:#f92672">=</span>CLIENT_ID<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">客户端</span>id<span style="color:#960050;background-color:#1e0010">，</span>b<span style="color:#960050;background-color:#1e0010">就知道是谁在请求</span>
</span></span><span style="display:flex;"><span> client_secret<span style="color:#f92672">=</span>CLIENT_SECRET<span style="color:#f92672">&amp;</span> 
</span></span><span style="display:flex;"><span> grant_type<span style="color:#f92672">=</span>authorization_code<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">授权类型，表明是授权码</span>
</span></span><span style="display:flex;"><span> code<span style="color:#f92672">=</span>AUTHORIZATION_CODE<span style="color:#f92672">&amp;</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">上一步拿到的授权码</span>
</span></span><span style="display:flex;"><span> redirect_uri<span style="color:#f92672">=</span>CALLBACK_URL <span style="color:#f92672">#</span>b<span style="color:#960050;background-color:#1e0010">之后跳转的网站</span>
</span></span></code></pre></div><h4 id="4-返回令牌">
  4. 返回令牌
  <a class="anchor" href="#4-%e8%bf%94%e5%9b%9e%e4%bb%a4%e7%89%8c">#</a>
</h4>
<p>授权系统会重定向到CALLBACK_URL，并发送一段JSON数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;access_token&#34;</span>:<span style="color:#e6db74">&#34;ACCESS_TOKEN（令牌）&#34;</span>,  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;token_type&#34;</span>:<span style="color:#e6db74">&#34;bearer&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;expires_in&#34;</span>:<span style="color:#ae81ff">2592000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;refresh_token&#34;</span>:<span style="color:#e6db74">&#34;REFRESH_TOKEN&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;scope&#34;</span>:<span style="color:#e6db74">&#34;read&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;uid&#34;</span>:<span style="color:#ae81ff">100101</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;info&#34;</span>:{<span style="color:#960050;background-color:#1e0010">...</span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html">OAuth 2.0 的四种方式 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/6/" aria-label="Page 6" class="page-link" role="button">6</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Page 7" class="page-link" role="button">7</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 8" class="page-link" role="button">8</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Page 9" class="page-link" role="button">9</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  
<a href="https://beian.miit.gov.cn" target="_blank" style="color:gray;"></a>

 
      </footer>
    </div>

  </main>

</body>
</html>











