<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E8%B5%B7%E6%AD%A5/">python起步</a>
    </h2>
    
  <h5>2021-03-11</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="python基础">
  python基础
  <a class="anchor" href="#python%e5%9f%ba%e7%a1%80">#</a>
</h2>
<h3 id="数据类型和变量">
  数据类型和变量
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b%e5%92%8c%e5%8f%98%e9%87%8f">#</a>
</h3>
<ul>
<li>整数：可以是任意大小</li>
<li>浮点数：除了小数外还可以用科学计数法：1.23e9</li>
<li>字符串：以<code>&quot;</code>或<code>'</code>括起来的文本，python允许使用<code>r''</code>表示引号内部的字符串默认不转义，python允许用<code>'''...'''</code>的格式表示多行内容</li>
<li>布尔值：<code>True</code>或<code>False</code>，可以进行<code>and</code> <code>or</code> <code>not</code>运算</li>
<li>空值：<code>None</code>，不等于0</li>
<li>列表list：如<code>classmate=['xiaoming','lihua',123,True]</code>，list是一个可变的有序表。
<ul>
<li>可以使用append函数追加到末尾</li>
<li>可以使用insert（i，参数）插入到指定位置</li>
<li>删除末尾元素使用pop（），删除指定位置元素用pop（i）</li>
</ul>
</li>
<li>元组tuple：<code>classmate=('xiaoming','lihua',123,True)</code>，一旦初始化就不能修改
<ul>
<li>当只有一个元素要这么定义：<code>classmate=('hel',)</code></li>
</ul>
</li>
<li>字典dict：<code>d = {'Michael': 95, 'Bob': 75, 'Tracy': 85}</code>键值对
<ul>
<li>可以通过get(key)或d[key]获取值</li>
<li>可以通过d[key]=xxx直接赋值</li>
<li>可以通过pop(key)删除键值对</li>
<li>可以通过in判断key是否存在</li>
<li>key必须是不可变对象</li>
</ul>
</li>
<li>set：要创建一个set，需要一个list作为输入集合，
<ul>
<li>set是一组key的集合，无序，不重复。</li>
<li>add(xxx)可以向set里面加元素，remove(xxx)可以删除元素</li>
</ul>
</li>
<li>变量：可以把任意类型数据赋值给同一个变量（不同类型也可以）</li>
<li>常量：用全大写的变量名表示常量是一个习惯上的用法。</li>
<li>除法：python中有两种除法，一种是<code>/</code>：计算结果是浮点数，一种是<code> //</code>：计算结果是整数（这种称为地板除），python还提供了余数运算：<code>%</code></li>
</ul>
<h3 id="字符串和编码">
  字符串和编码
  <a class="anchor" href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%92%8c%e7%bc%96%e7%a0%81">#</a>
</h3>
<ul>
<li>在计算机内存中，统一使用unicode编码，当需要保存到硬盘或者传输的时候，就会转化为UTF-8编码</li>
<li>用记事本编辑时，从文件中读取的UTF-8会被转化为Unicode字符到内存中</li>
<li>python3字符串是以unicode编码的，可以通过<code>ord()</code>获取字符串的整数表示，<code>chr()</code>把编码转换为对应的字符</li>
<li>当这么写时-&gt;<code>b'ABC'</code>表示bytes类型，每个字符只占一个字节。</li>
<li>以Unicode表示的字符串通过ecnode()方法可以编码位指定的bytes，如<code>'中文'.encode('utf-8')</code></li>
<li><code>len('xxx')</code>可以知道包含了几个字符。</li>
</ul>
<h3 id="结构">
  结构
  <a class="anchor" href="#%e7%bb%93%e6%9e%84">#</a>
</h3>
<h4 id="选择结构非0非空字符串非空list就表示true">
  选择结构:非0，非空字符串、非空list就表示True
  <a class="anchor" href="#%e9%80%89%e6%8b%a9%e7%bb%93%e6%9e%84%e9%9d%9e0%e9%9d%9e%e7%a9%ba%e5%ad%97%e7%ac%a6%e4%b8%b2%e9%9d%9e%e7%a9%balist%e5%b0%b1%e8%a1%a8%e7%a4%batrue">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> age <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">18</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;adult&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> age <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">6</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;teenager&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;kid&#39;</span>)
</span></span></code></pre></div><h4 id="循环结构">
  循环结构
  <a class="anchor" href="#%e5%be%aa%e7%8e%af%e7%bb%93%e6%9e%84">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#0~100</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">101</span>):
</span></span><span style="display:flex;"><span>    sum <span style="color:#f92672">=</span> sum <span style="color:#f92672">+</span> x
</span></span><span style="display:flex;"><span>print(sum)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">99</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>    sum <span style="color:#f92672">=</span> sum <span style="color:#f92672">+</span> n
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>print(sum)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#break和continue也有</span>
</span></span></code></pre></div><h3 id="函数">
  函数
  <a class="anchor" href="#%e5%87%bd%e6%95%b0">#</a>
</h3>
<ul>
<li>python内置了很多函数，可以直接调用，如print、input、len、max、int、float、str、bool等</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_abs</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>x
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">#空函数，pass也可用在其他地方，如if里面</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nop</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><ul>
<li>可以返回多个值，会转化成tuple</li>
<li>函数参数中可以设置默认参数，必选参数必须放在默认参数前面</li>
<li>可以不按顺序提供部分默认参数，但要把参数名写上</li>
<li>定义可变参数是在参数前面增加一个*，如<code>def calc(*numbers)</code>
<ul>
<li>当已经有了list或tuple，要调用一个可变参数，可以<code>calc(*nums)</code></li>
</ul>
</li>
<li>关键字参数：<code>def person(name, age, **kw):</code>会在函数内部自动组装成一个dict
<ul>
<li>可以传入多个键值对，也可以传入一个dict（<code>person('Jack', 24, **extra)</code>）</li>
</ul>
</li>
<li>命名关键字参数：<code>def person(name, age, *, city, job):</code>
<ul>
<li>调用方式<code>person('Jack', 24, city='Beijing', job='Engineer')</code></li>
<li>命名关键字参数必须传入参数名</li>
</ul>
</li>
<li>上面这些都可以组合</li>
</ul>
<h2 id="其他">
  其他
  <a class="anchor" href="#%e5%85%b6%e4%bb%96">#</a>
</h2>
<ul>
<li>切片：<code>L[:2]</code>切出下标为0和1的元素</li>
<li>for in可用来迭代，判断是否可迭代可以用collections的Iterable类型判断。
<ul>
<li><code>isinstance('abc',Iterable)</code></li>
</ul>
</li>
<li>range(1:10)可用来生成1到9</li>
<li>列表生成器<code>[x*x for x in range(1,11) if x%2==0]</code></li>
<li>赋值语句<code>a, b = b, a</code>是通过tuple实现的，相当于<code>t = (b, a) a = t[0] b = t[1]</code></li>
<li>凡是可以作用于for循环的对象都是Iterable类型，凡是可作用于next()函数的对象都是Iterator类型</li>
<li>函数也是一个对象，函数对象可以赋值给变量。</li>
<li>任何代码的第一个字符串都被视为模块的文档注释，<code>__author__</code>变量可以把作者写进去</li>
<li>导入模块<code>import sys</code>，sys的argv变量用list存储了命令行的所有参数，argv的第一个参数是py文件的名称</li>
<li>类似<code>__xxx__</code>的变量是特殊变量，类似<code>_xxx_</code>和<code>_xxx</code>的变量是非公开变量（private）。</li>
<li>命名类用UpperCamelCase（第一个字母大写，后面采用驼峰命名法），命名函数和方法采用lowercase_with_underscores（小写带下划线），</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E5%89%8D%E7%AB%AF/html/">html</a>
    </h2>
    
  <h5>2021-03-02</h5>



  

  
  <div>
    
      <a href="/tags/%E5%89%8D%E7%AB%AF/">前端</a>
  </div>
  




    <p><h2 id="head">
  head
  <a class="anchor" href="#head">#</a>
</h2>
<ul>
<li>
<p><code>&lt;meta&gt;</code>:元数据就是描述数据的地方</p>
<ul>
<li>
<p><code>&lt;meta charset=&quot;utf-8&quot;&gt;</code>：指定文档中字符的编码。</p>
</li>
<li>
<p>添加作者描述和该网页的描述，这些数据会被搜索引擎解析。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xiaoxiang&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;description&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A learning notes,about java,git,etc&#34;</span>
</span></span></code></pre></div><p><code>&lt;meta name=&quot;keywords&quot; content=&quot;xxx&quot;&gt;</code>：keywords关键字已不再使用了。因为该关键字是提供给搜索引擎，搜索引擎根据不同的关键字找到相关网站，但是有些网站填充了大量的关键字到keyword，错误的引导了搜索结果。</p>
</li>
</ul>
</li>
<li>
<p><code>&lt;link rel=&quot;shortcut icon&quot;  href=&quot;favicon.ico&quot;&gt;</code>：添加网页图标</p>
</li>
<li>
<p><code>&lt;link rel=&quot;stylesheet&quot;  href=&quot;index.css&quot;&gt;</code>：添加样式表</p>
</li>
<li>
<p><code>&lt;html lang=&quot;zh-CN&quot;&gt;</code>：为站点设置语言，如果该项设置了，网站就会被搜索引擎更好的索引（如允许他在不同的语言中正确显示）。也可在在其他标签中设置该属性<code>&lt;span lang=&quot;en&quot;&gt;小象&lt;/span&gt;</code>。</p>
</li>
</ul>
<h2 id="body">
  body
  <a class="anchor" href="#body">#</a>
</h2>
<ul>
<li><code>&lt;em&gt;</code>：emphasis斜体显示。</li>
<li><code>&lt;a href=&quot;mailto:example@example.com,exp@exp.com?cc=exp2@exp2.com&amp;subject=hello&amp;body=hi&quot;&gt;向example和exp发邮件&lt;/a&gt;</code>当点击一个链接或按钮时，打开一个新的电子邮件发送信息而不是连接到一个资源（邮件地址可为空，表示打开电子邮件）,cc表示抄送，subject表示主题，body表示主体，每个字段的值必须是URL编码的，即不能有非打印字符，中文要转意成%xx的形式。</li>
<li>列表
<ul>
<li><code>&lt;ol&gt;</code>:ordered list</li>
<li><code>&lt;ul&gt;</code>:unordered list</li>
<li><code>&lt;dl&gt;</code>:description list</li>
<li><code>&lt;li&gt;</code>:list item</li>
<li><code>&lt;dt&gt;</code>:description term</li>
<li><code>&lt;dd&gt;</code>definition description</li>
</ul>
</li>
<li><code>&lt;abbr&gt;</code>:Abbreviation缩写    例：<span>我们使用<abbr title="超文本标记语言（Hyper text Markup Language）">HTML</abbr>来组织文档。</span></li>
<li><code>&lt;address&gt;</code>：标记联系方式的元素。</li>
<li><code>&lt;code&gt; &lt;pre&gt; &lt;var&gt; &lt;kbd&gt; &lt;samp&gt;</code>：用于展示计算机代码。</li>
<li><code>&lt;time datetime=&quot;2021-03-10&quot;&gt;2021年3月10日&lt;/time&gt;</code>：标记时间，可供机器识别格式。</li>
<li>一个block形式展现的块级元素不会被嵌套进内联元素中，但可以嵌套在其他块级元素中。</li>
</ul>
<p>
  <a href="https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Introduction_to_HTML/Document_and_website_structure">https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Introduction_to_HTML/Document_and_website_structure</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/http/HTTP/">http</a>
    </h2>
    
  <h5>2021-02-28</h5>



  

  
  <div>
    
      <a href="/tags/http/">http</a>
  </div>
  




    <p><h2 id="http概述">
  HTTP概述
  <a class="anchor" href="#http%e6%a6%82%e8%bf%b0">#</a>
</h2>
<ul>
<li>HTTP是一种client-server协议，由客户端发出的消息叫request，被服务端响应的消息叫response。</li>
</ul>
<h3 id="http能控制什么">
  HTTP能控制什么
  <a class="anchor" href="#http%e8%83%bd%e6%8e%a7%e5%88%b6%e4%bb%80%e4%b9%88">#</a>
</h3>
<h4 id="一缓存">
  一、缓存
  <a class="anchor" href="#%e4%b8%80%e7%bc%93%e5%ad%98">#</a>
</h4>
<ul>
<li>常见的HTTP缓存只能存储GET响应。缓存的关键主要包括request method和目标url。</li>
</ul>
<h5 id="缓存控制http11定义的cache-control">
  缓存控制(HTTP/1.1定义的Cache-Control)
  <a class="anchor" href="#%e7%bc%93%e5%ad%98%e6%8e%a7%e5%88%b6http11%e5%ae%9a%e4%b9%89%e7%9a%84cache-control">#</a>
</h5>
<ul>
<li><code>Cache-Control:no-store</code> ：没有缓存。缓存中不得存储任何关于客户端请求和服务端响应的内容。每次由客户端发起的请求都会下载完整的响应内容。</li>
<li><code>Cache-Control:no-cache</code>：<strong>缓存但重新验证</strong>。此方式下，每次有关请求发出时，该请求会带有与本缓存相关的验证字段，服务端会验证请求中所描述的缓存是否过期，如未过期（返回状态码304），则使用本地缓存副本。</li>
<li><code>Cache-Control:private</code><strong>|</strong><code>Cache-Control:public</code> ：私有和公共缓存。private表示该响应是专用于某个用户的，中间人不能缓存此响应；public表示该缓存可以被任何中间人缓存。</li>
<li><code>Cache-Control:max-age=31536000</code>：过期。表示资源能被缓存的最大时间，max-age是距离请求发起的时间的秒数。</li>
<li><code>Cache-Control:must-revalidate</code>：验证方式。must-revalidate意味着在考虑使用一个陈旧的资源时，必须先验证它的状态，已过期的缓存将不被使用。</li>
<li><code>Pragme</code>是HTTP/1.0定义的一个header属性，请求头中包含Pragme的效果与<code>Cache-Control:no-cache</code>相同，但是HTTP响应头中没有明确定义这个属性。</li>
</ul>
<h6 id="vary响应">
  Vary响应
  <a class="anchor" href="#vary%e5%93%8d%e5%ba%94">#</a>
</h6>
<ul>
<li>Vary响应头决定了对后续的请求头，如何判断时请求一个新的资源还是使用缓存的文件。</li>
<li>当缓存服务器收到了一个请求，只有当前的请求和原始（缓存）的请求头跟缓存的响应头里的Vary都匹配，才能够使用缓存的响应。</li>
</ul>
<h4 id="二开放同源限制">
  二、开放同源限制
  <a class="anchor" href="#%e4%ba%8c%e5%bc%80%e6%94%be%e5%90%8c%e6%ba%90%e9%99%90%e5%88%b6">#</a>
</h4>
<ul>
<li>只有来自相同来源的网页才能够获取网站的全部信息。HTTP可以通过修改头部来开放这样的限制。</li>
</ul>
<h4 id="三认证">
  三、认证
  <a class="anchor" href="#%e4%b8%89%e8%ae%a4%e8%af%81">#</a>
</h4>
<ul>
<li>一些页面能被保护起来，仅让特定的用户进行访问。基本的认证功能可以直接通过HTTP提供。</li>
</ul>
<h4 id="四代理和隧道">
  四、代理和隧道
  <a class="anchor" href="#%e5%9b%9b%e4%bb%a3%e7%90%86%e5%92%8c%e9%9a%a7%e9%81%93">#</a>
</h4>
<ul>
<li>通常服务器或客户端都是处于内网，对外网隐藏真实IP。因此HTTP请求就要通过代理越过这个网络屏障。</li>
</ul>
<h5 id="正向代理">
  正向代理
  <a class="anchor" href="#%e6%ad%a3%e5%90%91%e4%bb%a3%e7%90%86">#</a>
</h5>
<ul>
<li>也可以叫网关，它存储并转发网络服务（如DNS、网页）以减少和控制大家使用的带宽。</li>
<li>正向代理代表客户端，可以隐藏客户端的身份。</li>
</ul>
<h5 id="反向代理">
  反向代理
  <a class="anchor" href="#%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86">#</a>
</h5>
<ul>
<li>
<p>反向代理代表服务器，可以隐藏服务器的身份。</p>
</li>
<li>
<p>作用：</p>
<ul>
<li>负载均衡：在多个服务器之间分发负载，</li>
<li>缓存静态内容：缓存静态内容，为服务器分担压力，</li>
<li>压缩：压缩和优化内容以加快传输的速度。</li>
</ul>
</li>
<li>
<p>代理可以将请求地址设置为自身的ip。</p>
</li>
<li>
<p><code>Forwarded</code>（标准化版本）首部包含了代理服务器的客户端的信息。</p>
<ul>
<li>语法：<code>Forwarded:by=&lt;identifier&gt;;for=&lt;identifier&gt;;host=&lt;host&gt;;proto=&lt;http|https&gt;</code></li>
<li>identifier可以是：①ip地址；②语义不明的标识符；③unknown。</li>
<li><code>by=&lt;identifier&gt;</code>该请求进入代理服务器的接口。</li>
<li><code>for=&lt;identifier&gt;</code>发起请求的客户端以及代理链中的一系列的代理服务器（这意味着要写多个for=）。</li>
<li><code>host=&lt;host&gt;</code>代理接收到的Host首部（Host请求指明了请求将要发送到的服务器主机名和端口号）的信息。</li>
<li><code>proto=&lt;http|https&gt;</code>表示发起请求时采用的何种协议。</li>
</ul>
</li>
<li>
<p><code>X-Forwarded-For</code>：在客户端访问服务器的过程中，如果需要经过HTTP代理或者负载均衡服务器，可以使用该参数来获取最初发起请求的客户端的IP地址。</p>
<ul>
<li>语法：<code>X-Forwarded-For:&lt;client&gt;,&lt;proxy1&gt;,&lt;proxy2&gt;...</code>。</li>
<li>第一个参数表示客户端的IP地址，如果一个请求经过了多个代理服务器，那么每一个代理服务器的IP都会被依次记录在内。</li>
</ul>
</li>
<li>
<p><code>X-Forwarded-Host</code>：用来确定客户端发起请求中使用Host指定的初始域名</p>
<ul>
<li><code>Host</code>：Host请求头指明了请求将要发送到的服务器的主机名和端口号，所有<strong>HTTP/1.1请求报文中必须包含一个Host头字段</strong>。</li>
</ul>
</li>
<li>
<p><code>X-Forwarded-Proto</code>：用来确定客户端与代理服务器或者负载均衡服务器之间连接所采用的传输协议。</p>
</li>
</ul>
<h3 id="http报文">
  HTTP报文
  <a class="anchor" href="#http%e6%8a%a5%e6%96%87">#</a>
</h3>
<ul>
<li>headers中以x开头的都不是http标准协议</li>
</ul>
<h4 id="http请求组成">
  http请求组成
  <a class="anchor" href="#http%e8%af%b7%e6%b1%82%e7%bb%84%e6%88%90">#</a>
</h4>
<ol>
<li>第一行包括请求方法及请求参数</li>
<li>接下来的行每一行都表示一个HTTP首部，为服务器提供关于所需数据的信息</li>
<li>一个空行</li>
<li>可选数据块，包含更多数据，主要被POST方法使用。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#一个http的动作，如下面的method
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#要获取的资源路径，如下面的/chat
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#HTTP协议版本号
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">GET</span> /chat <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#Headers，为服务器表达其他的信息</span>
</span></span><span style="display:flex;"><span>#Host指明了要发送到的服务器主机名和端口号，如果没有包含端口号，会自动使用请求服务的默认端口。
</span></span><span style="display:flex;"><span>Host: xiaoxiang.space
</span></span><span style="display:flex;"><span>#指明了client的应用类型，操作系统、软件开发商及版本号
</span></span><span style="display:flex;"><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0
</span></span><span style="display:flex;"><span>#告知服务器客户端可以处理的内容类型，采用mime来表示，;q=表示前面这个类型权重因子，没写就默认是1
</span></span><span style="display:flex;"><span>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span style="display:flex;"><span>#客户端声明其能理解的自然语言
</span></span><span style="display:flex;"><span>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
</span></span><span style="display:flex;"><span>#会将客户端能够理解的内容编码方式通知给服务端。对应Content-Encoding
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>#指示资源的MIME类型，下面这是post请求的默认格式
</span></span><span style="display:flex;"><span>Content-Type: application/x-www-form-urlencoded; charset=UTF-8
</span></span><span style="display:flex;"><span>#加了这个就是ajax异步请求
</span></span><span style="display:flex;"><span>X-Requested-With: XMLHttpRequest
</span></span><span style="display:flex;"><span>#用来指明发送给服务器的消息主体的大小
</span></span><span style="display:flex;"><span>Content-Length: 22
</span></span><span style="display:flex;"><span>#指示了请求来自哪个站点。仅展示服务器名称，不包含任何路径。
</span></span><span style="display:flex;"><span>#除了不包含任何路径，该字段与Referer类型。
</span></span><span style="display:flex;"><span>Origin: https://developer.mozilla.org
</span></span><span style="display:flex;"><span>#决定当前的事务完成后，是否会关闭网络连接，如果是keep-alive，网络连接就是持久的，使得对同一个服务器的请求可以继续在该连接上完成
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>#表示当前页面的来源页面的地址。如果当前页面采用的是非安全协议而来源页面采用的是安全协议时Referer不会被发送。
</span></span><span style="display:flex;"><span>Referer: http://xiaoxiang.space/index
</span></span><span style="display:flex;"><span>#是由先前服务器通过Set-Cookie首部投放并存储到客户端。
</span></span><span style="display:flex;"><span>Cookie: JSESSIONID=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#对于一些POST这样的方法，报文的body也包含了发送的资源
</span></span><span style="display:flex;"><span>username=xxx&amp;comment=xxx
</span></span></code></pre></div><h4 id="http响应组成">
  HTTP响应组成
  <a class="anchor" href="#http%e5%93%8d%e5%ba%94%e7%bb%84%e6%88%90">#</a>
</h4>
<ol>
<li>第一行是状态行，包括使用HTTP协议版本，状态码和一个状态描述。</li>
<li>接下来的每一行都表示一个HTTP首部，为客户端提供所发送数据的一些信息。</li>
<li>一个空行</li>
<li>最后一行是数据库，包含了响应的数据</li>
</ol>
<pre tabindex="0"><code>#一个HTTP协议版本号
#一个状态码
#一个状态信息，我这个请求中居然没有？？？
HTTP/1.1 200 
#HTTP headers
#用来向客户端发送cookie，expires表示过期时间
Set-Cookie: xiaoxiang.space=1; Max-Age=3600; Expires=Tue, 23-Mar-2021 11:21:23 GMT
Content-Type: application/json
#指明了将entity安全传递给用户的编码形式，chunked表示数据以一系列分块的形式发送，这种情况下不发送Content-Length。
Transfer-Encoding: chunked
#包含了报文创建的日期和时间。
Date: Tue, 23 Mar 2021 10:21:23 GMT
#需要将Connection首部设为keep-alive这个首部才有意义，可以设置超时时长和最大请求数。
#HTTP/2中Connection和Keep-Alive是被忽略的。
Keep-Alive: timeout=20
Connection: keep-alive

#下面是响应的数据
xxx
</code></pre><p><strong>参考链接：</strong>
  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">HTTP Headers - HTTP | MDN</a></p>
<ul>
<li>HTTP消息是服务器和客户端之间交换数据的方式，有两种类型的消息：请求和响应。</li>
</ul>
<h3 id="http的连接管理">
  HTTP的连接管理
  <a class="anchor" href="#http%e7%9a%84%e8%bf%9e%e6%8e%a5%e7%ae%a1%e7%90%86">#</a>
</h3>
<p>
  <img src="/img/web/1.png" alt="HTTP连接管理" /></p>
<h4 id="短连接">
  短连接
  <a class="anchor" href="#%e7%9f%ad%e8%bf%9e%e6%8e%a5">#</a>
</h4>
<ul>
<li>HTTP/1.0的默认模型，每一次HTTP请求之前都会有一次TCP握手。在HTTP/1.1中，当<code>Connection</code>被设为<code>Close</code>才会用到这个模型。</li>
</ul>
<h4 id="长连接">
  长连接
  <a class="anchor" href="#%e9%95%bf%e8%bf%9e%e6%8e%a5">#</a>
</h4>
<ul>
<li>HTTP/1.1中默认就是长连接，一个长连接会保持一段时间，重复用于发送一系列请求，节省了新建TCP连接握手的时间，这个连接会在空闲一段时间后关闭（通过设置<code>Keep-Alive</code>来指定一个最小的连接保持时间），长连接会消耗服务器资源（毕竟是TCP）。</li>
</ul>
<h4 id="流水线">
  流水线
  <a class="anchor" href="#%e6%b5%81%e6%b0%b4%e7%ba%bf">#</a>
</h4>
<ul>
<li>默认情况下HTTP请求是按顺序发出的，下一个请求只有在当前请求收到应答后才会被发出。而流水线是在同一条长链上发出连续的请求。想象很美好，现实很残酷，流水线受制于很多问题。</li>
</ul>
<h3 id="一个post请求的java程序">
  一个post请求的java程序
  <a class="anchor" href="#%e4%b8%80%e4%b8%aapost%e8%af%b7%e6%b1%82%e7%9a%84java%e7%a8%8b%e5%ba%8f">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test3</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        URL url <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> URL<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://xiaoxiang.space/login/&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        HttpURLConnection connection <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>HttpURLConnection<span style="color:#f92672">)</span> url<span style="color:#f92672">.</span><span style="color:#a6e22e">openConnection</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//用户可以输出到该URLConnection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setDoOutput</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        String param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;password=&#34;</span> <span style="color:#f92672">+</span> URLEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;小象&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//request headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;POST&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Accept&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;text/html&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;User-Agent&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Type&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;application/x-www-form-urlencoded; charset=UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//general headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connection&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;close&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//entity headers，必须放在request headers和general headers后面，否则会报错
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>param<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span>StandardCharsets<span style="color:#f92672">.</span><span style="color:#a6e22e">UTF_8</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//关闭重定向，可以打开试一试
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">setInstanceFollowRedirects</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">connect</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n响应头：&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connection<span style="color:#f92672">.</span><span style="color:#a6e22e">getHeaderFields</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">((</span>k<span style="color:#f92672">,</span> v<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>k <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> v<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//如果有网页的话会输出该网页
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        InputStream inputStream <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Scanner scanner <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Scanner<span style="color:#f92672">(</span>inputStream<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">nextLine</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/http/url/">url</a>
    </h2>
    
  <h5>2021-02-23</h5>



  

  
  <div>
    
      <a href="/tags/http/">http</a>
  </div>
  




    <p><h2 id="url参数get">
  url参数（get）
  <a class="anchor" href="#url%e5%8f%82%e6%95%b0get">#</a>
</h2>
<ul>
<li>每个参数都是键值对，用&amp;分开</li>
<li>字符a-z，A-Z，0-9，<code>. - * _</code>不变。</li>
<li>用<code>+</code>替换空格。</li>
<li>将其他所有字符编码为UTF-8，并将每个字节都编码为%后跟一个两位的16进制数字。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/http/mime/">mime</a>
    </h2>
    
  <h5>2021-02-19</h5>



  

  
  <div>
    
      <a href="/tags/http/">http</a>
  </div>
  




    <p><ul>
<li>MIME：multipurpose internet mail extensions媒体类型</li>
<li>浏览器通常使用mime类型来确定如何处理url</li>
</ul>
<h2 id="语法">
  语法
  <a class="anchor" href="#%e8%af%ad%e6%b3%95">#</a>
</h2>
<h3 id="通用结构">
  通用结构
  <a class="anchor" href="#%e9%80%9a%e7%94%a8%e7%bb%93%e6%9e%84">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>#大小写不敏感
</span></span><span style="display:flex;"><span>type/subtype
</span></span></code></pre></div><h3 id="类型">
  类型
  <a class="anchor" href="#%e7%b1%bb%e5%9e%8b">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>#text表明是普通文本
</span></span><span style="display:flex;"><span>text/html 
</span></span><span style="display:flex;"><span>text/css
</span></span><span style="display:flex;"><span>text/xml
</span></span><span style="display:flex;"><span>#image表示是某种图像（包括动态图片）
</span></span><span style="display:flex;"><span>image/jpeg
</span></span><span style="display:flex;"><span>image/png
</span></span><span style="display:flex;"><span>#applicaiton表示是某种二进制数据
</span></span><span style="display:flex;"><span>application/pdf
</span></span><span style="display:flex;"><span>application/json
</span></span><span style="display:flex;"><span>text/javascript
</span></span><span style="display:flex;"><span>#audio表示是某种音频文件
</span></span><span style="display:flex;"><span>#video表示是某种视频文件
</span></span><span style="display:flex;"><span>#multipart表示细分领域的文件类型的种类
</span></span><span style="display:flex;"><span>#...
</span></span></code></pre></div><h3 id="部分mime类型介绍">
  部分MIME类型介绍
  <a class="anchor" href="#%e9%83%a8%e5%88%86mime%e7%b1%bb%e5%9e%8b%e4%bb%8b%e7%bb%8d">#</a>
</h3>
<ul>
<li><code>application/octet-stream</code>：这是应用程序的默认值，意思是未知的应用程序文件。</li>
<li><code>text/plain</code>文本的默认值</li>
<li><code>text/css</code>：网页中要被解析为css的任何css文件必须指定MIME为<code>text/css</code>。</li>
</ul>
<p><strong>参考链接：</strong>
  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types">MIME类型</a> | 
  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types">常见MIME类型列表</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">linux命令总结</a>
    </h2>
    
  <h5>2021-02-08</h5>



  

  
  <div>
    
      <a href="/tags/linux/">linux</a>
  </div>
  




    <p><h2 id="linux指令执行过程">
  linux指令执行过程
  <a class="anchor" href="#linux%e6%8c%87%e4%bb%a4%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b">#</a>
</h2>
<ul>
<li>linux在下达一个指令时，会按照以下的顺序寻找（所以当直接在bash中输入xxx.sh时是不会执行的）：
<ol>
<li>以相对/绝对路径执行指令如/bin/ls，或./ls。</li>
<li><code>alias lm='ls -al'</code>：给命令设定别名；<code>alias</code>：可以查看系统的所有别名；使用<code>unalias lm</code>取消别名。</li>
<li>由bash内建的指令来执行。</li>
<li>通过$PATH这个变量的顺序搜寻到第一个指令来执行。</li>
</ol>
</li>
<li>使用<code>which</code>指令可定位到程序的位置。</li>
</ul>
<h2 id="linux进程">
  linux进程
  <a class="anchor" href="#linux%e8%bf%9b%e7%a8%8b">#</a>
</h2>
<ul>
<li>
<p>进程（process）：程序被触发后，执行者的权限与属性、程序及程序所需的数据都会被加载到内存中，操作系统给与这个内存内的单元一个标识符PID。</p>
</li>
<li>
<p>当登入系统后，会取得一个bash，当使用这个bash提供的接口去执行另一个指令时，另外执行的指令也会生成PID，这个新进程就是子进程，而原来的bash环境就是父进程。linux中进程通常由父进程以复制(fork)的方式产生一个一摸一样的子进程，然后被复制出来的子进程再以exec的方式来执行实际要进行的程序，最终就会成为一个子进程。</p>
<ol>
<li>系统先以fork的方式复制一个与父进程相同的暂存进程，这个进程与父进程唯一的差别就是PID不同，此外这个暂存进程还会多一个PPID（parient pid）的参数。</li>
<li>暂存进程开始以exec的方式加载实际要执行的程序。</li>
</ol>
</li>
<li>
<p>常驻内存中的进程通常提供一些功能以服务用户，因此这些常驻程序就会被称为：服务（daemon）。</p>
</li>
</ul>
<h2 id="lspci-获取本机pci相关信息">
  lspci 获取本机PCI相关信息
  <a class="anchor" href="#lspci-%e8%8e%b7%e5%8f%96%e6%9c%ac%e6%9c%bapci%e7%9b%b8%e5%85%b3%e4%bf%a1%e6%81%af">#</a>
</h2>
<ul>
<li><code>lspci -tv</code>显示PCI树和树上设备的名称。</li>
<li><code>lspci -vvvs bus:device.function</code> 显示此设备的配置空间，-vvv也可以是-vv，信息会少一点。例：<code>lspci -vvvs 2c:00.0</code>。</li>
<li><code>lspci -xxxxs bdf</code> 以十六进制显示PCI设备的配置空间。</li>
<li><code>lspci -vvv</code> 获取所有设备的配置空间。</li>
</ul>
<h2 id="setpci-设置pcie配置空间">
  setpci 设置PCIe配置空间
  <a class="anchor" href="#setpci-%e8%ae%be%e7%bd%aepcie%e9%85%8d%e7%bd%ae%e7%a9%ba%e9%97%b4">#</a>
</h2>
<ul>
<li><code>setpci -s b:d.f reg.[B|W|L]=value</code> 写PCIe配置空间reg寄存器的值，其中B表示一个字节，W表示两个字节，L表示四个字节。例：<code>setpci -s 60:03.1 0x60.b=0x57</code></li>
</ul>
<h2 id="dmidecode-获取smbios信息">
  dmidecode 获取SMBIOS信息
  <a class="anchor" href="#dmidecode-%e8%8e%b7%e5%8f%96smbios%e4%bf%a1%e6%81%af">#</a>
</h2>
<ul>
<li><code>dmidecode -t9</code>获取主机槽位信息。</li>
</ul>
<h2 id="ext4文件系统调试">
  ext4文件系统调试
  <a class="anchor" href="#ext4%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%b0%83%e8%af%95">#</a>
</h2>
<ul>
<li>获取文件的inode<code>ls -ila</code>。</li>
<li>读取文件的inode信息<code>stat /etc/passwd</code>（需要指定全路径）。</li>
<li>获取inode所在的block位置<code>debugfs /dev/sda1 -R &quot;imap &lt;6029951&gt;&quot; | tee</code>。</li>
<li>将十六进制转为十进制并显示<code>echo $((0x4002))</code>。</li>
<li>获取文件系统类型<code>df -Th</code>。-T表示打印文件系统Type。通过<code>df -i</code>还能看到文件系统当前的inode总数和剩余inode数量。</li>
<li>根据inode号获取inode信息和data block的位置<code>debugfs /dev/sda1 -R &quot;stat &lt;6029951&gt;&quot; | tee</code>，使用tee看起来更直观。</li>
<li>查看super block和group descriptors的信息<code>dump2fs /dev/sda1</code>。</li>
<li>读取磁盘指定block位置的数据<code>dd if=/dev/sda1  bs=4096 count=1 skip=6327982</code>，其中if表示输入文件，bs表示块大小，count表示几个快，skip表示跳过多少块。可以使用xxd来显示十六进制<code> dd if=/dev/sda1  bs=4096 count=1 skip=6327982 | xxd</code>。</li>
<li>文件被删除后，在目录下是看不到该文件的，但是该文件的inode信息其实还存放在目录中，可以通过如下命令拿到文件的inode号<code>debugfs /dev/sdd3 -R &quot;ls -d /dir1&quot;</code>（注意，此路径不是挂载的全路径，而是直接从文件系统的根路径开始）。</li>
<li>删除文件只是将文件inode中的block数组给置零了，文件内容其实没有删除。</li>
<li>例（查看inode的extent信息）：
<ol>
<li>使用<code>ls -li</code>获取inode number。<br>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/3.jpg" alt="" /></li>
<li>查看此inode的信息。<code> debugfs /dev/sda1 -R &quot;stat &lt;1573164&gt;&quot;</code><br>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/4.jpg" alt="" /></li>
<li>或取此inode所在的块。<code>debugfs /dev/sda1 -R &quot;imap &lt;1573164&gt;&quot; | tee</code><br>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/5.jpg" alt="" /></li>
<li>根据块号和偏移量找到相应的inode的数据。<code>dd if=/dev/sda1 count=1 bs=4096 skip=6291506 |xxd</code><br>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/6.jpg" alt="" /><br>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/7.jpg" alt="" /></li>
<li>解析后的结果如下：</li>
</ol>
</li>
</ul>
<pre tabindex="0"><code>//0af3 0400 0400 0000 0000 0000
ext4_extent_header 
{
	eh_magic = 0xF30A //magic number 2byte
	eh_entries = 4	//header之后的entry数量 2byte
	eh_max = 4	//header之后最大的entry数量 2byte
	eh_depth = 0	//树的深度 2byte
	eh_generation = 0
}

//第一个extent 0000 0000 0004 0000 0094 0a00 
struct ext4_extent
{
	ee_block = 0	//当前是第几个块（这里的块和文件系统的块不同） 4byte
	ee_len = 1024	//多少个块 2byte
	ee_start_hi = 0	//块号高16位 2byte
	ee_start_lo = 693248	//块号低16位 4byte
}

//第二个extent 0004 0000 0004 0000 00d4 0a00
struct ext4_extent
{
	ee_block = 1024	//当前是第几个块（这里的块和文件系统的块不同） 4byte
	ee_len = 1024	//多少个块 2byte
	ee_start_hi = 0	//块号高16位 2byte
	ee_start_lo = 709632	//块号低16位 4byte
}

//第三个extent 0008 0000 0020 0000 00e0 0a00
struct ext4_extent
{
	ee_block = 2048	//当前是第几个块（这里的块和文件系统的块不同） 4byte
	ee_len = 8192	//多少个块 2byte
	ee_start_hi = 0	//块号高16位 2byte
	ee_start_lo = 712704	//块号低16位 4byte
}
</code></pre><h2 id="vim-文本编辑工具">
  vim 文本编辑工具
  <a class="anchor" href="#vim-%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%b7%a5%e5%85%b7">#</a>
</h2>
<p>通过配置~/.vimrc（不建议修改/etc/vimrc）可以设定一些vim的属性，在vim的命令模式输入<code>:set all</code>可以查到</p>
<ul>
<li><code>ctrl+f</code>向下移动一页</li>
<li><code>ctrl+b</code>向上移动一页</li>
<li><code>0或者home</code>移动到这一列的最前面</li>
<li><code>$或end</code>移到这一列最后一页</li>
<li><code>G(注意是大写)</code>移到文件的最后一列</li>
<li><code>gg</code>移到文件的第一行</li>
<li><code>n+enter</code>光标向下移动n行</li>
<li><code>/word</code>搜索为名称为word的字符串</li>
<li><code>:1,2s/word1/word2/g</code>[第一行，第二行]中所有的word1被替换成word2</li>
<li><code>:1,$s/word1/word2/g</code>第一行到最后一行所有word1被替换为word2</li>
<li><code>:1,$s/word1/word2/gc</code>第一行到最后一行所有word1被替换为word2，且在取代前会提示字符给用户确认</li>
<li><code>dd</code>删除当前一整行，<code>ndd</code> 删除光标所在的向下n行</li>
<li><code>yy</code>复制一整行，<code>4yy </code>复制4行。</li>
<li><code>p</code>将复制的数据在光标的下一行粘贴，<code>P</code>在光标的上一行粘贴</li>
<li><code>u</code>复原前一个动作</li>
<li><code>ctr+r</code>重复上一个动作</li>
<li><code>:w [filename]</code>将文件另存为</li>
<li><code>:set nu/nonu</code>开启/关闭行号</li>
<li><code>:set ic</code> 忽视大小写</li>
</ul>
<h2 id="nmcli-网络配置工具">
  nmcli 网络配置工具
  <a class="anchor" href="#nmcli-%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li>
<p>目前主流网卡为使用以太网络协议开发出来的以太网卡（Ethernet），所以linux称呼这种网络接口为ethN（N为数字）。新的centos7对网卡的编号有另一套规则，网卡待会现在与网卡的来源有关：eno1（BIOS内建的网卡），ens1（BIOS内建的PCI-E网卡），enp2s0（PCI-E）界面的独立网卡。</p>
</li>
<li>
<p>nmcli可用来设置ip、dns等配置，与直接修改/etc/sysconfig/network-scripts/ifcfg-xxx（centos7）、/etc/NetworkManager/system-connections/ethernet-xxx（ubuntu18）等效。</p>
</li>
<li>
<p>一个网卡设备可以有多个配置，但是只能有一个为激活状态，多个配置可以在不同的网络环境中切换。比如小明在公司用静态IP的方式连接到网络，在家用DHCP的方式连接网络，可以创建两个connections，一个叫static-conn，另一个叫dhcp-conn，当需要使用DHCP的方式时，执行<code>nmcli con up dhcp-conn</code>激活配置，当使用静态IP的方式时，执行<code>nmcli con static-conn</code>激活配置。</p>
</li>
</ul>
<p><code>nmcli connection {show | up |down| modify | add | edit |clone | delete |monitor | reload | load | import | export } ARGUMENTS...</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#为网卡enp0s8创建一个配置</span>
</span></span><span style="display:flex;"><span>nmcli connection add ifname enp0s8 type ethernet ipv4.method auto
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在一个交互式的窗口中为ethernet-enp0s8编写配置</span>
</span></span><span style="display:flex;"><span>nmcli connection edit ethernet-enp0s8
</span></span><span style="display:flex;"><span><span style="color:#75715e">#修改ethernet-enp0s8的网络参数</span>
</span></span><span style="display:flex;"><span>nmcli connection modify enp0s8 <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span>    connection.autoconnect yes <span style="color:#ae81ff">\ </span><span style="color:#75715e">#是否开机就启动这个配置</span>
</span></span><span style="display:flex;"><span>    ipv4.method manual <span style="color:#ae81ff">\ </span><span style="color:#75715e">#自动（DHCP）还是手动设定网络参数</span>
</span></span><span style="display:flex;"><span>    ipv4.addresses 192.168.x.x/24 <span style="color:#ae81ff">\ </span><span style="color:#75715e">#设定地址</span>
</span></span><span style="display:flex;"><span>    ipv4.gateway 192.168.x.x <span style="color:#ae81ff">\ </span><span style="color:#75715e">#设定网关</span>
</span></span><span style="display:flex;"><span>    ipv4.dns 192.168.x.x <span style="color:#75715e">#设定DNS</span>
</span></span><span style="display:flex;"><span>    ipv4.never-default yes <span style="color:#75715e">#设定不为默认路由</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#移除某个配置，只需要将该配置的值置为空</span>
</span></span><span style="display:flex;"><span>nmcli con modify ethernet-enp0s8 ipv4.dns <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为ethernet-enp0s8添加dns的配置（因为dns和ip能有多个配置，所以可以用+和-，不能有多个配置的不能用）</span>
</span></span><span style="display:flex;"><span>nmcli con modify ethernet-enp0s8 +ipv4.dns 8.8.8.8
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为ethernet-enp0s8删除ip的配置</span>
</span></span><span style="display:flex;"><span>nmcli con modify ethernet-enp0s8 -ipv4.addresses <span style="color:#e6db74">&#34;192.168.100.25/24&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#修改配置名称</span>
</span></span><span style="display:flex;"><span>nmcli connection modify ethernet-enp0s8 con-name 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#列出所有的配置。</span>
</span></span><span style="display:flex;"><span>nmcli connection show 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#仅列出激活状态的配置。</span>
</span></span><span style="display:flex;"><span>nmcli connection show --active
</span></span><span style="display:flex;"><span><span style="color:#75715e">#列出ethernet-enp0s8的配置。</span>
</span></span><span style="display:flex;"><span>nmcli connection show ethernet-enp0s8 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#激活enp0s8设备的配置。</span>
</span></span><span style="display:flex;"><span>nmcli connection up ifname enp0s8
</span></span><span style="display:flex;"><span><span style="color:#75715e">#激活名称为ethernet-enp0s8的配置。</span>
</span></span><span style="display:flex;"><span>nmcli connection up ethernet-enp0s8 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除ethernet-enp0s8的配置</span>
</span></span><span style="display:flex;"><span>nmcli connection delete ethernet-enp0s8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#导入一个openvpn的配置给networkmanager</span>
</span></span><span style="display:flex;"><span>nmcli con import type openvpn file ~/Downloads/frootvpn.ovpn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#增加一个ip地址（多ip地址）</span>
</span></span><span style="display:flex;"><span>nmcli c modify mark +ipv4.addresses  10.2.0.31/24
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#去掉一个ip地址</span>
</span></span><span style="display:flex;"><span>nmcli c modify mark +ipv4.addresses  10.2.0.31/24
</span></span></code></pre></div><h2 id="etcnetworkinterfaces网络配置">
  /etc/network/interfaces网络配置
  <a class="anchor" href="#etcnetworkinterfaces%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae">#</a>
</h2>
<ul>
<li>修改/etc/network/interfaces配置文件</li>
</ul>
<pre tabindex="0"><code>#指定 enp0s3 接口在启动时自动激活。
auto enp0s3
#指定 enp0s3 接口的配置方式为静态 IP 地址。
iface enp0s3 inet static
        address 192.168.1.110
        netmask 255.255.255.0
        gateway 192.168.1.1
</code></pre><ul>
<li>重启使配置生效</li>
</ul>
<h2 id="etcsysconfignetwork-scriptsifcfg-xxx配置介绍">
  /etc/sysconfig/network-scripts/ifcfg-xxx配置介绍
  <a class="anchor" href="#etcsysconfignetwork-scriptsifcfg-xxx%e9%85%8d%e7%bd%ae%e4%bb%8b%e7%bb%8d">#</a>
</h2>
<pre tabindex="0"><code>#最小配置
DEVICE=eth1  #网卡号，必须与文件名对应
ONBOOT=yes	#是否默认启动，要联网必须要配置
BOOTPROTO=none	#是否使用dhcp，是的话BOOTPROTO=dhcp
HWADDR=08:00:27:35:2F:f2	#mac地址
IPADDR=172.27.32.6	#ip地址
NETMASK=255.255.255.0	#子网掩码
GATEWAY=172.27.32.1	#网关
</code></pre><h2 id="firewall-cmd-centos7下的防火墙工具">
  firewall-cmd centos7下的防火墙工具
  <a class="anchor" href="#firewall-cmd-centos7%e4%b8%8b%e7%9a%84%e9%98%b2%e7%81%ab%e5%a2%99%e5%b7%a5%e5%85%b7">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#查看防火墙的状态</span>
</span></span><span style="display:flex;"><span>systemctl status firewalld
</span></span><span style="display:flex;"><span><span style="color:#75715e">#关闭防火墙并禁止开机自启</span>
</span></span><span style="display:flex;"><span>systemctl stop firewalld; systemctl disable firewalld
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启用防火墙并允许开机自启</span>
</span></span><span style="display:flex;"><span>systemctl start firewalld; systemctl enable firewalld
</span></span></code></pre></div><ul>
<li>
<p>防火墙的服务名为firewalld，centos7使用firewall-cmd来管理防火墙。</p>
</li>
<li>
<p>firewalld预先准备了几套防火墙策略集合（zone）。常见的zone：1. trusted允许所有的数据包；2. home；3. internal；4. work；5. public；6. external；7.dmz；8. block；9.drop。</p>
</li>
<li>
<p>常见命令：</p>
<ol>
<li>&ndash;get-default-zone查询默认的zone；- -set-default-zone设置默认的zone，&ndash;get-zones显示可用的zone；</li>
<li>&ndash;list-all显示当前区域的网卡配置参数、资源、端口及服务等信息； &ndash;list-all-zones显示所有区域的网卡配置参数、资源、端口及服务等信息；</li>
<li>&ndash;add-service=服务名、&ndash;remove-service=服务名；</li>
<li>&ndash;add-port=端口号/协议、&ndash;remove-port=端口号/协议；&ndash;list-ports列出已开放的端口。</li>
<li>&ndash;add-forward-port=port=源端口号:proto=协议:toport=目标端口号:toaddr:目标ip地址。</li>
<li>&ndash;panic-on/&ndash;panic-off启动/关闭应急状态，阻断一切网络连接。</li>
</ol>
</li>
<li>
<p>firewalld设置只在下次重启前有效，如果需要永久生效，需要加上&ndash;permanent模式，并执行firewall-cmd &ndash;reload。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#永久放开3306端口，并立刻生效</span>
</span></span><span style="display:flex;"><span>firewall-cmd --add-port 3306/tcp --permanent
</span></span><span style="display:flex;"><span>firewall-cmd --reload
</span></span><span style="display:flex;"><span><span style="color:#75715e">#永久拒绝192.168.10.0/24网段的所有用户访问本机的ssh服务。</span>
</span></span><span style="display:flex;"><span>firewall-cmd --permanent --zone<span style="color:#f92672">=</span>public --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#34;</span>ipv4<span style="color:#e6db74">&#34; source address=&#34;</span>192.168.10.0/24<span style="color:#e6db74">&#34; service name=&#34;</span>ssh<span style="color:#e6db74">&#34; reject&#34;</span>
</span></span></code></pre></div><h2 id="nmap">
  nmap
  <a class="anchor" href="#nmap">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nmap <span style="color:#f92672">[</span>扫描类型<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>扫描参数<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>主机地址<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>扫描类型：
</span></span><span style="display:flex;"><span>	-sS：扫描TCP，通过SYNACK报文判断
</span></span><span style="display:flex;"><span>	-sP：以ping的方式扫描
</span></span><span style="display:flex;"><span>	-sT：扫描TCP，通过建立tcp连接
</span></span><span style="display:flex;"><span>	-sU：扫描UDP
</span></span><span style="display:flex;"><span>扫描参数：
</span></span><span style="display:flex;"><span>	-p 扫描端口，如80，80-1023等
</span></span><span style="display:flex;"><span>主机地址：
</span></span><span style="display:flex;"><span>	如192.128.0.0/24，192.168.1.100，192.168.1.1-50，60-100
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>nmap -sS 10.2.4.2
</span></span></code></pre></div><h2 id="iptables">
  iptables
  <a class="anchor" href="#iptables">#</a>
</h2>
<ul>
<li>
<p>参考链接：
  <a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html">Iptables Tutorial 1.2.2 (frozentux.net)</a></p>
</li>
<li>
<p>REDIRECT用于将数据包转发到本机，数据包目的地址将映射到127.0.0.1地址，只能用于nat表的PREROUTING和OUTPUT。</p>
</li>
<li>
<p>iptables有4张表，每个表和其中的链用途如下：</p>
<ul>
<li>filter（过滤器）：主要跟进入Linux本机的数据包有关
<ul>
<li>INPUT：进入Linux的数据包</li>
<li>OUTPUT：Linux发出去的数据包</li>
<li>FORWARD：和Linux本机无关，他可以转发封包到后面的计算机</li>
</ul>
</li>
<li>nat（地址转换）：主要是进行IP或端口的转换：
<ul>
<li>PREROUTING：在进行路由判断之前要进行的规则(DNAT/REDIRECT)</li>
<li>POSTROUTING：在进行路由判断之后要进行的规则（SNAT/MASQUERADE）</li>
<li>OUTPUT：与发出去的数据包有关</li>
</ul>
</li>
<li>mangle（破坏者）</li>
<li>raw</li>
</ul>
</li>
<li>
<p>查看防火墙规则</p>
</li>
</ul>
<pre tabindex="0"><code>iptables [-t tables] [-L] [-nv]

-t 后面跟表名，默认为filter
-L 列出目前table的规则
-n 不获取HOSTNAME，速度快
-v 显示更多信息
--line-numbers 显示行号

结果介绍：
Chain那一行的括号里的policy就是预设的策略。
---
target：表示进行的动作，ACCEPT是放行，REJECT是拒绝，DROP是丢弃。
prot：表示协议，如tcp、udp、icmp。
in：表示输入网口
out：表述输出网口
source：表示此规则是针对哪个来源做处理
destination：表示此规则是针对哪个目标进行限制
说明栏：
</code></pre><ul>
<li>设定预设规则</li>
</ul>
<pre tabindex="0"><code>iptables [-t nat] -P [INPUT, OUTPUT, FORWARD] [ACCEPT, DROP]
</code></pre><ul>
<li>
  <img src="/img/linux/linux%e5%91%bd%e4%bb%a4/1.jpg" alt="" /></li>
</ul>
<h3 id="相关命令">
  相关命令
  <a class="anchor" href="#%e7%9b%b8%e5%85%b3%e5%91%bd%e4%bb%a4">#</a>
</h3>
<ul>
<li>删除进入的数据包</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#拒绝来自10.2.4.2 tcp20000端口的数据包，使用REJECT会返回一个port-unreachable的ICMP</span>
</span></span><span style="display:flex;"><span>iptables -A INPUT -s 10.2.4.2 -p tcp --dport <span style="color:#ae81ff">20000</span> -j REJECT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#拒绝来自10.2.4.5的数据，将此规则插入到链第二个节点</span>
</span></span><span style="display:flex;"><span>iptables -t filter -I  INPUT <span style="color:#ae81ff">2</span>  -s 10.2.4.5 -j REJECT
</span></span></code></pre></div><ul>
<li>数据包复制和重定向</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#（10.2.4.56主机）将5140 udp端口的数据复制一份到10.2.4.31上</span>
</span></span><span style="display:flex;"><span>iptables -t mangle -A PREROUTING  -p udp --dport <span style="color:#ae81ff">5140</span> -j TEE --gateway 10.2.4.31
</span></span><span style="display:flex;"><span><span style="color:#75715e">#（10.2.4.31主机）将目标IP地址为10.2.4.56、udp端口为5140的数据转发到本地的5141端口</span>
</span></span><span style="display:flex;"><span>iptables -t nat -A PREROUTING -d 10.2.4.56 -p udp --dport <span style="color:#ae81ff">5140</span>  -j REDIRECT --to-ports <span style="color:#ae81ff">5141</span>
</span></span></code></pre></div><ul>
<li>规则删除</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#删除nat表PREROUTING链的第二条规则</span>
</span></span><span style="display:flex;"><span>iptables -t nat -D PREROUTING <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h2 id="systemctl-管理unit">
  systemctl 管理unit
  <a class="anchor" href="#systemctl-%e7%ae%a1%e7%90%86unit">#</a>
</h2>
<ul>
<li>一般linux上的服务会在服务名后面加上一个d，这个d就表示daemon。</li>
<li>systemd将daemon执行脚本称为的一个unit。一般情况下安装的应用的unit都会放到<code>/usr/lib/systemd/system/</code>下；而在<code>/etc/systemd/system/</code>目录下会存放unit的一些配置。</li>
<li>unit有多种类型，包括 ①service：服务类型；②socket；③target：执行环境类型，是一群unit的集合；④mount、automount：文件系统挂载相关的服务；⑤path：侦测特定的文件或目录类型；⑥timer：循环执行的服务。常用的即使service和target，比如mysqld.service（mysql服务），firewalld.service（防火墙）。</li>
<li>通过systemctl可以管理unit，格式如下：<code>systemctl [command] [unit]</code>，其中command如下：
<ul>
<li>start：启动。例 <code>systemctl start mysqld.service</code>。</li>
<li>stop：停止。</li>
<li>enable：开机启动。例 <code>systemctl enable mysqld.service</code>。</li>
<li>disable：禁止开机启动。</li>
<li>status：unit的状态。</li>
<li>is-active：是否运行。</li>
</ul>
</li>
<li>执行<code>systemctl status xxx</code>，会显示该unit的状态。结果的第二行表示该服务是否会开机启动，结果的第三行表示该服务的当前状态。</li>
<li>一个daemon的预设状态有多个，包括：
<ul>
<li>enabled：这个daemon会在开机被执行。</li>
<li>disabled：这个daemon在开机不会被执行。</li>
<li>static：这个daemon不可以自己启动（即不能使用<code>systemctl enable xxx</code>来设置开机自启），但可以被其他的服务来唤醒。</li>
<li>mask：注销状态，这个daemon无法被启动，可以通过<code>systemctl unmask xxx</code>改会原来的状态。</li>
</ul>
</li>
<li><code>systemctl [list-units]</code>列出目前启动的unit；<code>systemctl list-units --all</code>列出所有的unit。<code>systemctl list-unit-files</code>列出所有已安装的unit。</li>
</ul>
<h3 id="unit文件说明">
  unit文件说明
  <a class="anchor" href="#unit%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e">#</a>
</h3>
<h4 id="unit">
  Unit
  <a class="anchor" href="#unit">#</a>
</h4>
<ul>
<li>Description： 当前unit的描述</li>
<li>Documentation：文档地址，可接受 &ldquo;<code>http://</code>&rdquo;,&quot;<code>https://</code>&quot;,&quot;<code>file:</code>&quot;,&quot;<code>info:</code>&quot;, &ldquo;<code>man:</code>&rdquo; 五种URI类型。</li>
<li>Requires：表示本unit和其他unit之间有强依赖关系。</li>
<li>Wants：是 <code>Requires=</code> 的弱化版。当此单元被启动时，所有这里列出的其他单元只是尽可能被启动。但是，即使某些单元不存在或者未能启动成功，也不会影响此单元的启动。推荐使用此选项来设置单元之间的依赖关系。</li>
<li>Before、After：强制指定unit的启动顺序，不涉及依赖关系。</li>
<li>OnFailure：接受一个空格分隔的单元列表，当单元启动失败时，将会启动列表中的单元。</li>
<li>相关链接：
  <a href="http://www.jinbuguo.com/systemd/systemd.unit.html">systemd.unit 中文手册</a></li>
</ul>
<h4 id="service类型的unit特有的的service">
  service类型的unit特有的的Service
  <a class="anchor" href="#service%e7%b1%bb%e5%9e%8b%e7%9a%84unit%e7%89%b9%e6%9c%89%e7%9a%84%e7%9a%84service">#</a>
</h4>
<ul>
<li>
<p>Type</p>
<ul>
<li>simple：如果设为 <code>simple</code> ，那么 <code>ExecStart=</code> 进程就是该服务的主进程，systemd 会认为在创建了该服务的主服务进程之后，该服务就已经启动完成。如果execStart指定的可执行文件不存在或User=的用户不存在，systemctl start也仍然会执行成功。除了simple之外的类型都需要等待服务完成初始化，所以可能减慢系统启动速度。</li>
<li>exec：和simple类似，但该服务只有在主服务的进程执行完成后，systemd才会认为该服务启动完成。<code>simple</code> 表示当 <code>fork()</code> 函数返回时，即算是启动完成，而<code>exec</code> 则表示仅在 <code>fork()</code> 与  <code>execve()</code> 函数都执行成功时，才算是启动完成。对于exec来说，如果不能成功调用主服务进程（如User不存在、后可执行文件不存在），则systemctl start会执行失败。</li>
<li>forking：ExecStart=进程将会在启动过程中使用 <code>fork()</code> 系统调用。也就是当所有通信渠道都已建好、启动亦已成功之后，父进程将会退出，而子进程将作为主服务进程继续运行。在这种情况下，systemd 会认为在父进程退出之后，该服务就已经启动完成。如果使用了此种类型，那么建议同时设置 <code>PIDFile=</code> 选项，以帮助 systemd 准确可靠的定位该服务的主进程。systemd 将会在父进程退出之后立即开始启动后继单元。</li>
<li>oneshot：只有当该服务的主服务进程退出后，systemd才会认为该服务启动完成。通常需要设置 RemainAfterExit=yes ，使、systemd 在服务进程退出之后仍然认为服务处于激活状态。</li>
<li><code>notify</code> 与 <code>exec</code> 类似，不同之处在于，该服务将会在启动完成之后通过 
  <a href="http://www.jinbuguo.com/systemd/sd_notify.html#">sd_notify(3)</a>之类的接口发送一个通知消息。</li>
<li><code>idle</code> 与 <code>simple</code> 类似，不同之处在于，服务进程将会被延迟到所有活动任务都完成之后再执行。这样可以避免控制台上的状态信息与shell脚本的输出混杂在一起。注意：(1)仅可用于改善控制台输出，切勿将其用于不同单元之间的排序工具；(2)延迟最多不超过5秒，超时后将无条件的启动服务进程。</li>
</ul>
</li>
<li>
<p>ExecStart：启动服务时需要执行的命令+参数。</p>
</li>
<li>
<p>ExecReload：用于设置该服务被要求重新载入配置时需要执行的命令行。有一个特殊的环境变量$MAINPID用于表示主进程的PID，可以这样使用<code>/bin/kill -HUP $MAINPID</code>。</p>
</li>
<li>
<p>ExecStop：用于设置服务被要求停止时所执行的命令行。</p>
</li>
<li>
<p>Restart：当服务经常正常退出、异常退出、被杀死、超时的时候，是否重新穷该服务。可以为on、on-success、on-failure、on-abnormal、on-watchdog、on-abort、always之一。默认是no。always表示服务会被无条件的重启，on-success表示仅在服务进程正常退出时重启，正常退出是指：退出代码为0或进程收到 SIGHUP, SIGINT, SIGTERM, SIGPIPE 信号之一， 并且 退出码符合 SuccessExitStatus= 的设置。on-failure 表示 仅在服务进程异常退出时重启， 所谓&quot;异常退出&quot; 是指： 退出码不为&quot;0&quot;， 或者 进程被强制杀死(包括 &ldquo;core dump&quot;以及收到 SIGHUP, SIGINT, SIGTERM, SIGPIPE 之外的其他信号)。</p>
</li>
<li>
<table>
<thead>
<tr>
<th>退出原因(↓) | Restart= (→)</th>
<th><code>no</code></th>
<th><code>always</code></th>
<th><code>on-success</code></th>
<th><code>on-failure</code></th>
<th><code>on-abnormal</code></th>
<th><code>on-abort</code></th>
<th><code>on-watchdog</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>正常退出</td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>退出码不为&quot;0&rdquo;</td>
<td></td>
<td>X</td>
<td></td>
<td>X</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>进程被强制杀死</td>
<td></td>
<td>X</td>
<td></td>
<td>X</td>
<td>X</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>systemd 操作超时</td>
<td></td>
<td>X</td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>看门狗超时</td>
<td></td>
<td>X</td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
<td>X</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>RestartSrc：设置在(Restart)前暂停多长时间，默认值为100ms，如果未指定时间单位，默认单位是秒。</p>
</li>
<li>
<p>相关链接：
  <a href="http://www.jinbuguo.com/systemd/systemd.service.html">systemd.service 中文手册</a></p>
</li>
</ul>
<h4 id="service">
  service
  <a class="anchor" href="#service">#</a>
</h4>
<ul>
<li>KillMode：设置单元停止时，杀死进程的方法：control-group、process、mixed、none。默认值是control-group。</li>
</ul>
<h4 id="install">
  install
  <a class="anchor" href="#install">#</a>
</h4>
<ul>
<li>WantedBy：表示在使用systemctl enable启用此单元时，将会在每个列表单元的.wants下创建一个指向该单元的软链接，相当于为每个列表中的单元文件添加了Wants=此单元选项，这样当单元启动时，该单元就会被启动。注：<code>multi-user.target</code>通常是包含在<code>graphical.target</code>中。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /usr/lib/systemd/system/nginx.service </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>forking
</span></span><span style="display:flex;"><span>PIDFile<span style="color:#f92672">=</span>/opt/nginx/logs/nginx.pid
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/opt/nginx/sbin/nginx
</span></span><span style="display:flex;"><span>ExecReload<span style="color:#f92672">=</span>/opt/nginx/sbin/nginx -s reload
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>on-failure
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/opt/nginx/sbin/nginx -s quit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><hr>
<ul>
<li>systemd取消了以前的runlevel概念，转而使用不同的target操作环境。常见的操作环境为multi-user.target（命令行界面）和graphical.target（图形界面）。不重新启动而转不同的操作环境使用<code>systemctl isolate unit.target</code>，设定预设的环境使用<code>systemctl set-default multi-user.target</code>。</li>
</ul>
<h2 id="rpm-软件管理机制">
  RPM 软件管理机制
  <a class="anchor" href="#rpm-%e8%bd%af%e4%bb%b6%e7%ae%a1%e7%90%86%e6%9c%ba%e5%88%b6">#</a>
</h2>
<ul>
<li>
<p>RPM全称：RedHat Package Manager</p>
</li>
<li>
<p>RPM是通过预先编译打包成RPM文件格式后，再加以安装的一种方式。RPM在打包软件的同时会加入一些其他的信息，包括软件版本、作者、<strong>依赖的其他软件</strong>等。RPM会在linux系统上建立一个RPM软件数据库，当要安装某个软件时，RPM会去在数据库里检测是否已经存在相关软件，如果不存在就不能安装。</p>
</li>
<li>
<p>当软件安装完毕后，该软件相关的信息就会被写入到<code>/var/lib/rpm</code>目录下的数据库文件中了。未来任何软件升级的需求，版本之间的比较都是来自于这个数据库。</p>
</li>
<li>
<p><code>rpm -ivh package_name</code>安装软件</p>
<ul>
<li>-i install；-v查看安装信息界面；-h显示安装进度</li>
<li>&ndash;force：强制安装，&ndash;test：测试一下该软件是否可以被安装到linux中</li>
<li>&ndash;prefix 新路径：将软件安装到其他路径</li>
</ul>
</li>
<li>
<p><code>rpm -Uvh/-Fvh file-1.0-1.e17.x86_64.rpm</code> 更新软件</p>
<ul>
<li>-U：update后面的软件即使没有安装过，系统会直接安装，如果安装过旧版，系统会更新到新版。</li>
<li>-F：freshen后面的软件如果没有安装就不安装，如果安装过旧版就更行到新版。</li>
</ul>
</li>
<li>
<p><code>rpm -qa</code>查询本机所有已安装软件</p>
<ul>
<li><code>rpm -q package_name</code>查询后面的软件是否被安装</li>
<li><code>rpm -qi package_name</code>列出该软件的详细信息</li>
<li><code>rpm -ql package_name</code>列出该软件所有文件与目录</li>
<li><code>rpm -qR package_name</code>列出该软件依赖那些软件</li>
<li><code>rpm -qpR file-1.0-1.e17.x86_64.rpm</code>查询某个rpm文件依赖了哪些文件，-p表示指定的是一个rpm文件。</li>
<li>tips：在查询本机上已安装的软件时，只用加上软件的名称即可，版本号啥的都不需要。</li>
</ul>
</li>
</ul>
<h2 id="yum-包管理工具">
  yum 包管理工具
  <a class="anchor" href="#yum-%e5%8c%85%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7">#</a>
</h2>
<p>当客户端有软件安装需求时，客户端会主动下载yum服务器中该软件的依赖清单，将该清单与本机的RPM数据库进行比较，就能安装未安装的依赖了。</p>
<p>yum提供了查找、安装、删除软件包的命令。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>command<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>package ...<span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>options：可选，-y表示安装过程全部为yes，-q白哦是不显示安装过程，-h表示帮助，&ndash;installroot=路径：将软件安装到指定路径中。</li>
<li>command：要进行的操作，如search、list、info。</li>
<li>package：包名。</li>
</ul>
<h3 id="常用命令">
  常用命令
  <a class="anchor" href="#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4">#</a>
</h3>
<ol>
<li><code>yum check-update</code>列出所有可更新的软件。</li>
<li><code>yum update</code>更新所有软件</li>
<li><code>yum install package_name</code>安装指定的软件</li>
<li><code>yum update package_name</code>更新指定的软件</li>
<li><code>yum list </code>列出所有的可安装的软件
<ul>
<li><code>yum list packa*</code>寻找以packa开头的软件</li>
</ul>
</li>
<li><code>yum remove package_name</code>删除软件</li>
<li><code>yum search keyword_name</code>查找软件包命令</li>
<li>yum会先下载软件库的清单到本机的<code>var/cache/yum</code>中，清除缓存命令如下
<ul>
<li><code>yum clean packages/headers/all</code>清楚缓存目录下的软件包/headers/所有软件库的数据。</li>
</ul>
</li>
</ol>
<h2 id="netstat-显示网络状态">
  netstat 显示网络状态
  <a class="anchor" href="#netstat-%e6%98%be%e7%a4%ba%e7%bd%91%e7%bb%9c%e7%8a%b6%e6%80%81">#</a>
</h2>
<ul>
<li><code>netstat -tulnp</code>用来获取目前主机已启动的服务</li>
<li>-t/-u显示tcp/udp传输协议的连接情况</li>
<li>-l显示监听状态的的服务</li>
<li><code>-a</code>显示所有连线中的socket</li>
<li><code>-n </code>：显示数字而不是别名</li>
<li>-p显示socket的pid/程序名</li>
</ul>
<h2 id="tcpdump-抓包命令">
  tcpdump 抓包命令
  <a class="anchor" href="#tcpdump-%e6%8a%93%e5%8c%85%e5%91%bd%e4%bb%a4">#</a>
</h2>
<ul>
<li><code>-i interface</code>监听指定的interface，如果未指定此参数，tcpdump会搜索系统interface上数字最小的interface（如eth0）监控。可以用<code>-i any</code>来监控所有的interface（此参数不会在promiscuous mode下工作）。</li>
<li><code>-X</code>显示原始16进制数据内容和ascii编码后的内容。</li>
<li><code>-D</code> 列出系统上可用的网络接口。</li>
<li><code>-A</code> 以ASCII的方式打印出每个包（不包括链路层头部）。</li>
<li><code>-nn</code>显示原始的ip地址和端口。</li>
<li><code>-v</code>产生详细的输出. 比如包的TTL，id标识，数据包长度，以及IP包的一些选项。</li>
<li><code>-w</code> 将抓到的数据包写入到文件中。</li>
<li>
  <a href="https://www.tcpdump.org/">tcpdump</a></li>
<li>例子</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#以ASCII的形式显示在本机所有网卡、端口5140上监听的数据</span>
</span></span><span style="display:flex;"><span>tcpdump -A -i any -n port <span style="color:#ae81ff">5140</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#监听端口不是5140</span>
</span></span><span style="display:flex;"><span>tcpdump -A -i any -n ! port <span style="color:#ae81ff">5140</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#抓来源是10.0.1.81，目的端口是5140的数据</span>
</span></span><span style="display:flex;"><span>tcpdump -i any -nnA src host 10.0.1.81 and dst port <span style="color:#ae81ff">5140</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#同时指定两个端口</span>
</span></span><span style="display:flex;"><span>tcpdump -i any -nnA port <span style="color:#ae81ff">8848</span> or port <span style="color:#ae81ff">5140</span>
</span></span><span style="display:flex;"><span>tcpdump -i any -nnA port <span style="color:#ae81ff">8848</span> or <span style="color:#ae81ff">5140</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#指定端口范围</span>
</span></span><span style="display:flex;"><span>tcpdump -i any -nnA portrange 514-5140
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将抓到的数据保存到文件中</span>
</span></span><span style="display:flex;"><span>tcpdump icmp -w icmp.pcap
</span></span><span style="display:flex;"><span>tcpdump icmp  -r icmp.pcap
</span></span></code></pre></div><h2 id="curl-强大的网络工具">
  curl 强大的网络工具
  <a class="anchor" href="#curl-%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bd%91%e7%bb%9c%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li>
<p>（client url）通过指定的url上传或者下载数据。</p>
</li>
<li>
<p><code>curl xiaoxiang.space</code>查看网页源码。</p>
</li>
<li>
<p><code>curl -o [文件名] xiaoxiang.space</code>保存文件。</p>
</li>
<li>
<p>使用<code>-L</code>参数，当有重定向时，会跳转到新的网址。</p>
</li>
<li>
<p><code>-i</code>显示http response的头信息，同时也会显示网页代码。</p>
</li>
<li>
<p><code>-I/--head</code>只显示http response。</p>
</li>
<li>
<p><code>-v</code>显示一次http通信的整个过程。</p>
</li>
<li>
<p>发送get请求和参数，直接把数据附加到网址后面就行。</p>
</li>
<li>
<p><code>curl -X POST --data-urlencode &quot;data=xxx&quot; example.com/xxx</code>发送post请求。<code>-X</code>参数可以支持几个动词。</p>
</li>
<li>
<p><code>--User-Agent</code>、<code>--cookie</code>等，<code>--header</code>增加一个头信息。</p>
</li>
<li>
<p><code>--user name:password</code>http认证。</p>
</li>
<li>
<p><code>-k</code>跳过ssl检测。</p>
</li>
<li>
<p><code>--limit-rate</code>限制HTTP请求和回应的带宽。</p>
</li>
<li>
<p><strong>参考链接：</strong>
  <a href="https://www.ruanyifeng.com/blog/2011/09/curl.html">curl网站开发指南 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
</li>
<li>
<p><strong>参考链接：</strong>
  <a href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html">curl 的用法指南 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
</li>
</ul>
<h2 id="ps-获取当前时刻系统进程状态">
  ps 获取当前时刻系统进程状态
  <a class="anchor" href="#ps-%e8%8e%b7%e5%8f%96%e5%bd%93%e5%89%8d%e6%97%b6%e5%88%bb%e7%b3%bb%e7%bb%9f%e8%bf%9b%e7%a8%8b%e7%8a%b6%e6%80%81">#</a>
</h2>
<ul>
<li><code>ps aux</code>查询所有系统运行的进程
<ul>
<li>%CPU：使用的cpu资源百分比；%mem：使用的内存资源百分比；vsz：使用的虚拟内存Kb；rss：占用的固定内存Kb；tty：该进程是在哪个终端机上运行，如果于与终端机无关则显示？；stat：进程目前状态（R运行；S睡眠但可被唤醒；D不可被唤醒；T停止状态；Z僵尸状态）；time：实际使用cpu的时间。</li>
<li><code>--sort +rss</code> 按照rss以递增[+]或者递减[-]的顺序排序 。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#按照cpu占用从大到小排序 并一页一页的显示</span>
</span></span><span style="display:flex;"><span>ps aux --sort -%cpu | more
</span></span></code></pre></div><ul>
<li>使用<code>ps -lf</code>显示当前的bash的进程。
<ul>
<li>-l时较详细的输出当前bash的信息，-f是更完整的输出。🤣</li>
<li>输出中的S代表该进程的状态，主要的状态有：R running；S sleep；D 不可唤醒的睡眠状态，而可能是在等待I/O；T 停止状态；Z zombie僵尸状态。</li>
<li>PRI/NI priority/nice 代表此进程被cpu所执行的优先级。PRI值越低代表优先级越高。优先级是由内核动态调整的，用户无法干涉，如果需要调整进程的优先执行次序时，可以通过修改Nice的值。一般来说有PRI(new)=PRI(old)+nice，但是最终的PRI也是有系统分析后决定的，nice的值有正有负，当nice为负数时，该进程就会降低pri值，所以会被较为优先的处理。nice的值的范围是<code>-10~19</code>。一般使用者仅可以调整自己进程的nice值，范围为<code>0~19</code>，且只能将nice调高。使用nice和renice调整。
<ul>
<li>nice：新执行的指令给予新的nice值 <code>nice [-n 数字] command</code>。</li>
<li>renice：已存在进程的nice重新调整 <code>renice [-number] PID</code>。</li>
</ul>
</li>
<li>ADDR/SZ/WCHAN  addr标识该进程在cpu的哪个部分，如果是running的进程，一般就会显示-，sz代表该进程用掉了多少的内存。wchaz代表进程目前是否在运行中。</li>
<li>TIME代表使用掉的cpu的时间。</li>
</ul>
</li>
<li><code>ps axjf</code>可以列出来类似进程树的进程显示。</li>
<li><code>pstree [-Apu]</code> -p显示每个进程的pid，-u显示每个进程的所属账号。-A各个进程之间以ascii字符来连接。</li>
<li>相关文档 
  <a href="http://www.linfo.org/ps.html">The ps Command</a></li>
</ul>
<h2 id="top-动态显示进程状态">
  top 动态显示进程状态
  <a class="anchor" href="#top-%e5%8a%a8%e6%80%81%e6%98%be%e7%a4%ba%e8%bf%9b%e7%a8%8b%e7%8a%b6%e6%80%81">#</a>
</h2>
<ul>
<li>
<p><code>top [-d n]</code>每隔n秒（默认为5）更新一次</p>
<ul>
<li>第一行显示的是：当前时间、开机到现今经过的时间、登入系统的人数、系统在1、5、15分钟的平均工作负载</li>
<li>第二行显示进程总量、进程状态；第三行显示cpu整体负载；第四行和第五行显示物理内存和虚拟内存的使用情况。</li>
<li>第三行（%Cpus&hellip;）显示的是CPU的整体负载，wa表示I/O wait</li>
<li>PR:priority，指进程的优先级、NI：Nice，于PR有关；TIME+表示CPU使用时间的累加</li>
<li>执行过程中按下M表示以内存的使用来排序，N表示已PID来排序，P表示以CPU来排序，T表示以TIME+来排序，按下q可以离开top</li>
<li><code>-p PID</code>观察指定PID</li>
<li>在top执行过程中可以按下**<code>P</code><strong>使得以CPU的使用资源排序，按下</strong><code>M</code><strong>以内存的使用资源排序，按下</strong><code>N</code>**以PID来排序。按下<code>c</code>显示完整的路径和名称。</li>
</ul>
</li>
</ul>
<h2 id="kill-向进程发送signal">
  kill 向进程发送signal
  <a class="anchor" href="#kill-%e5%90%91%e8%bf%9b%e7%a8%8b%e5%8f%91%e9%80%81signal">#</a>
</h2>
<ul>
<li><code>kill -9 PID</code>立刻强制删除一个工作</li>
<li><code>kill  [-15] PID</code>以正常的方式结束一个工作</li>
<li>例：当使用vim时，会产生一个.filename.swp文件，使用-15时，vim会以正常的步骤结束vi的工作，所以.filename.swp会被主动的移除，但如果使用-9，由于vim工作被强制移除了，所以.filename.swp就会继续存在文件系统中。</li>
<li>当想要进程执行某些动作时，可以给该进程一个工作号码，可以使用<code>kill -l </code>或者<code>man 7 signal</code>查到，主要的信号与名称对应关系。</li>
</ul>
<table>
<thead>
<tr>
<th>signal</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 SIGHUP</td>
<td>启动被终止的进程，可以让该PID重新读取自己的配置文件，类似于重新启动</td>
</tr>
<tr>
<td>2 SIGINT</td>
<td>相当于用键盘输入一个ctrl-c来中断一个进程的执行</td>
</tr>
<tr>
<td>9 SIGKILL</td>
<td>强制中断一个进程的进行</td>
</tr>
<tr>
<td>15 SIGTERM</td>
<td>以正常的结束进程来终止该进程</td>
</tr>
<tr>
<td>19 SIGSTOP</td>
<td>相当于使用键盘ctrl-z来暂停一个进程的执行。</td>
</tr>
</tbody>
</table>
<ul>
<li>kill可以帮我们将signal传递给某个%jobnumber（参考下面的job和fg命令）或者某个PID。</li>
</ul>
<h2 id="nohup和-后台执行">
  nohup和&amp; 后台执行
  <a class="anchor" href="#nohup%e5%92%8c-%e5%90%8e%e5%8f%b0%e6%89%a7%e8%a1%8c">#</a>
</h2>
<ul>
<li>nohup会将标准输入重定向到/dev/null，将标准输出重定向到nohup.out（一般情况）或$HOME/nohup.out文件，将标准错误输出重定向到标准输出。</li>
<li><code>nohup COMMAND &gt; FILE</code> 保存输出内容到文件。</li>
<li><code>nohup COMMAND &amp;</code> 后台执行命令。</li>
<li>使用<code>&amp;</code>可以将任务丢到后台执行，但标准输出和标准错误输出仍然会被输出到屏幕上。</li>
<li><code>&amp;</code>将进程放到了背景执行，但是当退出bash后，进程就会被终止掉，如果需要退出bash后进程仍然能继续执行，可以使用nohup。nohup能在退出bash后还能继续执行工作。</li>
<li>例：<code>nohup java -jar xxx.jar &lt;/dev/null 2&gt;&amp;1 &amp;</code> 将java命令放到后台执行，标准输出和标准错误输出都重定向到/dev/null</li>
</ul>
<h2 id="sed-正则工具">
  sed 正则工具
  <a class="anchor" href="#sed-%e6%ad%a3%e5%88%99%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li><code>sed [-nefr] [n1[,n2]] function</code>。
<ul>
<li>-i 直接修改读取的文件；-n只有经过sed处理的行会被输出（配合q使用）。</li>
<li>n1,n2表示选择进行操作的行数。</li>
<li>function有：a 新增到的当前下几行；c 取代；d 删除；i 插入到当前的上一行；p 打印；s 取代，如1,20s/old/new/g。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#将显示到屏幕的内容删除第2-5行</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed <span style="color:#e6db74">&#39;2,5d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除第三行到最后一行</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed <span style="color:#e6db74">&#39;3,$d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在第二行后面加上drink tea（就是加在了第三行）</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed <span style="color:#e6db74">&#39;2a drink tea&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在第二行后面加上了两行，每一行之间都要以反斜杠\来进行新行的增加</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed <span style="color:#e6db74">&#39;2a drink tea \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">drink beer&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#取代2-5行</span>
</span></span><span style="display:flex;"><span>nl /etc/passed | sed <span style="color:#e6db74">&#39;2,5c No 2-5 number&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#仅列出/etc/passwd文件的第5-7行</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed -n <span style="color:#e6db74">&#39;5,7p&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除5-7行</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd | sed <span style="color:#e6db74">&#39;5,7 d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#去掉开始的空格，删除以1和2开始的行</span>
</span></span><span style="display:flex;"><span>nl /etc/passwd |sed <span style="color:#e6db74">&#39;s/^ *//g&#39;</span> | sed <span style="color:#e6db74">&#39;/^[1-2]/d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#去掉有#注释的行和空白行</span>
</span></span><span style="display:flex;"><span>cat server.properties  | sed <span style="color:#e6db74">&#39;/^#/d&#39;</span> | sed <span style="color:#e6db74">&#39;/^\s*$/d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将行末尾的.改为!</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/\.$/\!/g&#39;</span> regular_express.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e">#文件的最后一行增加一行文字</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;$a # This is a test&#39;</span> regular_express.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除文件中\r</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/\r//g&#39;</span> file.txt 
</span></span></code></pre></div><ul>
<li>取代命令 <code>sed 's/要被取代的字符串/新的字符串/g'</code></li>
</ul>
<h2 id="awk-数据处理工具">
  awk 数据处理工具
  <a class="anchor" href="#awk-%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li><code>awk '条件类型1{动作1}' filename</code> ，awk只能用单引号。</li>
<li>awk默认以空格或者[Tab]按键隔开，隔开的每一行的每个字段都是有变量名称的，那就是$1、$2&hellip;。$0表示一整行。</li>
<li>NF表示每一行的字段总数；NR表示目前是第几行；FS表示目前的分割字符，默认是空格</li>
<li>参数-F可以指定分隔符，如<code>awk -F : '{print $(NF -1)}'</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#输出账号和ip，有些数据格式不对</span>
</span></span><span style="display:flex;"><span>last -n <span style="color:#ae81ff">5</span> | awk <span style="color:#e6db74">&#39;{print $1 &#34;\t&#34; $3}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>last -n 5| awk <span style="color:#e6db74">&#39;{print $1 &#34;\t lines: &#34; NR &#34;\t columns: &#34; NF}&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将分割字符设为冒号:，查询第三栏小于10，并只输出账号和第三栏</span>
</span></span><span style="display:flex;"><span>cat /etc/passwd | awk <span style="color:#e6db74">&#39;BEGIN {FS=&#34;:&#34;} $3 &lt; 10 {print $1 &#34;\t &#34; $3}&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#杀掉所有的java程序</span>
</span></span><span style="display:flex;"><span>jps |grep -vi jps | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span> | xargs -n <span style="color:#ae81ff">1</span> -I <span style="color:#f92672">{}</span> kill <span style="color:#f92672">{}</span>
</span></span></code></pre></div><h2 id="job和fg-前台执行">
  job和fg 前台执行
  <a class="anchor" href="#job%e5%92%8cfg-%e5%89%8d%e5%8f%b0%e6%89%a7%e8%a1%8c">#</a>
</h2>
<ul>
<li>可以使用<code>ctrl+z</code>将任务丢到背景，状态是暂停。</li>
<li>使用 <code>jobs -l</code>可以观察当前背景中的任务。其中+代表最近被放到背景，-代表最近倒数第二个被放到背景。</li>
<li>使用fg可以将背景工作拿到前台来执行。命令：<code>fg &amp;jobnumber</code>。</li>
<li>删除背景中的工作。命令：<code>kill [-15 |-9] %jobnumber</code>。</li>
</ul>
<h2 id="at与cron">
  at与cron
  <a class="anchor" href="#at%e4%b8%8ecron">#</a>
</h2>
<h3 id="at-只执行一次的任务">
  at 只执行一次的任务
  <a class="anchor" href="#at-%e5%8f%aa%e6%89%a7%e8%a1%8c%e4%b8%80%e6%ac%a1%e7%9a%84%e4%bb%bb%e5%8a%a1">#</a>
</h3>
<ul>
<li>要使用at，需要先启动atd。我们使用at这个指令来产生要运行的工作，并将这个工作以文本文件的方式写入到/var/spool/at/目录内，该工作就能等待atd这个服务的取用与执行。</li>
<li>at会先寻找/etc/at.allow这个文件，写在这个文件中的使用者可以使用at，不在这个文件中的用户不能使用at，即使用户没有写在at.deny中。如果不在这个文件中，at会寻找/etc/at.deny这个文件，写在这个文件中的使用者不能用at，不在这个文件中的使用者可以使用（也就是说两个文件存在一个就可以）。如果两个文件都不存在，就只有root可以执行at。</li>
<li>at会将所有的标准输出和标准错误输出传送到执行者的mailbox中，解决方法是<code>echo &quot;hello world&quot; &gt; /dev/tty1</code>。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>at <span style="color:#f92672">[</span>-ldv<span style="color:#f92672">]</span> TIME
</span></span><span style="display:flex;"><span>-l 相当于atq，列出当前系统上面所有当前用户的未执行的at排程。
</span></span><span style="display:flex;"><span>-d 相当于atrm，取消一个在at排程中的工作
</span></span><span style="display:flex;"><span>-c 列出后面接的第几项项工作的实际指令内容at -c <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>TIME: HH:MM <span style="color:#f92672">[</span>YYYY--MM-DD<span style="color:#f92672">]</span> 18:02 2021-10-29
</span></span><span style="display:flex;"><span>	  HH:MM <span style="color:#f92672">[</span>Month<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Date<span style="color:#f92672">]</span> 18:02 October <span style="color:#ae81ff">29</span>
</span></span><span style="display:flex;"><span>	  HH:MM<span style="color:#f92672">[</span>am|pm<span style="color:#f92672">]</span> + number <span style="color:#f92672">[</span>minutes|hours|days|weeks<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#再过5分钟后执行，ctrl+d退出</span>
</span></span><span style="display:flex;"><span>at now + <span style="color:#ae81ff">5</span> minutes
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查询还没执行的任务</span>
</span></span><span style="display:flex;"><span>atq
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除3这个任务</span>
</span></span><span style="display:flex;"><span>atrm <span style="color:#ae81ff">3</span>
</span></span></code></pre></div><h3 id="cron-定时任务">
  cron 定时任务
  <a class="anchor" href="#cron-%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1">#</a>
</h3>
<ul>
<li>与at类似，cron也有两个限制文件，/etc/cron.allow和/etc/cron.deny，/etc/cron.allow比deny要优先，两个文件只选择一个来限制，所以保留一个即可。系统默认保留/etc/cron.deny。</li>
<li>当用户使用crontab指令来建立工作排程后，该项工作就会被记录到/var/spool/cron里面去，而且以账号来判别。cron执行的 每一项工作都会被记录到/var/log/cron这个文件中。</li>
<li>下达指令最好使用绝对路径；cron会每分钟去读取一次/etc/crontab与/var/spool/cron里面的数据，所以编辑完文件后，cron会按照设定自动执行。</li>
<li>放到<code>/etc/cron.hourly</code>目录内的所有执行文件（必须是shell脚本）会在每小时的一分钟开始后的5分钟内随机选择一个时间点来执行（详细请看/etc/cron.d/路径下的文件）。放到<code>/etc/cron.daily</code>、<code>/etc/cron.weekly</code>、<code>/etc/cron.monthly</code>下面的文件是由anacron执行的。而anacron执行方式是在<code>/etc/cron.hourly/0anacron</code>里面。</li>
<li>crond预设有三个地方会有执行脚本配置文件，分别是<code>/etc/crontab</code> ,<code>/etc/cron.d/*</code>,<code>/var/spool/cron/*</code>。</li>
<li>当执行项目有输出时，该数据会mail给MAILTO设定的账号，所以如果不是很重要，将输出重定向到/dev/null中。</li>
<li>建议个人的话使用<code>crontab -e</code>来创建定时任务，系统维护人员直接使用<code>vim /etc/crontab</code>，开发的软件使用<code>vim /etc/cron.d/newfile</code>。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>crontab <span style="color:#f92672">[</span>-u username<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-l | -e |-r<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>-u 只有root可以使用这个参数。
</span></span><span style="display:flex;"><span>-e 编辑crontab的工作内容
</span></span><span style="display:flex;"><span>-l 查阅crontab的工作内容
</span></span><span style="display:flex;"><span>-r 移除所有的crontab的工作内容，如果只移除一项，可以用-e编辑。
</span></span></code></pre></div><ul>
<li>每项工作的格式都是具有六个字段，这六个字段的意义为：</li>
</ul>
<table>
<thead>
<tr>
<th>分钟</th>
<th>小时</th>
<th>日期</th>
<th>月份</th>
<th>周</th>
<th>指令</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-59</td>
<td>0-23</td>
<td>1-31</td>
<td>1-12</td>
<td>0-7（0和7都表示星期天）</td>
<td>指令</td>
</tr>
</tbody>
</table>
<ul>
<li>特殊符号</li>
</ul>
<table>
<thead>
<tr>
<th>特殊符号</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>代表任何时刻</td>
</tr>
<tr>
<td>,</td>
<td>代表该字段有多个参数，如每天3点和6点执行命令，为<code>0 3,6 * * * command</code></td>
</tr>
<tr>
<td>-</td>
<td>表示一段时间范围内，如8点到12点之间每小时的20分都进行一项工作，<code>20 8-12 * * * command</code></td>
</tr>
<tr>
<td>/n</td>
<td>n代表数字，表示每隔n单位的时间执行一此，如每隔5分钟执行一次，<code>*/5 * * * * command</code>，也可以写成<code>0-59/5 * * * * command</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>/etc/crontab</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#使用哪种shell接口</span>
</span></span><span style="display:flex;"><span>SHELL<span style="color:#f92672">=</span>/bin/bash
</span></span><span style="display:flex;"><span><span style="color:#75715e">#执行文件搜寻路径</span>
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span>/sbin:/bin:/usr/sbin:/usr/bin
</span></span><span style="display:flex;"><span><span style="color:#75715e">#有输出时发给谁</span>
</span></span><span style="display:flex;"><span>MAILTO<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span><span style="color:#75715e">#该文件中需要指定用户</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> * * * * *  username command
</span></span></code></pre></div><h3 id="anacron">
  anacron
  <a class="anchor" href="#anacron">#</a>
</h3>
<ul>
<li>
<p><code>/etc/cron.daily</code>各字段含义：</p>
<ul>
<li>天数：anacron 执行当下与时间戳 (/var/spool/anacron/ 内的时间纪录文件) 相差的天数，若超过此天数，就准备开始执行，若没有超过此天数，则不予执行后续的指令。</li>
<li>延迟时间：超过天数导致要执行定时任务，延迟执行的时间。</li>
<li>工作名称定义：通常与后续的目录资源名称相同即可。</li>
<li>实际要进行的指令串。</li>
</ul>
</li>
<li>
<p>anacron执行流程（cron.daily)：</p>
</li>
</ul>
<ol>
<li>由 /etc/anacrontab 分析到 cron.daily 这项工作名称的天数为 1 天；</li>
<li>由 /var/spool/anacron/cron.daily 取出最近一次执行 anacron 的时间戳；</li>
<li>由上个步骤与目前的时间比较，若差异天数为 1 天以上 (含 1 天)，就准备进行指令；</li>
<li>若准备进行指令，根据 /etc/anacrontab 的设定，将延迟 5 分钟 + 随机n分钟 (看RANDOM_DELAY 的 设定)；</li>
<li>延迟时间过后，开始执行后续指令，亦即『 run-parts /etc/cron.daily 』这串指令；</li>
<li>执行完毕后， anacron 程序结束。</li>
</ol>
<h2 id="freeunamehostnamelocale查看和设置系统信息">
  free、uname、hostname、locale查看和设置系统信息
  <a class="anchor" href="#freeunamehostnamelocale%e6%9f%a5%e7%9c%8b%e5%92%8c%e8%ae%be%e7%bd%ae%e7%b3%bb%e7%bb%9f%e4%bf%a1%e6%81%af">#</a>
</h2>
<ul>
<li>
<p><code>free -h</code>查看内存使用情况。</p>
</li>
<li>
<p><code>uname [-asrmpi]</code> -a表示所有；-s 系统核心名称；-r 核心的版本；-m 本系统的硬件名称(x86_64)；-p CPU的类型；-i 硬件的平台。</p>
</li>
<li>
<p><code>uptime</code>显示系统启动时间和工作负载。</p>
</li>
<li>
<p><code>hostnamectl [set-hostname 主机名]</code> 修改主机名。</p>
</li>
<li>
<p><code>timedatectl [list-timezones | set-timezone | set-time | set-ntp]</code> 列出系统上的失去、设定时区、设定时间、设定网络校时。</p>
</li>
<li>
<p><code>localectl set-locale LANG=en_US.utf8</code>设置语系。通过<code>locale -a</code>可以查看linux支持了多少语系，通过<code>locale</code>来查看系统目前的语言环境。LC_ALL、LC_CTYPE、LANG这三个环境变量的值决定了操作系统当前使用的是哪种字符集，优先级是<code>LC_ALL&gt;LC_CTYPE&gt;LANG</code>。</p>
</li>
<li>
<p>硬件数据收集：dmidecode(CPU型号、主板型号、内存相关型号等), gdisk, dmesg, vmstat（分析cpu、内存、io目前的状态）, lspci, lsusb,iostat。</p>
</li>
</ul>
<h2 id="ls-列出文件">
  ls 列出文件
  <a class="anchor" href="#ls-%e5%88%97%e5%87%ba%e6%96%87%e4%bb%b6">#</a>
</h2>
<ul>
<li>ls 列出指定的目录下的文件
<ul>
<li><code>-d 目录名</code>  列出目录名而不进入该目录。</li>
</ul>
</li>
</ul>
<h2 id="cattactailwc-查看文件">
  cat、tac、tail、wc 查看文件
  <a class="anchor" href="#cattactailwc-%e6%9f%a5%e7%9c%8b%e6%96%87%e4%bb%b6">#</a>
</h2>
<ul>
<li>cat：从第一行开始显示文件内容
<ul>
<li><code>-n</code>标上行号</li>
</ul>
</li>
<li>tac：从最后一行开始显示</li>
<li>nl：显示的时候输出行号</li>
<li>more：一页一页的显示文件内容</li>
<li>less：与more类似，但是可以往前翻
<ul>
<li><code>/srting</code>，向下搜索string</li>
<li><code>?string</code>，向上搜索string</li>
</ul>
</li>
<li>head：只看头几行
<ul>
<li>默认是显示10行</li>
<li><code>head -n -100 filename</code>文件后面100行不显示</li>
</ul>
</li>
<li>tail：只看尾几行
<ul>
<li>默认是显示10行</li>
<li><code>tail -f filename</code>文件内容如果有增加，输出增加的内容</li>
<li><code>-n num filename</code>输出文件末尾的n行，默认是10行</li>
<li><code>tail -n +100 filename</code>文件第100行（包括）以后都会被列出来</li>
</ul>
</li>
<li>od：以二进制查看</li>
<li>file：查看文件类型</li>
<li>wc：查看文件里有多少字，多少行，多少字符。
<ul>
<li>wc [-lwm] -l表示列出多少行，-w表示列多多少字，-m表示列出多少字符。</li>
</ul>
</li>
</ul>
<h2 id="重定向与管道">
  重定向与管道
  <a class="anchor" href="#%e9%87%8d%e5%ae%9a%e5%90%91%e4%b8%8e%e7%ae%a1%e9%81%93">#</a>
</h2>
<ul>
<li>标准输入<code>&lt;&lt;</code>或<code>&lt;</code>；标准输出<code>&gt;&gt;</code>或<code>&gt;</code>；标准错误输出<code>2&gt;</code>或<code>2&gt;&gt;</code>。</li>
<li><code>&gt;</code>会覆盖原文件，<code>&gt;&gt;</code>会追加到文件中。如<code>find /home -name .bashrc &gt; list_right 2&gt; list_error</code>，将正确输出和错误输出存入到不同的文件中。</li>
<li>黑洞装置<code>/dev/null</code>，可以吃掉任何导向这个装置的信息。</li>
<li>将正确和错误输出都放到同一个文件中<code>find /home -name .bashrc &gt; list 2&gt;&amp;1</code>。对2&gt;&amp;1的理解，这里2表示错误输出，意思是将错误输出重定向到标准输出，&amp;1表示对标准输出的应用。</li>
<li>管道<code>|</code>只会处理标准输出，会忽略标准错误输出。</li>
<li>管道命令必须要接收上一个指令的标准输入，如less、more、head、tail时管道命令，而如ls、cp、mv就不是管道命令。</li>
<li>管道后面第一个必须是指令。</li>
<li>在管道中常常会使用前一个指令的输出作为后一个指令的输入，某些指令需要指定文件名来处理，该stdin和stdout可以使用<code>减号&quot;-&quot;</code>来替代。如<code>tar -cvf - /home | tar -xvf - -C /tmp/homeback</code>，这个命令是将/home里的文件打包，将打包的文件输出到stdout，后面的命令从stdin读取数据，所以我们就不需要文件名了，直接使用-代替。</li>
<li><code>xargs [OPTION] COMMAND [R]</code>：读入stdin的数据，并以空格符作为分割，将stdin分割成参数。
<ul>
<li><code>xargs -n 1</code>表示每次执行指令值取一个参数。</li>
<li><code>xargs -I R</code>将从标准输入获取到的数据替换后面命令的参数R。</li>
<li><code>xargs -i</code>相当于<code>xargs -I {}</code>。(man手册里面不建议再使用-i了)</li>
<li>xargs的-I {}必须要放到-n前面。</li>
<li>例：<code>ls *.jar | xargs -I {} -n 1 sh start.sh {}</code></li>
</ul>
</li>
</ul>
<h2 id="grep-查找指定内容">
  grep 查找指定内容
  <a class="anchor" href="#grep-%e6%9f%a5%e6%89%be%e6%8c%87%e5%ae%9a%e5%86%85%e5%ae%b9">#</a>
</h2>
<ul>
<li>
<p>grep [-invAB]  &lsquo;搜索字符串&rsquo;  filename：查找文件或标准输出中的字符串，</p>
<ul>
<li>-i表示忽略大小写。</li>
<li>-n表示输出行号。</li>
<li><code>-v</code>：表示选择未匹配的行（反选）。</li>
<li>-A：&ndash;after-context，输出查找字符串后面n行。</li>
<li>-B：&ndash;before-context，输出查找字符串前面多少行</li>
<li>-r：递归查找当前路径下的包含指定内容的文件，同时输出包含此内容的行，-l只输出文件名。如查找指定路径下包含auth的文件：<code>grep -rl auth</code>。</li>
</ul>
</li>
</ul>
<h2 id="whereiswhichlocale-查找文件">
  whereis、which、locale 查找文件
  <a class="anchor" href="#whereiswhichlocale-%e6%9f%a5%e6%89%be%e6%96%87%e4%bb%b6">#</a>
</h2>
<ul>
<li>
<p>whereis：针对几个特定目录查找文件，<code>whereis -l</code>查看这几个特定目录。</p>
</li>
<li>
<p>which：根据PATH查看可执行文件。</p>
</li>
<li>
<p>locate：根据/var/lib/mlocate内的数据库记载搜索文件（数据库未更新前搜索某新建的文件可能搜不到）。</p>
</li>
</ul>
<h2 id="find查找工具">
  find：查找工具
  <a class="anchor" href="#find%e6%9f%a5%e6%89%be%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li>
<p>用法<code>find [PATH] [option] [action]</code>，PATH可以是多个目录，find查找会进入子目录。</p>
<ul>
<li>查看/home下3天内有修改的文件<code>find /home -mtime 3</code>（如果是+3表示大于等于3天前的文件名，-3表示小于等于3天内的文件名）；</li>
<li>查看/home下属于bes的文件<code>find /home -user bes</code>，查看不属于任何人的文件<code>find / -nouser</code>；</li>
<li>查到/home下文件名包含了passwd的文件名<code>find /home -name &quot;*passwd*&quot;</code>;</li>
<li>查看/home下文件类型为普通文件的文件名<code>find /home -type f</code>;</li>
<li>查看文件权限大于755的文件名<code>find -perm /755</code>；</li>
<li><code>find / -perm /7000 -exec ls -l {} \;</code>其中{}表示find找到的内容会放到{}中；-exec到;是关键字，表示开始和结束。</li>
<li>find查找会直接去查找磁盘，可能比较慢。</li>
</ul>
</li>
</ul>
<h2 id="tar-压缩与解压工具">
  tar 压缩与解压工具
  <a class="anchor" href="#tar-%e5%8e%8b%e7%bc%a9%e4%b8%8e%e8%a7%a3%e5%8e%8b%e5%b7%a5%e5%85%b7">#</a>
</h2>
<ul>
<li><code>tar -xzvf xxx.tar.gz</code>解压文件
<ul>
<li>-x extract提取文件；-z通过gzip处理文件；-v：verbose显示执行过程；-f指定文件名</li>
</ul>
</li>
<li><code>tar -cvzf 生成的文件名.tar.gz dir/</code>压缩文件
<ul>
<li>-c：create生成文件</li>
<li>tips：-C（大写）将文件放到指定文件夹</li>
</ul>
</li>
<li><code>tar</code>
<ul>
<li>-c建立打包文件；-v查看执行过程；-x解压缩；-t查看打包文件内的情况；-C在特定目录解压缩；-z使用gzip解压缩；-j使用bzip2解压缩；-J使用xz解压缩；-f后面要立刻接上要被处理的文件名；-p保留备份数据原本权限与属性；&ndash;exclude=FILE压缩过程中不打包FILE。</li>
</ul>
</li>
<li><code>gzip -[cdv#]</code>：-c将压缩的数据输出到屏幕；-d解压缩；-v显示出原文件/压缩文件的压缩比等信息；-#表示数字，-1最快但压缩比最差，-9最慢但压缩比最慢，-6是默认。使用gzip压缩时，原文件会被压缩为***.gz，原文件就不存在了。</li>
<li><code>bzip2 -[cdkzv#]</code>：-c将压缩的数据输出到屏幕上；-d解压缩；-k保留源文件；-z压缩（默认，可不加）；-v显示压缩比等信息；-#与gzip一样。文件名是xxx.bz2。</li>
<li><code>xz [-dtlkc#]</code>：-d解压缩；-t测试压缩文件完整性；-l列出压缩文件相关信息；-k保留原文件不删除；-c数据输出到屏幕上；-#和bzip2一样。-T0指定线程数量和CPU的数量一样。</li>
</ul>
<h2 id="useraddpassedusermoduserdel-用户账号管理">
  useradd、passed、usermod、userdel 用户账号管理
  <a class="anchor" href="#useraddpassedusermoduserdel-%e7%94%a8%e6%88%b7%e8%b4%a6%e5%8f%b7%e7%ae%a1%e7%90%86">#</a>
</h2>
<ul>
<li>默认情况下所有的系统上的账号和一般身份使用者，都记录在/etc/passwd这个文件中，个人密码记录在/etc/shadow文件下，所有组名都记录在/etc/group中。</li>
<li>当输入账号密码登陆后，系统先1. 寻找/etc/passwd里面是否有输入的账号，有的话读取UID和GID以及该账号的home目录和shell；2. 进入/etc/shadow找出对应的账号与UID，然后和对密码是否相符；3. shell启动。</li>
<li>查看已登录系统上的用户，可以使用<code>who</code>。</li>
</ul>
<h3 id="etcpasswd">
  /etc/passwd
  <a class="anchor" href="#etcpasswd">#</a>
</h3>
<ul>
<li>每一行都代表一个账号，有几行就代表有几个账号在系统中。里面有很多账号本来就是系统正常运行所必需的，可以称之为系统账号。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#①账号名称:②x:③UID:④GID:⑤用户信息说明:⑥home目录:⑦shell</span>
</span></span><span style="display:flex;"><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span><span style="color:#75715e">#账户名称需要和UID对应，UID就是使用者标识符，UID中0表示系统管理员；1～999表示系统账号（1～200表示系统自行建立的系统账号）；1000～60000就是给一般使用者使用的。一个UID可以包含多个用户</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#早期unix密码放在此文件中，后来放到了/etc/shadow中，这里用x替代。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GID与/etc/group有关。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#当用户登陆系统后就会取得一个shell来与核心沟通。</span>
</span></span></code></pre></div><h3 id="etcshadow">
  /etc/shadow
  <a class="anchor" href="#etcshadow">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#账号名称:密码:最近密码变动的日期:密码不可被更改的天数:密码需要修改的天数:密码需要变更前的警告天数:密码过期后多少天内还有效:账号失效日期:保留字段</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#第四个字段的0表示随时都可以修改密码</span>
</span></span><span style="display:flex;"><span>root:$6$xtr:18894:0:99999:7:::
</span></span></code></pre></div><h3 id="etcgroup">
  /etc/group
  <a class="anchor" href="#etcgroup">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#组名:x:GID:此群组支持的账号名称</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#每个用户都可以有多个群组</span>
</span></span><span style="display:flex;"><span>root:x:0:dmtsai,alex
</span></span></code></pre></div><ul>
<li>在/etc/passwd中有个GID，即初始群组，初始群组不会加在/etc/group的第四个字段。</li>
<li>使用<code>groups</code>命令可以获取当前账号所有的群组，输出的第一个群组为有效群组，新创建的一个文件使用的就是有效群组。通过<code>newgrp xxx</code>来切换有效群组。</li>
<li>相关命令：<code>groupadd groupmod groupdel</code></li>
</ul>
<h3 id="useradd">
  useradd
  <a class="anchor" href="#useradd">#</a>
</h3>
<ul>
<li><code>-g 初始群组</code> 该字段会被添加到/etc/passwd第四个字段。</li>
<li><code>-u UID -G 次要群组 -c 说明信息(/etc/passwd第五个字段) -r 系统账号 -s /bin/bash(指定一个初始的shell)</code>。</li>
<li>-M 不建立home目录(系统账号默认) ；-m 建立home目录(一般账号默认)。</li>
<li>useradd参考的是/etc/default/useradd文件，默认值可以通过<code>useradd -D</code>查看；除此之外，还参考了/etc/login.defs文件。</li>
<li>相关命令:<code>id chsh</code></li>
</ul>
<h3 id="passwd">
  passwd
  <a class="anchor" href="#passwd">#</a>
</h3>
<ul>
<li>使用useradd建立了账号后，默认情况下无法使用该账号登陆，需要使用passwd设定密码。</li>
<li><code>-l</code> lock，会在/etc/shadow第二栏最前面加!使得密码失效，<code>-u</code> unlock，与-l相反；<code>-S</code> 列出秘密相关参数；<code>-n</code> 多久不可修改密码；<code>-x</code> 多久内必须修改密码； <code>-w</code> 密码过期前多少天开始警告 ；<code>-i</code> 密码失效日期；<code>--stdin</code> 从控制台获取输入。</li>
<li>其他命令<code>chage -l user</code>。</li>
</ul>
<h3 id="usermod">
  usermod
  <a class="anchor" href="#usermod">#</a>
</h3>
<ul>
<li>修改账号的数据。</li>
<li>添加群组<code>usermod -a -G wheel koal</code></li>
</ul>
<h3 id="userdel">
  userdel
  <a class="anchor" href="#userdel">#</a>
</h3>
<ul>
<li>删除用户的相关数据。<code>-r</code>表示同时删除该用户的home目录。</li>
</ul>
<h2 id="chgrpchownchmod-文件权限">
  chgrp、chown、chmod 文件权限
  <a class="anchor" href="#chgrpchownchmod-%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90">#</a>
</h2>
<ul>
<li>
<p><code>chgrp [-R] 文件/文件夹</code> 改变文件的群组（必须是/etc/group中存在的）。</p>
</li>
<li>
<p><code>chown [-R] name:groupname 文件或目录</code>来修改文件的拥有者，-R表示递归。</p>
</li>
<li>
<p><code>chmod [-R] 文件/目录</code> 改变文件/目录的权限。</p>
</li>
</ul>
<h2 id="su-切换用户">
  su 切换用户
  <a class="anchor" href="#su-%e5%88%87%e6%8d%a2%e7%94%a8%e6%88%b7">#</a>
</h2>
<ul>
<li><code>su</code>单纯使用su切换为root身份时，表明切换为root身份。读取变量的设定方式为non-login shell的方式，这种方式很多原本的变量不会改变。</li>
<li><code>su - username</code>使用该命令代表使用login-shell的变量文件来登入系统。</li>
<li><code>su - -c 指令</code> 执行一次root的指令。</li>
</ul>
<h2 id="sudo-以其他用户执行指令">
  sudo 以其他用户执行指令
  <a class="anchor" href="#sudo-%e4%bb%a5%e5%85%b6%e4%bb%96%e7%94%a8%e6%88%b7%e6%89%a7%e8%a1%8c%e6%8c%87%e4%bb%a4">#</a>
</h2>
<ul>
<li>
<p><code>sudo</code> 并非所有人都能执行sudo，只有/etc/sudoers内的用户能执行sudo这个指令。</p>
<ul>
<li><code>sudo [-u 用户] 指令</code> 以某个用户的身份执行指令。不加该参数表示使用root执行指令。</li>
<li>sudoers文件格式1：<code>使用者账号  登入者的来源主机名=（可切换的账号）  可下达的指令。</code> 可下达的指令必须使用绝对路径。</li>
<li>sudoers文件格式2： <code>%群组  ALL=(ALL)  ALL</code></li>
<li>sudoers文件格式3： <code>%群组  ALL=(ALL)  NOPASSWD:ALL</code></li>
<li>sudoers文件格式4：<code>myuser1 All=(root) !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*,!/usr/bin/passwd root</code>。表示myuser1可以执行除了passwd和passwd root外的所有指令。</li>
<li>创建别名：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#别名必须大写</span>
</span></span><span style="display:flex;"><span>User_Alias ADMPW<span style="color:#f92672">=</span>pro1,pro2,pro3 myuser1,myuser2
</span></span><span style="display:flex;"><span>Cmd_Alias ADMPWCOM<span style="color:#f92672">=</span>!/usr/bin/passwd, /usr/bin/passwd <span style="color:#f92672">[</span>A-Za-z<span style="color:#f92672">]</span>*,!/usr/bin/passwd root
</span></span><span style="display:flex;"><span>ADMPW ALL<span style="color:#f92672">=(</span>root<span style="color:#f92672">)</span> ADMPWCOM
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#可以使用sudo搭配su，将用户身份转换为root</span>
</span></span><span style="display:flex;"><span>ADMPW ALL<span style="color:#f92672">=(</span>root<span style="color:#f92672">)</span> /bin/su -
</span></span></code></pre></div><ul>
<li>sudo时间间隔为5min。</li>
</ul>
</li>
</ul>
<h2 id="ulimit-限制系统资源">
  ulimit 限制系统资源
  <a class="anchor" href="#ulimit-%e9%99%90%e5%88%b6%e7%b3%bb%e7%bb%9f%e8%b5%84%e6%ba%90">#</a>
</h2>
<ul>
<li><code>ulimit</code> 限制用户的某些系统资源（比如可以开启的文件数量）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ulimit -<span style="color:#f92672">[</span>SHacdfltu<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>配置<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>-H <span style="color:#75715e">#hard limit，严格的限制，必定不能超过这个设定的数值</span>
</span></span><span style="display:flex;"><span>-S <span style="color:#75715e">#soft limit，警告的设定，可以超过这个设定值，但超过则有警告。</span>
</span></span><span style="display:flex;"><span>-a <span style="color:#75715e">#可列出所有的限制，-标识没有限制。</span>
</span></span><span style="display:flex;"><span>-f <span style="color:#75715e">#此shell可以建立的最大文件大小，单位为KB。</span>
</span></span><span style="display:flex;"><span>-t <span style="color:#75715e">#可使用的最大CPU时间，单位为秒。</span>
</span></span><span style="display:flex;"><span>-u <span style="color:#75715e">#单一用户可以使用的最大程序的数量。</span>
</span></span><span style="display:flex;"><span>-d <span style="color:#75715e">#程序可以使用的最大segment容量。</span>
</span></span><span style="display:flex;"><span>-l <span style="color:#75715e">#可用于锁定（lock）的内存量。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#一般身份如果设置了ulimit的值，通过注销再登录即可恢复，也可以重新设定</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#限制只能建立10MB以下容量的文件</span>
</span></span><span style="display:flex;"><span>ulimit -f <span style="color:#ae81ff">10240</span>
</span></span></code></pre></div><ul>
<li><code>limits.conf</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#文件详细描述</span>
</span></span><span style="display:flex;"><span>vbird1 soft fsize <span style="color:#ae81ff">90000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#第一个字段为账号，或者为群组，如果是群组需要加上@。如果使用群组，这个功能只对初始群组有效。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#第二个字段为限制的模式，是严格hard还是警告soft。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#第三个字段为限制，比如是限制文件容量等。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#第四个字段为限制的值</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#限制prol这个群组每次只能有1个用户登录</span>
</span></span><span style="display:flex;"><span>@prol hard maxlogins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#文件修改后需要重新登录才会有效。</span>
</span></span></code></pre></div><h2 id="acl">
  ACL
  <a class="anchor" href="#acl">#</a>
</h2>
<ul>
<li>Access Control List，用来提供在owner、group，others的rwx之外的权限设定，可以针对单一使用者，单一文件或目录来进行rwx的权限规范。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#检查系统是否支持ACL</span>
</span></span><span style="display:flex;"><span>dmesg | grep -i acl
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#设定acl参数</span>
</span></span><span style="display:flex;"><span>setfacl<span style="color:#f92672">[</span>-bkRd<span style="color:#f92672">]</span> <span style="color:#f92672">[{</span>-m | -x<span style="color:#f92672">}</span> acl参数<span style="color:#f92672">]</span> 目标文件名
</span></span><span style="display:flex;"><span>-m : 设定acl参数给文件使用
</span></span><span style="display:flex;"><span>-x : 删除后面的acl参数
</span></span><span style="display:flex;"><span>-b : 移除所有的acl参数设定
</span></span><span style="display:flex;"><span>-k : 移除预设的acl参数
</span></span><span style="display:flex;"><span>-R : 递归设定acl
</span></span><span style="display:flex;"><span>-d : 设定预设的acl参数，只对目录有效，在该目录新建的数据都会引用此默认值
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为xiaoxiang用户设定文件的权限为rwx</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#一个文件设定了ACL参数后，他的权限部分就会多出来一个+号。</span>
</span></span><span style="display:flex;"><span>setfacl -m u:xiaoxiang:rwx file1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为文件使用者设定权限</span>
</span></span><span style="display:flex;"><span>setfacl -m u::rwx file2
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为群组设置权限</span>
</span></span><span style="display:flex;"><span>setfacl -m g:mygroup:rx file3
</span></span><span style="display:flex;"><span><span style="color:#75715e">#为目录设置acl权限，未来文件的acl权限都继承此目录</span>
</span></span><span style="display:flex;"><span>setfacl -m d:u:xiaoxiang:rx /home/xiaoxiang/dir1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#让xiaoxiang无法使用该目录</span>
</span></span><span style="display:flex;"><span>setfacl -m u:xiaoxiang:- /home/xiaoxiang/dir2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#取消某个账号的ACL权限设定</span>
</span></span><span style="display:flex;"><span>setfacl -x u:xiaoxiang /home/xiaoxiang/file5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取file1的acl权限内容</span>
</span></span><span style="display:flex;"><span>getfacl file1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果中#开头的表示默认值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果中的mask表示用来规范最大允许权限</span>
</span></span></code></pre></div><h2 id="df和du">
  df和du
  <a class="anchor" href="#df%e5%92%8cdu">#</a>
</h2>
<ul>
<li><code>df</code>查看文件系统的的信息。
<ul>
<li><code>df -h</code>查看所有文件系统的信息。</li>
<li><code>df -T</code>查看所有文件系统的类型。</li>
<li><code>df -iT</code>查看所有文件系统的类型和inode的数量。</li>
</ul>
</li>
<li><code>du [-hskm] 文件或目录名称</code> 统计磁盘的使用情况。
<ul>
<li>-h 易读的方式显示。默认情况下会递归展示目录，但不会展示文件。</li>
<li>-s （summarize）列出总量。</li>
<li>-d （&ndash;max-depth=N）：N表示深度，1表示输出子文件夹的大小，2表述输出子文件夹的子文件夹的大小。</li>
<li>-a （&ndash;all） 不加该参数表示只统计文件夹，加该参数表示统计所有文件。</li>
<li>-k和-m 以kB/mB显示。</li>
</ul>
</li>
</ul>
<h2 id="lsblk-列出磁盘列表">
  lsblk 列出磁盘列表
  <a class="anchor" href="#lsblk-%e5%88%97%e5%87%ba%e7%a3%81%e7%9b%98%e5%88%97%e8%a1%a8">#</a>
</h2>
<ul>
<li><code>-f</code>列出磁盘内文件系统的名称。</li>
<li><code>-d</code>仅列出磁盘本身，不会列出分区。</li>
<li>输出信息介绍
<ul>
<li>NAME装置的文件名</li>
<li>MAJ:MIN 主要：次要装置代码</li>
<li>RM 是否为可卸载装置 removable device</li>
<li>SIZE 容量</li>
<li>RO 是否为只读装置</li>
<li>TYPE 是磁盘disk、分区槽partition还是只读存储器rom</li>
<li>MOUNTPOINT 挂载点</li>
</ul>
</li>
</ul>
<h2 id="mount-磁盘挂载">
  mount 磁盘挂载
  <a class="anchor" href="#mount-%e7%a3%81%e7%9b%98%e6%8c%82%e8%bd%bd">#</a>
</h2>
<ul>
<li>
<p><code>mount [-alt]LABLE=''/UUID=''/装置文件名 挂载点/umount</code>挂载与卸载</p>
<ul>
<li><code>mount /dev/sda2 /d </code>将/dev/sda2挂载到/d。</li>
<li><code>umount [-f] 挂载点或装置文件名</code> -f强制删除。</li>
<li>-n 不写入/etc/mtab。</li>
<li>-o后面可以跟一些挂载时额外加上的参数；1. asyn，sync 此文件系统是否使用同步写入（sync）或异步（async）的内存机制。默认为async。2. atime，noatime 是否修订文件的读取时间。3. ro，rw 挂载文件系统为只读或可写。auto，noauto 允许此文件系统被以mount -a自动挂载（auto）。4. dev，nodev 是否允许此文件系统上可建立装置文件。5.suid，nosuid 是否允许此文件系统上有suid的文件格式。6. ecex，noexec 是否允许此文件系统上有可执行文件。7. user，nouser 是否允许此文件系统让任何使用者执行mount，一般mount只有root可以进行，但下达该命令后，一般user也能对其进行挂载。8. defaults 默认为rw，suid， dev，exec，auto，nouser，async。9. remount 重新挂载。</li>
<li>-a 依照配置文件/etc/fstab的数据将所有未挂载的磁盘挂载。</li>
<li>-t 要挂载的文件系统的类型。</li>
</ul>
</li>
<li>
<p>开机挂载(修改/etc/fstab[filesystem table]）</p>
<ul>
<li>参数格式：装置/UUID/LABEL 挂载点 文件系统 文件系统参数 dump fsck</li>
<li>例：UUID=XXX（使用blkid查询） /d ntfs defaults 0 0</li>
<li>/etc/fstab是开机时的配置文件，实际的filesystem的挂载记录到/etc/mtab和/proc/mounts这两个文件中。</li>
</ul>
</li>
<li>
<p><code>sh -c &quot;xxx&quot;</code> 将一个字符串作为完整的命令来执行。</p>
</li>
<li>
<p><code>history  n</code>用来查询过去执行的指令，n表示显示最近n个命令。bash会记录使用过的指令，默认记录1000个，指令存放位置在~/.bash_history中。该文件会记录上一次登录之前的指令，而这一次登录所执行的指令都存在内存中，当注销后，这些指令才会记录到.bash_history中。</p>
</li>
<li>
<p>使用write可以给linux上的其他用户发消息，通过<code>who</code>可以查看目前有谁在线。通过<code>write koal</code>给所有以koal登录的用户发消息。通过<code>mesg n</code>来关闭接收消息，但无法拒绝root的消息。通过<code>mesg y</code>来开启接收消息。使用wall可以对系统上所有的用户发送消息<code>wall &quot;hello world&quot;</code>。</p>
</li>
</ul>
<h2 id="manmanual用户手册">
  man（manual）用户手册
  <a class="anchor" href="#manmanual%e7%94%a8%e6%88%b7%e6%89%8b%e5%86%8c">#</a>
</h2>
<ul>
<li>man中有几个常用的数字的含义：1 用户在shell环境中可以操作的指令或可执行文件；2. 系统调用，如<code>man 2 open</code>；3. 函数库调用；4. 特殊文件，如<code>man 4 tty</code>；5 配置文件或者某些文件的格式；6. 游戏；7. 杂项；8 系统管理员可用的指令。例：<code>man 8 sudo</code>；9. 内核例程。</li>
<li>man page一般包含：①NAME：简短的说明；②SYNOPSIS：简短的指令下达语法说明；③DESCRIPTION：较完整的说明；④OPTIONS；⑤COMMANDS：当这个程序执行的时候，可以在此程序中下达的指令。⑥FILES：关联的文件；⑦SEE ALSO：其他可以参考的信息；⑧EXAMPLE：一些可以参考的范例。</li>
<li>快捷键：空格键:向下翻一页    [Page Up]:向上翻一页    [Page Down]:向下翻一页    [Home]:去第一页    [End]:去最后一页    /string:向下搜索string    ?string:向上搜索string    n/N:n表示下一个搜索，N表示上一个搜索。</li>
</ul>
<h2 id="selinux">
  SELinux
  <a class="anchor" href="#selinux">#</a>
</h2>
<ul>
<li>全称是Security Enhanced Linux。SELinux是在进行进程、文件等细部权限设定依据的一个核心模块。SELinux提供了一些预设的策略（Policy），并在政策内提供了多个规则（rule）。</li>
<li>自主式访问控制（Discretionary Access Control，DAC）是根据进程的拥有者与文件资源的rwx权限来决定有无存取的能力。</li>
<li>委任式访问控制（Mandatory Access Control，MAC）可以根据特定的进程和特定的文件资源来进行权限的管控，即使是root，在使用不同的进程时，取得到的权限不一定是root，而要看当时进程的设定而定。控制的主体由使用者变成了进程。</li>
<li>SELinux是通过MAC的方式来管控进程，控制的主体是进程，而目标是该进程能否读取的文件资源。
<ul>
<li>主体（Subject）：即进程。</li>
<li>目标（Object）：主体目标能否存取的目标资源，一般就是文件系统。</li>
<li>策略（Policy）：由于进程和文件数量庞大，SELinux会依据某些服务来制定基本的存取安全性策略，这些策略中由详细的规则（rule）来指定不同的服务开放某些资源的存取与否。Linux里提供了三个主要的策略，分别是：
<ul>
<li>targeted：针对网络服务限制多，针对本机限制少，是预设的策略。</li>
<li>minimum：仅针对选择的进程来保护。</li>
<li>mls：完整的SELinux限制，限制较为严格。</li>
</ul>
</li>
<li>安全性本文（security context）：主体能不能存取目标除了策略指定外，主体和目标的安全性本文必须一致才能够顺利存取，安全性本文类似于文件系统的rwx。</li>
</ul>
</li>
<li>主体如果要存取目标，首先需要通过SELinux政策内的规则；其次与目标资源的安全性本文对比；最后再检查目标的rwx权限。</li>
</ul>
<h3 id="安全性文本">
  安全性文本
  <a class="anchor" href="#%e5%ae%89%e5%85%a8%e6%80%a7%e6%96%87%e6%9c%ac">#</a>
</h3>
<ul>
<li>文件的安全性文本是放到文件的inode内的，可以使用<code>ls -Z</code>去观察安全性文本。</li>
<li>安全性文本主要用冒号分为三个字段。<code>identify:role:type</code>。</li>
<li>身份识别（Identify），常见的有：
<ul>
<li>unconfined_u：不受限的用户，也就是说该文件来自于不受限的进程所产生的。</li>
<li>system_u：系统用户，大部分就是系统自己产生的。</li>
</ul>
</li>
<li>基本上如果是系统或软件本身所提供的文件，大多就是system_u这个身份名称，如果是用户透过bash自己建立的文件，大多数是不受限的unconfined_u，如果是网络服务所产生的文件，或者是系统服务运作过程中产生的文件，大部分的识别就会是system_u。</li>
<li>角色（Role）
<ul>
<li>object_r：代表的是文件或目录等文件资源。</li>
<li>system_r：代表的就是进程。</li>
</ul>
</li>
<li>类型（Type），一个主体进程能不能读取到资源，与类型有关，类型在文件和进程中的定义不太相同。在文件资源上称为类型Type，在进程上称为领域domain。</li>
</ul>
<h3 id="selinux三种模式的启动关闭和观察">
  SELinux三种模式的启动、关闭和观察
  <a class="anchor" href="#selinux%e4%b8%89%e7%a7%8d%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%90%af%e5%8a%a8%e5%85%b3%e9%97%ad%e5%92%8c%e8%a7%82%e5%af%9f">#</a>
</h3>
<ul>
<li>SELinux目前共有三种模式，分别为：
<ul>
<li>enforcing：强制模式，代表SELinux正确的开始限制domain/type了。</li>
<li>permissive：宽容模式，表示不会实际限制domain和type，但会有警告信息。</li>
<li>disable：关闭，代表SELinux并没有实际运作。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#获取当前的SELinux模式</span>
</span></span><span style="display:flex;"><span>getenforce
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查询当前的策略</span>
</span></span><span style="display:flex;"><span>sestatus 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#修改策略，修改/etc/selinux/config的SELINUX=enforcing</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#SELinux在enforcing和permissive之间切换无需重启</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#切换到disable或者从disable切换到其他需要重启</span>
</span></span><span style="display:flex;"><span>setenforce <span style="color:#f92672">[</span>0|1<span style="color:#f92672">]</span> <span style="color:#75715e">#0表示permissive，1表示Enforcing</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/">mysql</a>
    </h2>
    
  <h5>2021-02-04</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><h2 id="mysql起步">
  mysql起步
  <a class="anchor" href="#mysql%e8%b5%b7%e6%ad%a5">#</a>
</h2>
<ul>
<li>查询版本和当前时间<code>select version(),current_date;</code></li>
<li>mysql执行结束后会显示返回了多少行和用了多长时间，受网络其他因素影响</li>
<li>当输入多行，打算不执行这句sql语句，输入<code>\c</code></li>
<li>自带的的mysql database描述了用户的访问权限。</li>
<li>unix下数据库名是大小写相关的。建议在创建数据库的时候要么全大写，要么全小写，可以在刚安装的时候修改my.cnf文件。</li>
<li>相邻的带引号的多个字符串会拼接成一个字符串。下面这两个等价：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#e6db74">&#39;a string&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;a&#39;&#39;string&#39;</span>
</span></span></code></pre></div><h3 id="linux上mysql布局">
  linux上mysql布局
  <a class="anchor" href="#linux%e4%b8%8amysql%e5%b8%83%e5%b1%80">#</a>
</h3>
<table>
<thead>
<tr>
<th>文件资源</th>
<th>位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>客户端程序和脚本</td>
<td>/usr/bin</td>
</tr>
<tr>
<td>mysqld server</td>
<td>/usr/sbin</td>
</tr>
<tr>
<td>配置文件地址</td>
<td>/etc/my.cnf</td>
</tr>
<tr>
<td>数据存放目录</td>
<td>/var/lib/mysql</td>
</tr>
<tr>
<td>错误日志文件</td>
<td>/var/log/mysqld.log</td>
</tr>
<tr>
<td>secure_file_priv</td>
<td>/var/lib/mysql-files</td>
</tr>
<tr>
<td>System V init script</td>
<td>/etc/init.d/mysqld</td>
</tr>
<tr>
<td>Systemd服务</td>
<td>mysqld</td>
</tr>
<tr>
<td>Pid文件</td>
<td>/var/run/mysql/mysqld.pid</td>
</tr>
<tr>
<td>Socket</td>
<td>/var/lib/mysql/mysql.sock</td>
</tr>
<tr>
<td>使用手册</td>
<td>/usr/share/man</td>
</tr>
<tr>
<td>字符集文件等其他文件</td>
<td>/usr/share/mysql</td>
</tr>
<tr>
<td>库</td>
<td>/usr/lib/mysql</td>
</tr>
<tr>
<td><strong>参考链接：</strong></td>
<td>
  <a href="https://dev.mysql.com/doc/refman/8.0/en/linux-installation-rpm.html">MySQL :: MySQL 8.0 Reference Manual :: 2.5.4 Installing MySQL on Linux Using RPM Packages from Oracle</a></td>
</tr>
</tbody>
</table>
<h3 id="mysql安装">
  mysql安装
  <a class="anchor" href="#mysql%e5%ae%89%e8%a3%85">#</a>
</h3>
<ul>
<li><code>systemctl start mysqld</code>启动mysql。</li>
<li>mysql安装后，会自动创建超级用户<code>'root'@'localhost'</code>，其密码在<code>/var/log/mysqld.log</code>，使用<code>grep 'temporary password' /var/log/mysqld.log</code>来寻找密码。</li>
<li>修改密码<code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'newPassword'</code>。</li>
<li>mysql8修改成简单的密码会报错（试了下mysql5.7也会报错，解决方法一样）。解决流程如下：
<ol>
<li>mysql8增加了一组变量来控制密码的长度、强度等。通过<code>SHOW VARIABLES LIKE 'validate_password%'</code>来查看。</li>
<li>validate_password.length用来要求密码的最小长度，这个参数不得小于<code>validate_password.number_count+validate_password.special_char_count+2*validate_password.mixed_case_count)</code>。</li>
<li>validate_password.policy会影响validate_password的其他变量是否有效（除validate_password.check_user_name），它的值可以为0(LOW)，1(MEDIUM)，2(STRONG)。为0则只检查length这个变量。</li>
<li>更改策略：<code>set global validate_password.policy=0;set global validate_password.number=4;</code></li>
<li><strong>参考链接：</strong>
  <a href="https://dev.mysql.com/doc/refman/8.0/en/validate-password-options-variables.html">MySQL :: MySQL 8.0 Reference Manual :: 6.4.3.2 Password Validation Options and Variables</a></li>
</ol>
</li>
</ul>
<h3 id="mysql配置">
  mysql配置
  <a class="anchor" href="#mysql%e9%85%8d%e7%bd%ae">#</a>
</h3>
<ul>
<li>mysql配置文件被划分为多个组，每个组有一个组名，用[]括起来。</li>
</ul>
<pre tabindex="0"><code>[mysqld]
default-storage-engine=InnoDB
validate_password=OFF
</code></pre><h2 id="mysql账户管理">
  mysql账户管理
  <a class="anchor" href="#mysql%e8%b4%a6%e6%88%b7%e7%ae%a1%e7%90%86">#</a>
</h2>
<ul>
<li>mysql将账户存储在mysq数据库的user表中。</li>
<li><code>CREATE USER</code>用于创建性的mysql用户；账户首次创建没有特权，需要使用<code>GRANT</code>分配特权。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#如果不指定主机，默认就是&#39;%&#39;（所有ip都能访问）</span>
</span></span><span style="display:flex;"><span>CREATE USER <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;password&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除用户。</span>
</span></span><span style="display:flex;"><span>DROP USER <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#重命名现有的账户,可以用来解决账号只能在本地访问的问题。</span>
</span></span><span style="display:flex;"><span>RENAME USER <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> TO <span style="color:#e6db74">&#39;jeff&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span>
</span></span></code></pre></div><ul>
<li><code>ALTER USER</code>修改账户的信息（如修改密码）。不推荐使用<code>SET PASSWORD</code>来修改密码。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#修改自己的密码，USER()会返回当前登录用户的用户名和主机名</span>
</span></span><span style="display:flex;"><span>ALTER USER USER<span style="color:#f92672">()</span> IDENTIFIED BY <span style="color:#e6db74">&#39;password&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#锁定账户</span>
</span></span><span style="display:flex;"><span>ALTER USER <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> ACCOUNT LOCK;
</span></span><span style="display:flex;"><span>ALTER USER <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> ACCOUNT UNLOCK;
</span></span></code></pre></div><ul>
<li><code>GRANT</code>用来对账户进行授权，<code>REVOKE</code>用来撤销账户特权。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#授予除GRANT和PROXY外的所有特权</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#还可以授予ALTER、CREATE、DELETE、DROP、SELECT、UPDATE、GRANT OPTION</span>
</span></span><span style="display:flex;"><span>GRANT ALL ON db1.* TO <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>REVOKE INSERT ON *.* FROM <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>REVOKE ALL <span style="color:#f92672">[</span>PRIVILEGES<span style="color:#f92672">]</span>, GRANT OPTION FROM <span style="color:#e6db74">&#39;jeffrey&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span></code></pre></div><h2 id="mysql系统变量">
  mysql系统变量
  <a class="anchor" href="#mysql%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f">#</a>
</h2>
<ul>
<li>mysql有很多的系统变量，能够影响程序的行为，很多命令都能在运行过程中修改。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#获取某个变量的信息</span>
</span></span><span style="display:flex;"><span>show <span style="color:#f92672">[</span>global | session<span style="color:#f92672">]</span> variables like <span style="color:#e6db74">&#39;xxx&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取默认存储引擎</span>
</span></span><span style="display:flex;"><span>show variables like <span style="color:#e6db74">&#39;default_storage_engine&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取默认的最大连接数</span>
</span></span><span style="display:flex;"><span>show variables like <span style="color:#e6db74">&#39;max_connections&#39;</span>;
</span></span></code></pre></div><h3 id="通过命令行设置系统变量">
  通过命令行设置系统变量
  <a class="anchor" href="#%e9%80%9a%e8%bf%87%e5%91%bd%e4%bb%a4%e8%a1%8c%e8%ae%be%e7%bd%ae%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysqld --max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
</span></span></code></pre></div><h3 id="通过配置文件设置系统变量">
  通过配置文件设置系统变量
  <a class="anchor" href="#%e9%80%9a%e8%bf%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%ae%be%e7%bd%ae%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[server]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_connections</span><span style="color:#f92672">=</span><span style="color:#e6db74">10</span>
</span></span></code></pre></div><h3 id="运行过程中修改系统变量">
  运行过程中修改系统变量
  <a class="anchor" href="#%e8%bf%90%e8%a1%8c%e8%bf%87%e7%a8%8b%e4%b8%ad%e4%bf%ae%e6%94%b9%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f">#</a>
</h3>
<ul>
<li>许多系统变量分为全局范围（global）和会话范围（session）。</li>
<li>并不是所有的变量都有全局范围和会话范围，如max_connections只有全局范围。</li>
<li>服务器在启动时会给所有的全局变量一个默认值，当有连接的客户端时，服务器为每个连接的客户端维护一组会话变量，并以全局变量的值初始化。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#全局设置存储引擎</span>
</span></span><span style="display:flex;"><span>set global default_sotrage_engine<span style="color:#f92672">=</span>MyISAM
</span></span><span style="display:flex;"><span><span style="color:#75715e">#本次会话期间设置存储引擎</span>
</span></span><span style="display:flex;"><span>set <span style="color:#f92672">[</span>session<span style="color:#f92672">]</span> default_storage_engine<span style="color:#f92672">=</span>MyISAM
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取会话范围的变量内容</span>
</span></span><span style="display:flex;"><span>show SESSION VARIABLES LIKE <span style="color:#e6db74">&#39;default_sotrage_engine&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#不写修饰符默认是session范围，如果一个变量没有session范围则显示global范围的值</span>
</span></span><span style="display:flex;"><span>show VARIABLES LIKE <span style="color:#e6db74">&#39;max_connections&#39;</span>
</span></span></code></pre></div><h3 id="状态变量">
  状态变量
  <a class="anchor" href="#%e7%8a%b6%e6%80%81%e5%8f%98%e9%87%8f">#</a>
</h3>
<ul>
<li>状态变量有关服务器的运行情况。</li>
<li>状态变量不能人为设置。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>show <span style="color:#f92672">[</span>global | session<span style="color:#f92672">]</span> status like <span style="color:#f92672">[</span>like <span style="color:#e6db74">&#39;xxx&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看当前有多少客户端与服务器建立了连接。</span>
</span></span><span style="display:flex;"><span>show status like <span style="color:#e6db74">&#39;threads_connected&#39;</span>
</span></span></code></pre></div><h3 id="补充">
  补充
  <a class="anchor" href="#%e8%a1%a5%e5%85%85">#</a>
</h3>
<ul>
<li>
<p>很多变量不可修改，如<code>version</code>。</p>
</li>
<li>
<p>大部分系统变量都可以当启动选项传入。</p>
</li>
</ul>
<h2 id="mysql字符集">
  mysql字符集
  <a class="anchor" href="#mysql%e5%ad%97%e7%ac%a6%e9%9b%86">#</a>
</h2>
<h3 id="常见字符集">
  常见字符集
  <a class="anchor" href="#%e5%b8%b8%e8%a7%81%e5%ad%97%e7%ac%a6%e9%9b%86">#</a>
</h3>
<ul>
<li>ASCII：共128个字符，用一个字节编码。</li>
<li>ISO 8859-1：共收录256个字符，在ASCII的基础上扩充了128个西欧常用字符。这个字符集也有一个别名Latin 1。</li>
<li>GB2312：收录了6763个汉字以及部分其他编码，兼容ASCII字符集，如果该字符集在ASCII字符集中，则采用一字节编码，否则采用两字节编码。</li>
<li>GBK：在GB2312的基础上进行了扩充，兼容GB2312。</li>
<li>UTF-8：几乎收录了当前世界上各个国家和地区使用的字符，而且还在不断扩充，采用变长编码的方式，编码一个字符需要1~4个字节。</li>
</ul>
<h3 id="mysql的字符集和比较规则">
  mysql的字符集和比较规则
  <a class="anchor" href="#mysql%e7%9a%84%e5%ad%97%e7%ac%a6%e9%9b%86%e5%92%8c%e6%af%94%e8%be%83%e8%a7%84%e5%88%99">#</a>
</h3>
<h4 id="utf8和utf8mb4">
  utf8和utf8mb4
  <a class="anchor" href="#utf8%e5%92%8cutf8mb4">#</a>
</h4>
<ul>
<li>utf8mb3：阉割过的utf-8，只使用1~3个字节表示字符。mysql中的utf8就是utf8-mb3的别名。</li>
<li>utf8mb4：正宗utf-8，使用1~4表示字符。</li>
</ul>
<h4 id="字符集查看">
  字符集查看
  <a class="anchor" href="#%e5%ad%97%e7%ac%a6%e9%9b%86%e6%9f%a5%e7%9c%8b">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SHOW CHARSET <span style="color:#f92672">[</span>LIKE <span style="color:#e6db74">&#39;utf8%&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果中的maxlen表示此字符集最多需要几个字节表示一个字符。</span>
</span></span></code></pre></div><h4 id="比较规则">
  比较规则
  <a class="anchor" href="#%e6%af%94%e8%be%83%e8%a7%84%e5%88%99">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SHOW COLLATION <span style="color:#f92672">[</span>LIKE <span style="color:#e6db74">&#39;utf8%&#39;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>比较规则都以与其关联的字符集的名称开头，后面紧跟着该比较规则所应用的语言，如<code>utf8_polish_ci</code>表示波兰语的比较规则，<code>utf8_general_ci</code>是一种通用的比较规则。名称后缀介绍如下：</li>
</ul>
<table>
<thead>
<tr>
<th>后缀</th>
<th>英文</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>_ai</td>
<td>accent insensitive</td>
<td>不区分重音</td>
</tr>
<tr>
<td>_as</td>
<td>accent sensitive</td>
<td>区分重音</td>
</tr>
<tr>
<td>_ci</td>
<td>case insensitive</td>
<td>不区分大小写</td>
</tr>
<tr>
<td>_cs</td>
<td>case sensitive</td>
<td>区分大小写</td>
</tr>
<tr>
<td>_bin</td>
<td>binary</td>
<td>以二进制的方式比较</td>
</tr>
</tbody>
</table>
<ul>
<li>每种字符集都有一个默认的比较规则，是在执行SHOW COLLATION语句返回的结果中Default为YES的比较规则。</li>
</ul>
<h3 id="各级别的字符集和比较规则">
  各级别的字符集和比较规则
  <a class="anchor" href="#%e5%90%84%e7%ba%a7%e5%88%ab%e7%9a%84%e5%ad%97%e7%ac%a6%e9%9b%86%e5%92%8c%e6%af%94%e8%be%83%e8%a7%84%e5%88%99">#</a>
</h3>
<ul>
<li>mysql有4个界别的字符集和比较规则</li>
</ul>
<h4 id="服务器级别">
  服务器级别
  <a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ba%a7%e5%88%ab">#</a>
</h4>
<ul>
<li>mysql提过了两个系统变量来表示服务器级别的字符集和比较规则：</li>
</ul>
<pre tabindex="0"><code>#服务器级别的字符集
SHOW VARIABLES LIKE &#39;character_set_server&#39;
#服务器级别的比较规则
SHOW VARIABLES LIKE &#39;collation_server&#39;
</code></pre><ul>
<li>通过修改配置文件来修改这两个值</li>
</ul>
<pre tabindex="0"><code>[server]
charset_set_server=utf8
collation_server=utf8_general_ci
</code></pre><h4 id="数据库级别">
  数据库级别
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ba%a7%e5%88%ab">#</a>
</h4>
<ul>
<li>
<p>有两个变量可以看数据库级别的字符集和编码：<code>character_set_database</code>和<code>collation_database</code>，使用方式和上面类似。不能使用这两个变量修改当前数据库的字符集和比较规则。</p>
</li>
<li>
<p>创建数据库和修改数据库时指定</p>
</li>
</ul>
<pre tabindex="0"><code>CREATE DATABASE database1
	[[DEFAULT] CHARACTER SET utf8]
	[[DEFAULT] COLLATE utf8_general_ci]

ALTER DATABASE database1
	[[DEFAULT] CHARACTER SET utf8]
	[[DEFAULT] COLLATE utf8_general_ci]
</code></pre><h4 id="表级别">
  表级别
  <a class="anchor" href="#%e8%a1%a8%e7%ba%a7%e5%88%ab">#</a>
</h4>
<ul>
<li>可以在创建和修改表的时候指定表的字符集和比较规则。</li>
</ul>
<pre tabindex="0"><code>CREATE TABLE table1
	...
	...
	[[DEFALUT] CHARACTER SET utf8]
	[COLLATE UTF8_general_ci]
	
ALTER TABLE table1
	[[DEFALUT] CHARACTER SET utf8]
	[COLLATE UTF8_general_ci]
</code></pre><h4 id="列级别">
  列级别
  <a class="anchor" href="#%e5%88%97%e7%ba%a7%e5%88%ab">#</a>
</h4>
<ul>
<li>创建和修改列的时候可以设置列的字符集和比较规则。</li>
</ul>
<pre tabindex="0"><code>CREATE TABLE table1(
	column1 varchar(255) [CHARACTER SET utf8] [COLLATE utf8_general_ci]
);

ALTER TABLE table1 MODIFY column1 varchar(255) [CHARACTER SET utf8] [COLLATE utf8_general_ci];
</code></pre><h3 id="补充-1">
  补充
  <a class="anchor" href="#%e8%a1%a5%e5%85%85-1">#</a>
</h3>
<ul>
<li>只修改字符集，则比较规则将修改为修改后的字符集的默认的比较规则。</li>
<li>只修改比较规则，则字符集将变为修改后的比较规则对应的字符集。</li>
<li>创建或修改列时未显示的指定字符集和比较规则，则该列使用表的字符集和比较规则，如果创建表时未显示的指定字符集和比较规则，则该表默认使用数据库的字符集和比较规则，如果创建数据库时未显示指定字符集和比较规则，则使用mysql服务器的字符集和比较规则。</li>
<li>mysql5.7及以前的版本，mysql服务器默认的字符集为latin1，mysql8.0后默认字符集为utfmb4。</li>
</ul>
<h2 id="mysqldump">
  mysqldump
  <a class="anchor" href="#mysqldump">#</a>
</h2>
<p>mysqldump可以备份数据库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysqldump <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> db_name &gt; file_name
</span></span><span style="display:flex;"><span>mysqldump <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> --databases db_name ...
</span></span></code></pre></div><ul>
<li>默认输出到控制台，可通过<code>&gt;</code>输出到文件。</li>
<li>可以直接在后面跟一个数据库名，这样就备份了数据库的表的结构和数据。但不包括建库的语句。</li>
<li>可选的option
<ul>
<li><code>--databases</code>：备份指定几个数据库。在备份数据库时会加上<code>CREATE DATBASE...</code>和<code>use xxx</code>的语句，</li>
<li><code>--all-databases</code>：备份数据库的所有表，和<code>--databases</code>类似。</li>
<li><code>--add-drop-database</code>：在<code>CREATE DATABASE</code>之前加上<code>DROP DATABASE</code>语句，这个参数与&ndash;databases和&ndash;all-databases同时使用。</li>
<li><code>--add-drop-table</code>：建表语句之前加上删表语句。</li>
<li><code>--ignore-table</code>：不备份指定的表。</li>
<li><code>--tables</code>: 会覆盖&ndash;databases属性<code>mysqldump database1 --tables table1 -u root -p </code>。</li>
<li><code>--no-data</code>：不备份数据。</li>
<li><code>--force</code>：-f即使在备份期间发生sql异常也继续。</li>
<li><code>--host</code>：-h主机。&ndash;user：-u用户。&ndash;password：-p密码。&ndash;port：-P端口。</li>
<li><code>--xml</code>：输出xml文件。</li>
<li><code>--set-charset</code>：默认启用的参数。</li>
</ul>
</li>
<li>一个例子</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysqldump -u root -p --databases test --add-drop-database &gt; test.sql
</span></span></code></pre></div><ul>
<li>
<p>导入sql文件</p>
<ul>
<li>连接上mysql server后使用<code>source</code>命令导入。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysql&gt;source dump.sql
</span></span></code></pre></div><ul>
<li>从外部导入（sql文件中指定了数据库的情况）。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>shell&gt;mysql<span style="color:#f92672">[</span>-u root -p<span style="color:#f92672">]</span> &lt;dump.sql
</span></span></code></pre></div><ul>
<li>外部导入（sql文件中未指定数据库）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>shell&gt; mysqladmin create db1 <span style="color:#75715e">#如果有该数据库就不用建了</span>
</span></span><span style="display:flex;"><span>shell&gt; mysql <span style="color:#f92672">[</span>-u root -p<span style="color:#f92672">]</span> db1 &lt; dump.sql <span style="color:#75715e">#指定数据库</span>
</span></span></code></pre></div></li>
</ul>
<p>参考链接：
  <a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html#option_mysqldump_databases">MySQL :: MySQL 5.7 Reference Manual :: 4.5.4 mysqldump — A Database Backup Program</a></p>
<h2 id="mysqladmin">
  mysqladmin
  <a class="anchor" href="#mysqladmin">#</a>
</h2>
<ul>
<li>mysqladmin可以用来检测服务的配置、创建数据库、关闭mysql服务等。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mysqladmin <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> command <span style="color:#f92672">[</span>command-arg<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>command <span style="color:#f92672">[</span>command-arg<span style="color:#f92672">]]</span>
</span></span></code></pre></div><h3 id="option">
  option
  <a class="anchor" href="#option">#</a>
</h3>
<ul>
<li>&ndash;host：指定主机。</li>
<li>&ndash;port（-P）：指定端口。</li>
<li>&ndash;user：指定连接用户。</li>
<li>&ndash;version：显示版本信息并退出。</li>
<li>&ndash;wait：如果连接失败，等待并重试。</li>
<li>&ndash;connect-timeout：连接超时的时间。</li>
</ul>
<h3 id="command">
  command
  <a class="anchor" href="#command">#</a>
</h3>
<ul>
<li>create/drop db_name：创建/删除数据库。</li>
<li>password &ldquo;new_password&rdquo;：修改密码，在windows上确保使用双引号&quot;，使用单引号&rsquo;的话单引号会被识别为密码的一部分。</li>
<li>shutdown：关闭服务。</li>
<li>status：显示一个简短的服务状态消息。显示的结果如下：
<ul>
<li>Uptime：mysql运行了多少秒。</li>
<li>Threads：客户端连接的线程数（active）。</li>
<li>Questions：从服务启动开始客户端查询的数量。</li>
<li>Slow queries：查询超过<code>long_query_time</code>秒的数量。</li>
<li>Opens：服务已经打开了多少张表。</li>
<li>Flush tables：<code>flush-*,refresh,reload</code>这些指令服务执行的次数。</li>
<li>Open tables：当前打开了多少张表。</li>
</ul>
</li>
<li>version：显示服务的版本信息。</li>
</ul>
<p><strong>参考链接（官方）：</strong>
  <a href="https://dev.mysql.com/doc/refman/5.7/en/mysqladmin.html"> mysqladmin — A MySQL Server Administration Program</a>
<strong>参考链接（汉化）：</strong>
  <a href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/mysqladmin.html">mysqladmin-MySQL 服务器管理程序 | Docs4dev</a></p>
<h2 id="sql">
  sql
  <a class="anchor" href="#sql">#</a>
</h2>
<h3 id="数据类型">
  数据类型
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b">#</a>
</h3>
<ol>
<li>整数数据类型 tinyint（1字节）、smallint（2字节）、mediumint（3字节）、int（4字节）、bigint（8字节）。</li>
<li>定点数据类型 <code>decimal(5,2)</code>，其中5是精度，表示有效位数；2表示小数点后几位。</li>
<li>浮点类型 float（4字节）、double（8字节）。</li>
<li>日期和时间类型 DATE（YYYY-MM-DD）、DATETIME（YYYY-MM-DD hh:mm:ss）、TIMESTAMP（范围是UTC1970-01-01 00:00:01-UTC2038-01-19 03:14:07)、TIME（范围-838:59:59-838:59:59）、YEAR（范围是1901-2155）</li>
<li>字符串类型 CHAR（长度为声明时的长度，范围0-255）、VARCHAR（可变长度，范围时0-65535）、4种TEXT。</li>
<li>字节串类型 BINARY、VARCHAR、四种BLOB。</li>
</ol>
<ul>
<li>可以把BLOB看作VARBINARY，把TEXT看作VARCHAR，但它们有一点点不同：①对于BLOB和TEXT列上的索引，必须要指定缩影前缀长度，对应VARBINARY和VARCHAR，这是可选的；②BLOB和TEXT所在的列不能有默认值。<strong>参考链接：</strong>
  <a href="https://dev.mysql.com/doc/refman/5.7/en/blob.html">MySQL :: MySQL 5.7 Reference Manual :: 11.3.4 The BLOB and TEXT Types</a></li>
</ul>
<h3 id="database">
  DATABASE
  <a class="anchor" href="#database">#</a>
</h3>
<ul>
<li>创建数据库</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>CRATE <span style="color:#66d9ef">DATABASE</span> db_name [[<span style="color:#66d9ef">DEFAULT</span>] <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> [<span style="color:#f92672">=</span>] utf8];
</span></span></code></pre></div><h3 id="table">
  TABLE
  <a class="anchor" href="#table">#</a>
</h3>
<ul>
<li>克隆和复制。</li>
</ul>
<pre tabindex="0"><code>#从origin_tb1克隆一个新表（只有结构，没有数据）。
CREATE TABLE new_tb1 LIKE origin_tb1;
#复制origin_tb1表，（结构和数据都复制了）。
CREATE TABLE new_tb1 AS SELECT * FROM origin_tb1;
</code></pre><h4 id="alter">
  ALTER
  <a class="anchor" href="#alter">#</a>
</h4>
<pre tabindex="0"><code>#单个alter table可以跟多个修改语句，用逗号隔开
#删除
ALTER TABLE t2 DROP COLUMN c, DROP COLUMN d;
</code></pre><h5 id="changemodifyalter">
  change、modify、alter
  <a class="anchor" href="#changemodifyalter">#</a>
</h5>
<ul>
<li>change可以重命名列、修改列的定义。配合FIRST或AFTER，可以指定列的位置。</li>
<li>MODIFY可以修改列的定义，但无法修改它的名字。配合FIRST或AFTER能指定列的名字。</li>
<li>ALTER只能修改列的默认值。</li>
</ul>
<pre tabindex="0"><code>#将a的名字改为b，修改定义
ALTER TABLE t1 CHANGE a b BIGINT NOT NULL;
#不修改a的名字，只修改定义
ALTER TABLE t1 CHANGE a a BIGINT NOT NULL;
#修改b的定义
ALTER TABLE t1 MODIFY b INT NOT NULL;
#如果只想要修改b的名字而不去修改它的定义，就需要将定义再写一遍
ALTER TABLE t1 CHANGE b a INT NOT NULL;
#除了如PRIMARY KEY或UNIQUE属性，其他的如DEFAULT COMMENT等需要在修改时带上，否则修改后的列是没有这些属性。
#使用CHANGE或MODIFY，myslq会尝试将列中数据转化未新的类型。
#当使用CHANGE修改列名后，使用了该列的VIEW需要修改。
#ALTER TABLE xxx ALTER ...SET DEFAULT xxx或ALTER ... DROP DEFAULT。如果旧的默认值被删除而列不可以为NULL，mysql将为其分配默认值（数字类型默认为0，如果指定了AUTO_INCREMENT，默认值是序列中的下一个值，对于EMUM，默认值为第一个枚举值，对于其他字符串类型，默认值为空字符串）。

ALTER TABLE `service`.`email_relation` RENAME TO  `service`.`relation` ;
ALTER TABLE `service`.`relation` CHANGE COLUMN `email` `mail` VARCHAR(64) NULL DEFAULT NULL ;
</code></pre><ul>
<li>
  <a href="https://dev.mysql.com/doc/refman/5.7/en/alter-table.html">MySQL :: MySQL 5.7 Reference Manual :: 13.1.8 ALTER TABLE Statement</a></li>
</ul>
<h3 id="show">
  SHOW
  <a class="anchor" href="#show">#</a>
</h3>
<pre tabindex="0"><code>#显示属性
SHOW COLUMNS FROM MYSQL.USER;
#显示建库语句，例：
SHOW CREATE DATABASE MYSQL;
#显示建表语句，例：
SHOW CREATE TABLE MYSQL.USER;
#显示创建该用户的语句
SHOW CREATE USER root;
#显示分配个某用户的特权
SHOW GRANTS [FOR user];
show grants for &#39;joe&#39;@&#39;home.example.com&#39;
</code></pre>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/git/git%E8%B5%B7%E6%AD%A5/">git起步</a>
    </h2>
    
  <h5>2021-01-28</h5>



  

  
  <div>
    
      <a href="/tags/git/">git</a>
  </div>
  




    <p><ul>
<li>git：每一次的clone操作，实际上都是对一次代码仓库的完整备份。</li>
<li>git中文件的三种状态：已修改（modified）和已暂存（staged），已提交（committed）：
<ul>
<li>已修改<sup><a id="modified" herf="javascript:;">tag1</a></sup>表示已修改了某个文件，但还没有提交保存（git add之前）；</li>
<li>已暂存表示把已修改的文件放在下次提交的清单中（git add 之后）;</li>
<li>已提交表示该文件已经被安全保存在本地数据库中（git commit之后）；</li>
</ul>
</li>
<li>每个项目都有一个git目录（.git），git工作流程如下：
<ol>
<li>在工作目录（.git的兄弟目录）中修改某些文件；</li>
<li>对修改后的文件保存到暂存区域；</li>
<li>提交跟新，将暂存区域的文件快照转储到git目录中。</li>
<li>提交到远程仓库。</li>
</ol>
</li>
</ul>
<h2 id="开始">
  开始
  <a class="anchor" href="#%e5%bc%80%e5%a7%8b">#</a>
</h2>
<ol>
<li>安装git，配置个人用户名称和电子邮件地址。
<code>git config --global user.name &quot;xiaoxiang&quot;</code>
<code>git config --global user.email &quot;xiaoxiang@xxxx.com&quot;</code></li>
<li>可以使用<code>git config --list</code>查看已有的配置信息。</li>
<li>从现有的git仓库克隆<code>git clone [远程仓库]</code>。</li>
<li>工作目录下的文件分为两种状态：已跟踪和未跟踪：
<ul>
<li>已跟踪是本地仓库中有的文件，初次克隆某个仓库时，工作目录的所有文件都是已跟踪的文件。</li>
<li>未跟踪是新创建的文件，即对该文件从来没有执行git add命令。</li>
<li>当编辑过某些文件后，git将这些文件标记为已修改，这就跟
  <a href="/#modified">tag1</a>对于上了。</li>
</ul>
</li>
<li>使用<code>git add</code>开始跟踪一个新文件，<code>git add .</code>暂存当前路径下的所有的已修改的文件。
<ul>
<li>通过<code>git status</code>可以查看文件的状态。</li>
<li>取消已暂存的状态<code>git reset [--mixed] HEAD  &quot;文件名&quot;</code>，该方式会清除暂存区的数据，保留工作目录的数据。</li>
</ul>
</li>
<li>使用<code>git commit -m &quot;提交说明&quot;</code>来提交暂存区的数据到<strong>本地仓库</strong>。</li>
<li>使用<code>git push origin master</code> 将修改提交到远程仓库。（使用<code>ssh-keygen</code>生成密钥，并将公钥放到git上去，以后提交就不用输账号和密码了）。
<ul>
<li><code>git push [remote-name] [branch-name]</code>，这是完整命令。</li>
</ul>
</li>
</ol>
<h2 id="gitignore">
  .gitignore
  <a class="anchor" href="#gitignore">#</a>
</h2>
<ul>
<li>
<p>可以创建一个.gitignore文件，来指明哪些文件不需要被提交到仓库。</p>
</li>
<li>
<p><code>.gitignore</code>文件的格式规范如下：</p>
<ul>
<li>所有空行或者以<code>#</code>开头的行都会被Git忽略。</li>
<li>忽略指定的模式以外的文件或者目录，可以在模式前加上<code>!</code>。</li>
<li>匹配模式以<code>/</code>开头防止递归。</li>
<li>匹配模式以<code>/</code>结尾防止递归。</li>
<li><code>*</code>匹配零个或多个任意字符，<code>[a-c]</code>匹配任意一个列在方括号中的字符，<code>?</code>只匹配任何一个字符，<code>**</code>表示匹配任意中间目录。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#忽略所有的.a文件</span>
</span></span><span style="display:flex;"><span>*.a
</span></span><span style="display:flex;"><span><span style="color:#75715e">#跟踪所有的lib.a，即使在前面忽略了.a文件</span>
</span></span><span style="display:flex;"><span>!lib.a
</span></span><span style="display:flex;"><span><span style="color:#75715e">#只忽略当前目录下的TODO文件，而不忽略subdir/TODO文件</span>
</span></span><span style="display:flex;"><span>/TODO
</span></span><span style="display:flex;"><span><span style="color:#75715e">#忽略任何目录下名为build的文件夹</span>
</span></span><span style="display:flex;"><span>build/
</span></span><span style="display:flex;"><span><span style="color:#75715e">#忽略doc/notes.txt，但不忽略doc/server/arch.txt</span>
</span></span><span style="display:flex;"><span>doc/*.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e">#忽略doc/目录及其所有子目录下的.pdf文件</span>
</span></span><span style="display:flex;"><span>doc/**/*.pdf
</span></span></code></pre></div><h2 id="git-stash">
  git stash
  <a class="anchor" href="#git-stash">#</a>
</h2>
<ul>
<li><code>git stash push [-m &quot;暂存的备注&quot;]</code> 暂存当前的更改，并将本地恢复到HEAD。-m是可选的，该参数会给此次暂存加个备注。</li>
<li><code>git stash list</code> 列出当前所有的暂存，最新的是<code>stash@{0}</code>。</li>
<li><code>git stash pop</code>  应用stash@{0}，并删除stash@{0}。</li>
<li><code>git stash drop stash@{0}</code> 从stash列表中删除stash@{0}。</li>
<li><code>git stash apply stash@{0}</code> 应用stash@{0}，但不删除stash@{0}</li>
</ul>
<hr>
<ul>
<li>查看文件修改了什么地方，可以使用<code>git diff</code>指令。</li>
<li>查看提交历史<code>git log</code>，后跟<code>-2</code>只会显示最近两次的跟新。</li>
<li>切换到其他分支<code>git checkout master</code>。</li>
<li><code>git tag</code>可以给某一时间点的版本打标签。</li>
<li><code>git update-index --assume-unchanged 文件名</code>：取消本地跟踪</li>
<li><code>git update-index --no-assume-unchanged 文件名</code>：恢复本地跟踪</li>
<li>协议：
<ul>
<li>ssh协议：唯一一个同时支持读写操作的网络协议，但无法实现对仓库的匿名访问。</li>
<li>git协议：该协议通常用来克隆，<strong>通常</strong>不能用来推送（因为没有授权机制，如果允许推送操作，每一个知道该URL的人都有推送权限），比http协议高效。</li>
<li>http/s协议：容易搭建，通常用来克隆。</li>
</ul>
</li>
</ul>
<h2 id="git-remote">
  git remote
  <a class="anchor" href="#git-remote">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#列出指定的每一个远程服务器的简写</span>
</span></span><span style="display:flex;"><span>git remote
</span></span><span style="display:flex;"><span><span style="color:#75715e">#显示远程仓库的简写与对应的URL</span>
</span></span><span style="display:flex;"><span>git remote -v
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看某个远程仓库的更多信息，会列出远程仓库的URL和跟踪分支的信息。</span>
</span></span><span style="display:flex;"><span>git remote show origin
</span></span><span style="display:flex;"><span><span style="color:#75715e">#添加一个远程仓库，并指定一个简写</span>
</span></span><span style="display:flex;"><span>git remote add origin https://xxx.xxx/xxx/xxx
</span></span><span style="display:flex;"><span><span style="color:#75715e">#修改仓库的远程地址</span>
</span></span><span style="display:flex;"><span>git remote set-url origin 仓库地址
</span></span><span style="display:flex;"><span><span style="color:#75715e">#远程仓库的重命名</span>
</span></span><span style="display:flex;"><span>git remote rename origin paul
</span></span><span style="display:flex;"><span><span style="color:#75715e">#移除一个远程仓库</span>
</span></span><span style="display:flex;"><span>git remote remove paul
</span></span><span style="display:flex;"><span><span style="color:#75715e">#git fetch只会将数据下载到本地仓库，并不会合并。需要手动合并</span>
</span></span><span style="display:flex;"><span>git fetch origin
</span></span><span style="display:flex;"><span><span style="color:#75715e">#自动抓取远程分支并合并到本地分支</span>
</span></span><span style="display:flex;"><span>git pull
</span></span></code></pre></div><h2 id="git-branch">
  git branch
  <a class="anchor" href="#git-branch">#</a>
</h2>
<ul>
<li>只有在本地修改或者产生了文件才会创建主分支master，这个时候才能创建新分支。</li>
<li><code>git branch</code>查看所有的分支，<code>*</code>表示当前分支。</li>
<li><code>git checkout -b testing</code>相当于<code>git branch testing (创建一个分支)和 git checkout testing（切到该分支）</code></li>
<li>删除分支<code>git branch -d testing</code></li>
<li>分支的合并：在当前分支下（如master），执行<code>git merge testing</code>，会创建新的commit对象，master也会指向他。该commit对象有两个父指针。</li>
<li>分支的合并会用两个分支的末端以及他们的共同祖先进行一次的三方合并，当两个分支在同一个commit链上时，旧一点的那个分支发起合并，则将其直接指向了新一点的那个分支。</li>
<li>有时候分支合并会失败，比如两个分支同时修改了相同的文件。这个时候<code>git merge testing</code>仍然做了合并，但是没有提交，可以使用<code>git status</code>查看，此时就需要手动合并了。</li>
<li><code>git branch --merged</code>查看那些分支已被并入当前分支。<code>git branch --no-merged</code>查看尚未合并的分支。</li>
</ul>
<p><strong>参考链接：</strong>
  <a href="http://git.oschina.net/progit/">Pro Git</a></p>
<p><strong>参考链接：</strong>
  <a href="https://git-scm.com/book/zh/v2/Git-%e5%9f%ba%e7%a1%80-%e8%ae%b0%e5%bd%95%e6%af%8f%e6%ac%a1%e6%9b%b4%e6%96%b0%e5%88%b0%e4%bb%93%e5%ba%93">Git - 记录每次更新到仓库 (git-scm.com)</a></p>
<p><strong>参考链接：</strong><a href="https://gitee.com/opensource-guide/git_tutorial/Git 命令详解/常用 Git 命令/#git-命令手册">开源指北</a></p>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/11/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/11/" aria-label="Page 11" class="page-link" role="button">11</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 12" class="page-link" role="button">12</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/14/" aria-label="Page 14" class="page-link" role="button">14</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/13/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  


 
      </footer>
    </div>

  </main>

</body>
</html>











