<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>12</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>12</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javase/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/">垃圾回收相关概念</a>
    </h2>
    
  <h5>2020-09-29</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h3 id="systemgc的理解">
  System.gc()的理解
  <a class="anchor" href="#systemgc%e7%9a%84%e7%90%86%e8%a7%a3">#</a>
</h3>
<ul>
<li>在默认情况下，通过System.gc()或者Runtime.getRuntime().gc()的调用会显示触发Full GC，但是该方法可能不是立刻就执行。</li>
</ul>
<h3 id="内存溢出">
  内存溢出
  <a class="anchor" href="#%e5%86%85%e5%ad%98%e6%ba%a2%e5%87%ba">#</a>
</h3>
<ul>
<li>产生原因：没有空闲内存，并且垃圾收集器也无法提供更多内存。</li>
</ul>
<h3 id="内存泄漏">
  内存泄漏
  <a class="anchor" href="#%e5%86%85%e5%ad%98%e6%b3%84%e6%bc%8f">#</a>
</h3>
<ul>
<li>严格定义：对象不再被程序使用了，但是GC又不能回收他们的情况（仍然存在引用链）。</li>
<li>宽泛定义：一些不太好的实践会导致对象的生命周期变得很长，甚至导致OOM，也叫宽泛意义上的内存泄漏。</li>
</ul>
<h3 id="安全点">
  安全点
  <a class="anchor" href="#%e5%ae%89%e5%85%a8%e7%82%b9">#</a>
</h3>
<ul>
<li>程序执行时并非在所有的地方都能停下来开始GC，只有在特定的位置才能停顿下来开始GC，这些位置称为“安全点”（safepoint）。</li>
<li>如何在GC发生时，检测所有的程序都跑到最近的安全点停顿下来了呢 &ndash;&gt; 主动式中断：设置一个中断标志，各个线程运行到safe point的时候主动轮询这个标志，如果中断标志为真，则将自己进行中断挂起。</li>
</ul>
<h3 id="安全区域">
  安全区域
  <a class="anchor" href="#%e5%ae%89%e5%85%a8%e5%8c%ba%e5%9f%9f">#</a>
</h3>
<ul>
<li>指在一段代码片段中，对象的引用关系不会发生变化，在这个区域中的任何位置开始GC都是安全的。</li>
<li>可以应对处于sleep或者blocked状态的线程，这时候线程无法响应jvm的中断请求，“走”到安全点去中断挂起。</li>
<li>当程序运行到safe region的代码时，首先标识已经进入了safe region，如果这段时间发生了gc，jvm会忽略标识为safe region状态的线程。</li>
<li>当线程即将离开safe region时，会检测jvm是否已经完成了gc，如果完成了，则继续运行，否则线程必须等待直到收到可以安全离开safe region的信号为止。</li>
</ul>
<h3 id="引用">
  引用
  <a class="anchor" href="#%e5%bc%95%e7%94%a8">#</a>
</h3>
<ul>
<li>
<p><strong>强引用</strong>：类似“Object object=new Object()”这类的引用，只要强引用还存在，就永不回收。</p>
</li>
<li>
<p><strong>软引用</strong>：内存不足才回收。</p>
</li>
<li>
<p><strong>弱引用</strong>：发现即回收。</p>
</li>
<li>
<p><strong>虚引用</strong>：对象回收跟踪。</p>
<ul>
<li>如果一个对象仅持有虚引用，那么它和没有引用几乎是一样的，随时都可能被垃圾回收器回收。</li>
<li>它不能单独使用，也无法通过虚引用来获取被引用的对象。当试图通过虚引用的get方法来获取对象时，总是null。</li>
<li>为一个对象设置虚引用关联的唯一目的就是能够在这个对象被收集器回收时收到一个系统通知。</li>
<li>虚引用必须和引用队列一起使用。虚引用在创建时必须提供一个引用队列作为参数。当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，就会在回收对象后，将这个虚引用加入引用队列，以通知引用程序对象的回收情况。</li>
<li>由于虚引用可以跟踪对象的回收时间，因此，也可以将一些资源释放操作放置在虚引用中执行和记录。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//声明强引用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Object obj<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Object<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//声明软引用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SoftReference<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> sf<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> SoftReference<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;(</span><span style="color:#66d9ef">new</span> Object<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//声明弱引用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>WeakReference<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> wr<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> WeakReference<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;(</span><span style="color:#66d9ef">new</span> Object<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//虚引用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Object obj<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Object<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>ReferenceQueue<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> rq<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> ReferenceQueue<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>PhantomReference<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> pr<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> PhantomReference<span style="color:#f92672">&lt;&gt;(</span>obj<span style="color:#f92672">,</span>rq<span style="color:#f92672">);</span>
</span></span></code></pre></div><h3 id="评估性能指标">
  评估性能指标
  <a class="anchor" href="#%e8%af%84%e4%bc%b0%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87">#</a>
</h3>
<ul>
<li><strong>吞吐量</strong>：运行用户代码时间占总运行时间的比例。</li>
<li>垃圾收集开销：吞吐量的补数，垃圾收集所用时间与总运行时间的比例。</li>
<li><strong>暂停时间</strong>：执行垃圾收集时，程序的工作线程被暂停的时间。</li>
<li>收集频率：相对于应用程序的执行，收集操作发生的频率。</li>
<li>内存占用：Java堆区所占的内存大小。</li>
<li>快速：一个对象从诞生到被回收所经历的时间。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javase/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/">垃圾回收算法</a>
    </h2>
    
  <h5>2020-09-27</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h3 id="垃圾标记算法">
  垃圾标记算法
  <a class="anchor" href="#%e5%9e%83%e5%9c%be%e6%a0%87%e8%ae%b0%e7%ae%97%e6%b3%95">#</a>
</h3>
<ul>
<li>
<p><strong>引用计数器法</strong></p>
<ul>
<li>给一个对象中添加一个引用计数器，每当有一个地方引用它时，计数器值就加1；当引用失效时，计数器值就减1；任何时刻计数器为0的对象就是不可能再被使用的。</li>
<li>优点：实现简单，垃圾对象便于识别；判定效率高，回收没有延迟性。</li>
<li>缺点：需要单独的字段存储计数器，增加了存储空间的开销；每次赋值都要更新计数器，伴随着加减法的操作，增加了时间开销；引用计数器有一个严重的问题，即<strong>无法处理循环引用情况</strong>。这是一个致命缺陷，导致java在垃圾回收器中没有使用这类算法。</li>
</ul>
</li>
<li>
<p><strong>可达性分析算法</strong></p>
<ul>
<li>基本思路：以根对象集合（GC Roots）为起始点，从这些节点开始向下搜索，搜索走过的路径称为引用链，当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的。</li>
<li>GC Roots包括：①虚拟机栈中引用的对象；②类静态属性引用的对象；③方法区中常量引用的对象；④本地方法栈中（Native方法）引用的对象；⑤被synchronized持有的对象；⑥jvm内部的引用。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="finalize">
  finalize
  <a class="anchor" href="#finalize">#</a>
</h3>
<ul>
<li>
<p>垃圾回收之前总会调用finalize方法，该方法可以被重写：通常是在这个方法中进行一些资源释放和清理的工作。</p>
</li>
<li>
<p>不要主动调用该方法，该方法的执行时间是没有保障的，它完全由gc线程决定。垃圾回收机制会主动调用该方法。</p>
</li>
<li>
<p>finalize方法只能被调用一次。</p>
</li>
<li>
<p>对象的三种状态：可触及；可复活；不可触及。</p>
</li>
<li>
<p>判断一个对象是否可回收，至少经历两次标记过程：</p>
<ol>
<li>如果对象到gc roots没有引用链，则进行第一次标记</li>
<li>进行筛选，判断该对象是否有必要执行finalize方法：①如果对象没有重写finalize方法，或者finalize方法已经被虚拟机调用过，则虚拟机视为“没有必要执行”，该对象被判为不可及的；②如果对象重写了finalize方法且还未执行过，那么该对象将被插入到F-Queue队列中，由一个低优先级、虚拟机自动创建的Finalizer线程区执行它；③finalize方法是对象逃脱死亡命运的最后一次机会，稍后GC会对F-Queue中的对象进行第二次标记，如果对象在finalize方法中重新与引用链上的任意一个对象建立了联系，那么在第二次标记时它将被移出“即将回收”的集合。之后，如果该对象再次出现没有引用存在的情况下，finalize方法不会再次调用，对象会直接变为不可及的状态。也就是说一个对象的finalize方法就被调用一次。</li>
</ol>
</li>
</ul>
<h3 id="垃圾收集算法">
  垃圾收集算法
  <a class="anchor" href="#%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e7%ae%97%e6%b3%95">#</a>
</h3>
<ul>
<li>
<p><strong>标记-清除算法（Mark-Sweep）</strong></p>
<ul>
<li>执行过程：当堆中的有效内存空间被耗尽的时候，就会停止整个程序（STW），然后进行两项工作，第一项是标记，第二项是回收。</li>
<li>标记：从根节点开始，标记所有被引用的对象。一般是在对象的Header中记录为可达对象。</li>
<li>清除：对堆内存从头到尾进行线性的遍历，如果发现某个对象在其header中没有被标记为可达对象，则将其回收。</li>
<li>优点：实现简单。</li>
<li>缺点：效率不够高；导致STW；会导致内存空间不连续，产生内存碎片，需要维护一个空闲列表。</li>
</ul>
</li>
</ul>
<p>
  <img src="/img/%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/1.jpg" alt="标记-清除算法" /></p>
<ul>
<li>
<p><strong>复制算法</strong></p>
<ul>
<li>执行过程：将可用内存按容量分为大小相等的两块，每次只使用其中一块。当这一块的内存用完了，就将还活着的对象复制到另外一块上面去，然后再把已使用过的内存空间一次清理掉。</li>
<li>优点：实现简单；运行高效，不会出现内存碎片。</li>
<li>缺点：需要两倍的内存空间。</li>
<li>适用场景：存活对象比较少，垃圾对象比较多的场景。</li>
</ul>
</li>
</ul>
<p>
  <img src="/img/%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/2.jpg" alt="复制算法" /></p>
<ul>
<li><strong>标记-压缩（整理）算法</strong>
<ul>
<li>执行过程：第一阶段和标记-清除算法一样，从根节点标记所有被引用的对象。第二阶段是将所有存活对象整理到内存的一端，按顺序排放。之后清理边界外的所有对象。</li>
<li>指针碰撞：如果内存空间以规整、有序的方式分布，即已用和未用的内存都各自一边，彼此之间维系着一个记录下一次分配起始点的标记指针，当为新对象分配内存时，只需要通过修改指针的偏移量将新对象分配在第一个空闲内存位置上，这种分配方式就叫指针碰撞（Bump the Pointer）。</li>
<li>优点：解决了内存碎片化的问题；消除了复制算法中内存减半的问题。</li>
<li>缺点：效率低于复制算法和标记-清除算法；移动对象的同时，还要调整引用的地址；会导致stw。</li>
</ul>
</li>
</ul>
<p>
  <img src="/img/%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/3.jpg" alt="标记-整理算法" /></p>
<ul>
<li>
<p><strong>分代收集算法</strong></p>
<ul>
<li>不同的对象的生命周期是不一样的。因此，不同生命周期的对象可以采用不同的收集方式，以提高回收效率。一般把java堆分为新生代和老年代，这样就可以根据各个年代的特点使用不同的回收算法，以提高垃圾回收的效率。</li>
</ul>
</li>
<li>
<p><strong>增量收集算法</strong></p>
<ul>
<li>如果一次将所有的垃圾进行处理，需要造成系统长时间的停顿，那么就可以让垃圾收集线程和应用程序线程交替执行。每次，垃圾收集线程只收集一小片区域的内存空间，接着切换到应用程序线程，依次反复，直到垃圾收集完成。</li>
<li>总的来说，增量收集算法的基础仍然是传统的标记-清除算法和复制算法。增量收集算法通过对线程间冲突的妥善处理，允许垃圾收集器以分阶段的方式完成标记、清理和复制工作。</li>
<li>缺点：线程切换和上下文转换的消耗，会使得垃圾回收的总体成本上升，造成系统吞吐量下降。</li>
</ul>
</li>
<li>
<p><strong>分区算法</strong></p>
<ul>
<li>将堆空间划分为连续不同的小区间region，每一个小区间都独立使用，独立回收。这种算法的好处是可以控制一次回收多少个小区间。</li>
</ul>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javase/String/">String</a>
    </h2>
    
  <h5>2020-09-25</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h3 id="string的基本特性">
  String的基本特性
  <a class="anchor" href="#string%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%89%b9%e6%80%a7">#</a>
</h3>
<ul>
<li>
<p>String类的声明为final。</p>
</li>
<li>
<p>String实现了Serializable接口：表明字符串是支持序列化的。实现了Comparable接口：表面字符串是可以比较大小。</p>
</li>
<li>
<p>String再jdk8及以前使用 final char[] value存储字符串数据，jdk9改为byte[]。</p>
</li>
<li>
<p>String的字符串常量池是一个固定大小的hashtable，在jdk7中默认大小是60013，（jdk8中1009是可以设置的最小值），使用<b>-XX:StringTableSize=</b>可以设置StringTable的长度。如果字符串常量池中的字符串非常多，就可能会造成hash冲突，从而导致链表变得很长（链表长度大于8时会转化成红黑树），但还是会导致性能下降（比如在调用intern时）。</p>
</li>
<li>
<p>字符串的拼接操作</p>
<ul>
<li>常量与常量的拼接是放在String Pool中，原因是编译期优化。</li>
<li>只要其中有一个是变量，结果就放在堆中。变量拼接的原理是StringBuilder。</li>
<li>如果拼接的结果调用intern方法，则主动将常量池中还没有的字符串放入池中，并返回其地址（如果String Pool中有，则直接返回其地址），下面还要对intern进行讨论。</li>
</ul>
</li>
</ul>
<h3 id="字符串的拼接操作">
  字符串的拼接操作
  <a class="anchor" href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e6%8b%bc%e6%8e%a5%e6%93%8d%e4%bd%9c">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String s1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>String s2<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>String s3<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ab&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>String s4<span style="color:#f92672">=</span>s1<span style="color:#f92672">+</span>s2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">如果被拼接的字符串中有变量，执行字符串拼接操作会进行如下几个步骤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">①StringBuilder s=new StringBuilder();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">②s.append(s1); s.append(s2);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">③s.toString();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">如果要被拼接的字符串中全是常量或者常量引用，则仍然使用编译器优化，不会涉及到上面三步。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>s4<span style="color:#f92672">==</span>s3<span style="color:#f92672">);</span><span style="color:#75715e">//false
</span></span></span></code></pre></div><h3 id="部分源码分析">
  部分源码分析
  <a class="anchor" href="#%e9%83%a8%e5%88%86%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//下面这两行代码输出的结果为什么是nullabc呢？一起来分析一下源码吧
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>String s<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;abc&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span><span style="color:#75715e">//nullabc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//StringBuilder类，当传入一个对象时会将该对象转化成一个字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> StringBuilder <span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> append<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//String类，当该对象为null时，会返回一个&#34;null&#34;字符串，否则返回该对象的toString方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>obj <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;null&#34;</span> <span style="color:#f92672">:</span> obj<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="部分考点分析">
  部分考点分析
  <a class="anchor" href="#%e9%83%a8%e5%88%86%e8%80%83%e7%82%b9%e5%88%86%e6%9e%90">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String s<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ab&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">创建了两个对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象1：new String(&#34;ab&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象2：常量池中的&#34;ab&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String s1<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)+</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">创建了6个对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象1：new StringBuilder();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象2：new String(&#34;a&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象3：常量池中的&#34;a&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象4：new String(&#34;b&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象5：常量池中的&#34;b&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对象6：当append操作结束后，会调用StringBuilder的toString方法，将StringBuilder对象转化为String对象，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	此时又发生了一次new的操作:new String(value, 0, count);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">tips：这里虽然创建了6个对象，但实际上在常量池中并没有创建&#34;ab&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><h3 id="intern">
  intern
  <a class="anchor" href="#intern">#</a>
</h3>
<p>从jdk7开始，当我们调用String对象的intern()方法：</p>
<ul>
<li>如果常量池中有这个字符串，则返回常量池中该串的地址。</li>
<li>如果常量池中没有该串，则会把<strong>对象的引用地址</strong>复制一份，放入常量池，并返回常量池中的引用地址。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String s1<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ab&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>s1<span style="color:#f92672">.</span><span style="color:#a6e22e">intern</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>String s2<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ab&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>s1<span style="color:#f92672">==</span>s2<span style="color:#f92672">);</span><span style="color:#75715e">//false;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">这是因为一个是堆中的对象，一个是常量池中的对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String s3<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)+</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>s3<span style="color:#f92672">.</span><span style="color:#a6e22e">intern</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>String s4<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ab&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>s3<span style="color:#f92672">==</span>s4<span style="color:#f92672">);</span><span style="color:#75715e">//true(jdk7及以上版本的结果);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">这个是不是感觉很匪夷所思？
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">原因是在创建了s3之后，常量池中并没有&#34;ab&#34;这个对象，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">而在执行s3.intern()后，常量池中多了一个指向堆中的对象的指针，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">所以当执行s4=&#34;ab&#34;时，s4实际上也是指向了堆中创建的那个对象。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">为什么这么做呢？指针才占4个字节，用指针省空间。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javase/%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%8F%8A%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/">对象实例化及内存布局</a>
    </h2>
    
  <h5>2020-09-25</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h2 id="创建对象的步骤">
  创建对象的步骤
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e5%af%b9%e8%b1%a1%e7%9a%84%e6%ad%a5%e9%aa%a4">#</a>
</h2>
<ol>
<li>
<p>当遇到一条new指令时，首先判断能否在常量池中定位到一个类的符号应用，并检查这个符号引用代表的类是否加载、解析和初始化</p>
</li>
<li>
<p>为对象分配内存，对象所需的内存大小在类加载完后就可完全确定</p>
<ul>
<li>如果内存规整，指针碰撞。</li>
<li>如果内存不规整，虚拟机需要维护一个列表，空闲列表分配。</li>
</ul>
</li>
<li>
<p>处理并发安全问题</p>
<ul>
<li>采用cas失败重试</li>
<li>每个线程预先分配一块TLAB，通过-XX:+/-UseTLAB参数来设置。</li>
</ul>
</li>
<li>
<p>对象属性初始化，即所有属性设置0值。</p>
</li>
<li>
<p>设置对象的对象头。</p>
</li>
<li>
<p>属性的显式初始化、代码块中初始化、执行init方法进行初始化。</p>
</li>
</ol>
<h2 id="对象的内存布局">
  对象的内存布局
  <a class="anchor" href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e5%86%85%e5%ad%98%e5%b8%83%e5%b1%80">#</a>
</h2>
<ol>
<li>
<p>对象头，包括如下信息：</p>
<ul>
<li>运行时元数据：哈希值，gc分代年龄，锁状态标志，线程持有的锁，偏向线程id，偏向时间戳。</li>
<li>类型指针：指向类元数据的指针，确定该对象是哪个类的实例。</li>
<li>如果是数组，还需记录数组的长度。</li>
</ul>
</li>
<li>
<p>实例数据：它是真正存储的有效信息，包括程序代码中定义的各种类型的字段（包括从父类继承下来的和本身拥有的字段）。</p>
<ul>
<li>规则：相同宽度的字段总是被分配在一起；父类定义的变量会出现在子类之前；如果compactFields参数为true（默认为true），子类的窄变量可能插入到父类变量的空隙。</li>
</ul>
</li>
<li>
<p>对齐填充</p>
<ul>
<li>仅仅起着占位符的作用，hotspot虚拟机要求任何对象的大小都必须是8字节的整数倍。</li>
</ul>
</li>
</ol>
<p>
  <img src="/img/%e5%af%b9%e8%b1%a1%e5%ae%9e%e5%8a%9b%e5%8c%96%e5%86%85%e5%ad%98%e5%b8%83%e5%b1%80%e4%b8%8e%e8%ae%bf%e9%97%ae%e5%ae%9a%e4%bd%8d/1.jpg" alt="内存布局" /></p>
<h3 id="访问定位">
  访问定位
  <a class="anchor" href="#%e8%ae%bf%e9%97%ae%e5%ae%9a%e4%bd%8d">#</a>
</h3>
<ul>
<li>直接指针</li>
<li>句柄访问
<ul>
<li>java堆中会划分出一块内存来作为句柄池，引用中存放的就是对象的句柄地址，句柄中包含了对象实例数据的指针和对象类型的指针。</li>
</ul>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">观察者模式</a>
    </h2>
    
  <h5>2020-09-25</h5>



  

  
  <div>
    
      <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
  




    <p><ul>
<li>定义：对象间的一种一对多的依赖关系，以便当一个对象的状态发生改变时，能够自动通知其他关联对象，自动刷新对象状态。</li>
<li>Observer模式提供给关联对象一种同步通信的手段，使某个对象与依赖它的其他对象之间保持状态同步。</li>
</ul>
<h3 id="类图">
  类图
  <a class="anchor" href="#%e7%b1%bb%e5%9b%be">#</a>
</h3>
<p>
  <img src="/img/%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f/1.jpg" alt="观察者模式" /></p>
<ul>
<li>简单解释一下：在Subject类中维护了一个Observer对象列表，通过调用Subject的Attach方法将对象加入该列表，调用Detach将对象从该列表中移除。Subject中某些事件发生改变时，就会调用Notify方法。Notify方法中有一个循环，它会调用所有在列表中的对象的Update方法，达到通知的目的。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82/">抽象工厂</a>
    </h2>
    
  <h5>2020-09-22</h5>



  

  
  <div>
    
      <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
  




    <p><h3 id="定义">
  定义
  <a class="anchor" href="#%e5%ae%9a%e4%b9%89">#</a>
</h3>
<p>提供一个接口，让该接口负责创建一系列“相关或者相互依赖的对象”，无序指定他们具体的类。</p>
<h3 id="理解">
  理解
  <a class="anchor" href="#%e7%90%86%e8%a7%a3">#</a>
</h3>
<ul>
<li>一系列相互依赖对象的创建。比如servlet使用 mysql对数据库处理的对象 或者 sqlserver对数据库处理的对象 ，由于mysql对应的类是不能使用sqlserver对应的类的，所以在这里我们就可以使用抽象工厂创建对象。</li>
<li>主要在于应对对“新系列”的需求变动。缺点在于难以应对“新对象”的需求变动。</li>
</ul>
<h3 id="类图">
  类图
  <a class="anchor" href="#%e7%b1%bb%e5%9b%be">#</a>
</h3>
<p>
  <img src="/img/%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82/1.jpg" alt="抽象工厂类图" /></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/">工厂方法</a>
    </h2>
    
  <h5>2020-09-22</h5>



  

  
  <div>
    
      <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
  




    <p><h3 id="定义">
  定义
  <a class="anchor" href="#%e5%ae%9a%e4%b9%89">#</a>
</h3>
<p>定义一个用于创建对象的接口，让子类决定实例化哪一个类，Factory Method使得一个类的实例化延迟。</p>
<h3 id="理解">
  理解
  <a class="anchor" href="#%e7%90%86%e8%a7%a3">#</a>
</h3>
<ul>
<li>使用new违背了依赖倒置原则，导致程序间的紧耦合。</li>
<li>该模式隔离了对象的使用者和具体类型之间的耦合关系。面对一个经常变化的具体类型，紧耦合（new）会导致软件的脆弱。</li>
<li>通过面向对象的手法，将所要创建对象的工作延迟到了子类。从而实现了一种扩展的策略（而非更改），较好的解决了这种紧耦合的关系。</li>
</ul>
<h3 id="代码">
  代码
  <a class="anchor" href="#%e4%bb%a3%e7%a0%81">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//代表所有车
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Car</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//比亚迪
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Biyadi</span> <span style="color:#66d9ef">implements</span> Car<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;比亚迪run&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//奥迪
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Aodi</span> <span style="color:#66d9ef">implements</span> Car<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;奥迪run&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//工厂
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CarFactory</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createCar</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//具体的实现
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BiyadiCarFactory</span> <span style="color:#66d9ef">implements</span> CarFactory<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createCar</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Biyadi<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AodiCarFactory</span> <span style="color:#66d9ef">implements</span> CarFactory<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createCar</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Aodi<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="场景">
  场景
  <a class="anchor" href="#%e5%9c%ba%e6%99%af">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//使用工厂方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">travel</span><span style="color:#f92672">(</span>CarFactory carFactory<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//我开什么车去旅游全凭其他人给我什么车，假如公司有钱了，可能给我传递了更好的车
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Car car<span style="color:#f92672">=</span>carFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">createCar</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    car<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*虽然可能还是会有依赖，但是在本实现中依赖基本上已经消失了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">其实依赖不可能完全消失，我们使用模式的时候可能只是将散落在程序各个部分的依赖都集中起来*/</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//不使用工厂方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">travel</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//我只能开比亚迪去旅游，不能被更改
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Car car<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> BiyadiCar<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    car<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/">装饰模式</a>
    </h2>
    
  <h5>2020-09-21</h5>



  

  
  <div>
    
      <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
  




    <p><h3 id="定义">
  定义
  <a class="anchor" href="#%e5%ae%9a%e4%b9%89">#</a>
</h3>
<p>动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码&amp;减少子类个数）。</p>
<h3 id="理解">
  理解
  <a class="anchor" href="#%e7%90%86%e8%a7%a3">#</a>
</h3>
<ul>
<li>java中的各种包装流就是用的装饰模式。</li>
<li>使用组合代替了不好的继承，使类的数量大大大的减少。</li>
<li>解决主体类在多个方向上的扩展功能。</li>
</ul>
<h3 id="案例">
  案例
  <a class="anchor" href="#%e6%a1%88%e4%be%8b">#</a>
</h3>
<p>有一个类叫OutputStream，其完成一个打印的功能。</p>
<p>现在A想对该类进行扩充，使其有缓冲的功能。</p>
<p>B也想对该类进行扩充，使其输出更加安全。</p>
<p>C也想对该类进行扩充，使其输出到文件中。</p>
<p>这我们都可以通过类继承来完成，并且看上去似乎也没有什么问题。但是假如D也想对该类进行缓冲，使其既有缓冲，又更安全，这时候再使用类继承就不合适了。</p>
<p>此时我们可以使用装饰模式来解决该问题。</p>
<p>
  <img src="/img/%e8%a3%85%e9%a5%b0%e6%a8%a1%e5%bc%8f/1.jpg" alt="类图" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">OutputStream</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteOutputStream</span> <span style="color:#66d9ef">implements</span> OutputStream<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">(){}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//装饰器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Decorator</span> <span style="color:#66d9ef">implements</span> OutputStream<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> OutputStream  outputStream<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Decorator</span><span style="color:#f92672">(</span>OutputStream outputStream<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">outputStream</span><span style="color:#f92672">=</span>outputStream<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span>  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        outputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BufferedOutputStream</span> <span style="color:#66d9ef">extends</span> Decorator<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">BufferedOutputStream</span><span style="color:#f92672">(</span>OutputStream outputStream<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>outputStream<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;I am BufferedOutputStream&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//安全
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecureOutputStream</span> <span style="color:#66d9ef">extends</span> Decorator<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">SecureOutputStream</span><span style="color:#f92672">(</span>OutputStream outputStream<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>outputStream<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;I am SecureOutputStream&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//输出到文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileOutputStream</span> <span style="color:#66d9ef">extends</span> Decorator<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">FileOutputStream</span><span style="color:#f92672">(</span>OutputStream outputStream<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>outputStream<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;I am FileOutputStream&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/14/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/14/" aria-label="Page 14" class="page-link" role="button">14</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 15" class="page-link" role="button">15</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/16/" aria-label="Page 16" class="page-link" role="button">16</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/17/" aria-label="Page 17" class="page-link" role="button">17</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/16/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  


 
      </footer>
    </div>

  </main>

</body>
</html>











