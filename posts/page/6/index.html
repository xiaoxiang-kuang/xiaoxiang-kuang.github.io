<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>9</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javase/java%E6%AD%A3%E5%88%99/">java正则</a>
    </h2>
    
  <h5>2021-11-02</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><table>
<thead>
<tr>
<th>字符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>\d</td>
<td>匹配数字，等效于[0-9]</td>
</tr>
<tr>
<td>\D</td>
<td>等效于[^0-9]</td>
</tr>
<tr>
<td>\w</td>
<td>等效于[A-Za-z0-9_]</td>
</tr>
<tr>
<td>\W</td>
<td>等效于[^A-Za-z0-9_]</td>
</tr>
<tr>
<td>\s</td>
<td>匹配任何空白字符</td>
</tr>
<tr>
<td>\S</td>
<td>匹配任何非空白字符</td>
</tr>
<tr>
<td>x|y</td>
<td>匹配x或y</td>
</tr>
<tr>
<td>?</td>
<td>当跟在其他限定符后表示是非贪心的</td>
</tr>
<tr>
<td>{n} {n,} {n,m}</td>
<td>匹配n次 最少匹配n次 匹配n到m次</td>
</tr>
<tr>
<td>^ $</td>
<td>匹配字符串开始位置 匹配字符串结束位置</td>
</tr>
<tr>
<td>\</td>
<td>转义</td>
</tr>
<tr>
<td>* +</td>
<td>匹配0到无数次 匹配1到无数次</td>
</tr>
<tr>
<td>[^a-z] [a-zA-Z]</td>
<td>不匹配a到z中的任何字符 匹配a到z、A到Z的任何字符</td>
</tr>
</tbody>
</table>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/mybatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/">mybatis映射文件</a>
    </h2>
    
  <h5>2021-10-31</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h2 id="resultmap">
  resultMap
  <a class="anchor" href="#resultmap">#</a>
</h2>
<ul>
<li>当返回结果时（未显示指定resultmap），mybatis会创建一个ResultMap，将属性名映射到实体类的属性上，如果列名和属性名不能匹配时，可以在select语句中设置别名来完成匹配，如<code>user_id as &quot;id&quot;</code>。</li>
</ul>
<h3 id="属性">
  属性
  <a class="anchor" href="#%e5%b1%9e%e6%80%a7">#</a>
</h3>
<ul>
<li>id 唯一标识，别的地方引用</li>
<li>type 类的完全限定命名，或者类型别名。</li>
<li>autoMapping 如果设置这个属性，mybatis将会为本结果映射开启或关闭自动映射。这个属性会覆盖全局的autoMappingBehavior。</li>
</ul>
<h3 id="元素">
  元素
  <a class="anchor" href="#%e5%85%83%e7%b4%a0">#</a>
</h3>
<ul>
<li>
<p><code>constructor</code> 用于在实例化类时，注入结果到构造方法中</p>
<ul>
<li><code>idArg</code> ID参数；标记出作为ID的结果可以帮助提高整体性能</li>
<li><code>arg</code> 将被注入到构造方法的一个普通结果</li>
</ul>
</li>
<li>
<p><code>id</code> 标记作为ID的结果可以帮助提高整体性能</p>
</li>
<li>
<p><code>result</code> 注入到实体类的普通结果</p>
</li>
<li>
<p><code>association</code> 关联一个复杂的类型，即数据库的一对一。</p>
</li>
<li>
<p><code>collection</code> 数据库的一对多</p>
</li>
<li>
<p><code>discriminator</code> 使用结果值来决定使用哪个resultMap</p>
<ul>
<li>case 基于某些值的结果映射</li>
</ul>
</li>
<li>
<p>id和result唯一的不同是，id元素对应的属性会被标记为对象的标识符，在比较对象实例时使用，能提高整体的性能。</p>
</li>
</ul>
<h4 id="idresult">
  id&amp;result
  <a class="anchor" href="#idresult">#</a>
</h4>
<ul>
<li><code>property</code> 映射到列的属性，如果实体类有这个名字的property，会先使用该属性。</li>
<li><code>column</code> 数据库中的列名，或者是列的别名。</li>
<li><code>javaType</code> 一个Java类的全限定命名，或者一个类型别名。如果映射到实体类，mybatis通常可以推断类型。如果映射到HashMap，则应该明确指定javaType来保证类型一致。</li>
<li><code>jdbcType</code> JDBC类型，只有可为空的列上能指定JDBC类型。</li>
<li><code>typeHandler</code> 指定类型处理器，需要是全限定命名或者类型别名。</li>
</ul>
<h4 id="association">
  association
  <a class="anchor" href="#association">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;blogResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_id&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_title&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- 这里的author指的是Blog中的属性 --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;association</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_author_id&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;Author&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;authorResult&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;authorResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Author&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_id&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_username&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_password&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 或者使用下面的形式--&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;blogResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_id&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_title&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;association</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;Author&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_id&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_username&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author_password&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/association&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">select</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;selectBlog&#34;</span> resultMap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blogResult&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>    B.id            <span style="color:#66d9ef">as</span> blog_id,
</span></span><span style="display:flex;"><span>    B.title         <span style="color:#66d9ef">as</span> blog_title,
</span></span><span style="display:flex;"><span>    B.author_id     <span style="color:#66d9ef">as</span> blog_author_id,
</span></span><span style="display:flex;"><span>    A.id            <span style="color:#66d9ef">as</span> author_id,
</span></span><span style="display:flex;"><span>    A.username      <span style="color:#66d9ef">as</span> author_username,
</span></span><span style="display:flex;"><span>    A.password      <span style="color:#66d9ef">as</span> author_password,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">from</span> Blog B <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">outer</span> <span style="color:#66d9ef">join</span> Author A <span style="color:#66d9ef">on</span> B.author_id <span style="color:#f92672">=</span> A.id
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">where</span> B.id <span style="color:#f92672">=</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id,javaType<span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/</span><span style="color:#66d9ef">select</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><h4 id="collection">
  collection
  <a class="anchor" href="#collection">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;blogResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_id&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_title&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;posts&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;Post&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;blogPostResult&#34;</span> <span style="color:#a6e22e">columnPrefix=</span><span style="color:#e6db74">&#34;post_&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;blogPostResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Post&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;subject&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;subject&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;body&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 或者使用下面这种形式 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;blogResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_id&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;blog_title&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;posts&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;Post&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;post_id&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;subject&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;post_subject&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;body&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;post_body&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/collection&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/resultMap&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">select</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;selectBlog&#34;</span> resultMap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blogResult&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>  B.id <span style="color:#66d9ef">as</span> blog_id,
</span></span><span style="display:flex;"><span>  B.title <span style="color:#66d9ef">as</span> blog_title,
</span></span><span style="display:flex;"><span>  B.author_id <span style="color:#66d9ef">as</span> blog_author_id,
</span></span><span style="display:flex;"><span>  P.id <span style="color:#66d9ef">as</span> post_id,
</span></span><span style="display:flex;"><span>  P.subject <span style="color:#66d9ef">as</span> post_subject,
</span></span><span style="display:flex;"><span>  P.body <span style="color:#66d9ef">as</span> post_body,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">from</span> Blog B
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">outer</span> <span style="color:#66d9ef">join</span> Post P <span style="color:#66d9ef">on</span> B.id <span style="color:#f92672">=</span> P.blog_id
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">where</span> B.id <span style="color:#f92672">=</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id<span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/</span><span style="color:#66d9ef">select</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/nacos/">nacos</a>
    </h2>
    
  <h5>2021-10-28</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#服务注册：</span>
</span></span><span style="display:flex;"><span>curl -X POST <span style="color:#e6db74">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=xiaoxiang&amp;ip=192.168.1.2&amp;port=8080&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#服务发现：</span>
</span></span><span style="display:flex;"><span>curl -X GET <span style="color:#e6db74">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=nacos.naming.serviceName&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#发布配置：</span>
</span></span><span style="display:flex;"><span>curl -X POST <span style="color:#e6db74">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&amp;content=HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取配置：</span>
</span></span><span style="display:flex;"><span>curl -X GET <span style="color:#e6db74">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&#34;</span>
</span></span></code></pre></div><p><strong>一个nacos简单案例，之后会接着补充的：</strong>
  <a href="https://gitee.com/xiaoxiangmax/nacos">nacos: naocs-demon (gitee.com)</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/flume/">flume</a>
    </h2>
    
  <h5>2021-10-27</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><ul>
<li>
<p>agent就是一个Flume的实例，event是flume定义的一个数据流传输的最小单元。source指的是数据的来源和方式，channel是一个数据的缓冲池，sink定义了数据的输出的方式和目的地。一个完整的agent包含了必须的三个组件source、channel和sink。</p>
</li>
<li>
<p>启动<code>./bin/flume-ng agent -n agent_name -c conf -f conf/flume-conf.properties.template</code>。</p>
<ul>
<li>agent 表示启动一个agent，-n 指定agent的名字，-f配置文件的位置 ，-c 配置文件夹的位置。</li>
</ul>
</li>
<li>
<p>一个配置文件的例子</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#设置各个组件的名称</span>
</span></span><span style="display:flex;"><span>a1.sources<span style="color:#f92672">=</span>r1
</span></span><span style="display:flex;"><span>a1.sinks<span style="color:#f92672">=</span>k1
</span></span><span style="display:flex;"><span>a1.channels<span style="color:#f92672">=</span>c1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#监听的主机和端口</span>
</span></span><span style="display:flex;"><span>a1.sources.r1.type<span style="color:#f92672">=</span>syslogudp
</span></span><span style="display:flex;"><span>al.sources.r1.bind<span style="color:#f92672">=</span>10.2.4.31
</span></span><span style="display:flex;"><span>a1.sources.r1.port<span style="color:#f92672">=</span><span style="color:#ae81ff">5145</span>
</span></span><span style="display:flex;"><span>a1.sources.r1.keepFields<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span><span style="color:#75715e">#配置Sink</span>
</span></span><span style="display:flex;"><span>a1.sinks.k1.type<span style="color:#f92672">=</span>org.apache.flume.sink.kafka.KafkaSink
</span></span><span style="display:flex;"><span>a1.sinks.k1.kafka.bootstrap.servers<span style="color:#f92672">=</span>10.2.4.31:9092
</span></span><span style="display:flex;"><span>a1.sinks.k1.kafka.topic<span style="color:#f92672">=</span>rawlog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#配置channel</span>
</span></span><span style="display:flex;"><span>a1.channels.c1.type<span style="color:#f92672">=</span>memory
</span></span><span style="display:flex;"><span><span style="color:#75715e">#内存channel的容量大小为1000</span>
</span></span><span style="display:flex;"><span>a1.channels.c1.capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#source和sink从内存每次传输的event数量</span>
</span></span><span style="display:flex;"><span>a1.channels.c1.transactionCapacity<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#把source绑定到channel上，一个source可以连接多个channel</span>
</span></span><span style="display:flex;"><span>a1.sources.r1.channels<span style="color:#f92672">=</span>c1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#把sink绑定到channel上，一个sink只能连接一个channel</span>
</span></span><span style="display:flex;"><span>a1.sinks.k1.channel<span style="color:#f92672">=</span>c1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启动 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#bin/flume-ng agent -c conf -f example.conf --name a1 -Dflume.root.logger=INFO,console</span>
</span></span></code></pre></div><ul>
<li>通过linux命令发送一条log <code>logger --udp --port 5140 --server 172.27.32.2 &quot;hello world&quot;</code></li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/kafka/">kafka</a>
    </h2>
    
  <h5>2021-10-21</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h2 id="介绍">
  介绍
  <a class="anchor" href="#%e4%bb%8b%e7%bb%8d">#</a>
</h2>
<ul>
<li>kafka中的消息以主题为单位进行归类，生产者负责将消息发送到特定的topic，消费者负责订阅topic并进行消费。</li>
<li>topic是一个逻辑上的概念，它可以细分为多个partition（分区），一个partition只属于单个topic（主题）。</li>
<li>同一个topic下的不同的partition存放的消息是不同的。消息在被追加到分区文件中会被分配一个特定的偏移量（offset）。offset是消息在partition中唯一的标识，kafka通过offset来保证消息在分区内的顺序性。offset并不跨越分区，也就是说kafka保证的是partition有序而非topic有序。</li>
<li>partition可以分布在不同的broker上，也就是说一个topic可以横跨多个broker。</li>
<li>每一条消息被发送到broker前，会根据分区规则选择存到哪个具体的分区，如果分区规则设置的合理，则所有的消息都可以均匀的分配到不同的分区中。如果一个topic只有一个分区，那么这个这个分区文件所在的机器的I/O将会成为这个topic的性能瓶颈。</li>
<li>kafka为分区引入了副本（replica）机制，同一个分区的不同副本中保存的是相同的消息。副本之间是一主多从的关系，leader副本负责处理读写请求，follower副本只负责于leader副本的消息同步，当leader副本出现故障时，从follower中重新选举的新leader对外提供服务。</li>
</ul>
<h3 id="日志存储">
  日志存储
  <a class="anchor" href="#%e6%97%a5%e5%bf%97%e5%ad%98%e5%82%a8">#</a>
</h3>
<ul>
<li>kafka中的消息是以topic为基本单位进行归类的，各个topic逻辑上相互独立，每个topic可以分为一个或多个partition，分区的数量可以在topic创建时指定，也可以在之后修改。每个消息在发送的时候会根据分区规则被追加到指定的partition中，partition中的每条消息都会被分配一个唯一的序列号，即偏移量（offset）。</li>
<li>不考虑多副本的情况，一个分区对应一个日志（Log）。为了防止Log过大，kafka引入了日志分段(LogSegment)的概念，将Log切分为多个LogSegment，相当于一个大型文件被平均分为多个相对较小的文件。Log在物理上以文件夹的形式存储，每隔LogSegment对应于磁盘上的一个日志文件和两个索引文件以及可能的其他文件。</li>
<li>Log对应的命名形式为<code>topic-partition</code>的目录。</li>
<li>为了便于消息的检索，每隔LogSegment中的日志文件（以<code>.log</code>文件结尾）都有对应的两个索引文件：偏移量索引文件（<code>.index</code>）和时间戳索引文件(<code>.timeindex</code>)，每个logsegment都有一个基准偏移量baseoffset，用来表示当前logsegment中第一条消息的offset，偏移量是一个64位长整型数，日志文件和两个索引文件都是根据准偏移量来命名的，名称固定为20个数字，没有达到的位数则用0填充。</li>
<li>kafka消费者的唯一是保存在内部topic <code>__consumer_offsets</code>中的。</li>
</ul>
<h3 id="消费者">
  消费者
  <a class="anchor" href="#%e6%b6%88%e8%b4%b9%e8%80%85">#</a>
</h3>
<ul>
<li>一个消费者只属于一个消费组，每一个分区只能被一个消费组中的一个消费者所消费。</li>
</ul>
<h2 id="命令行">
  命令行
  <a class="anchor" href="#%e5%91%bd%e4%bb%a4%e8%a1%8c">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#启动服务</span>
</span></span><span style="display:flex;"><span>bin/zookeeper-server-start.sh config/zookeeper.properties
</span></span><span style="display:flex;"><span>bin/kafka-server-start.sh config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建有4个partition的topic</span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --bootstrap-server 10.2.4.31:9092 --create --topic kuangpf-topic --partitions <span style="color:#ae81ff">4</span> <span style="color:#f92672">[</span>--replication-factor 1<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--if-not-exists<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#展示topic分区副本的分配细节</span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --bootstrap-server 10.2.4.31:9092 --describe --topic kuangpf-topic
</span></span><span style="display:flex;"><span><span style="color:#75715e">#向topic中写入event</span>
</span></span><span style="display:flex;"><span>bin/kafka-console-producer.sh --topic test --bootstrap-server localhost:9092
</span></span><span style="display:flex;"><span><span style="color:#75715e">#读取events</span>
</span></span><span style="display:flex;"><span>bin/kafka-console-consumer.sh --topic test --from-beginning --bootstrap-server localhost:9092
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取当前可用的topics</span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --bootstrap-server 10.2.4.31:9092 --list <span style="color:#f92672">[</span>--if-exists<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#增加分区数，分区数只能增加不能减少</span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --bootstrap-server 10.2.4.31:9092 --alter  --topic kuangpf-topic --partitions <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看动态配置</span>
</span></span><span style="display:flex;"><span>kafka-configs.sh --bootstrap-server 10.2.4.31:9092 --describe --entity-type topics --entity-name kuangpf-topic
</span></span><span style="display:flex;"><span><span style="color:#75715e">#添加配置，多个配置用逗号隔开</span>
</span></span><span style="display:flex;"><span>kafka-configs.sh --bootstrap-server 10.2.4.31:9092 --alter  --entity-type topics --entity-name kuangpf-topic --add-config max.message.bytes<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除某个动态配置</span>
</span></span><span style="display:flex;"><span>kafka-configs.sh --bootstrap-server 10.2.4.31:9092 --alter  --entity-type topics --entity-name kuangpf-topic --delete-config max.message.bytes
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除一个topic</span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --bootstrap-server 10.2.4.31:9092 --delete --topic kuangpf-topic <span style="color:#f92672">[</span>--if-exists<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将消费组的topic的偏移量移到最后</span>
</span></span><span style="display:flex;"><span>kafka-consumer-groups.sh --bootstrap-server 10.2.4.31:9092 --group log-process --topic a36cde73-88e0-4398-b7ee-7246f65c6cfe --reset-offsets --to-latest --execute
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#性能测试工具</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#发送100万条数据，每条消息1024字节，吞吐量大于-时表示当发送的吞吐量大于该值时就会被阻塞一段时间，小于0则不限流</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#records sent表示测试时发送的消息总数，records/sec和MB、sec表示吞吐量，avg latency表示消息处理的平均耗时，max latency表示消息的最大耗时。50th表示50%的消息处理耗时，其他的类推。</span>
</span></span><span style="display:flex;"><span>kafka-producer-perf-test.sh --topic k1 --num-records <span style="color:#ae81ff">100000</span> --record-size <span style="color:#ae81ff">1024</span> --throughput -1 --producer-props bootstrap.servers<span style="color:#f92672">=</span>10.2.4.31:9092
</span></span><span style="display:flex;"><span><span style="color:#75715e">#消费100万条数据</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#start.time起始时间、end.time结束时间、data.consumed.in.MB消费的消息总量、每秒拉去的消息的字节大小fetch.MB.sec、fetch.nMsg.sec每秒拉去的消息个数</span>
</span></span><span style="display:flex;"><span>kafka-consumer-perf-test.sh --topic k1 --messages <span style="color:#ae81ff">1000000</span> --broker-list 10.2.4.31:9092
</span></span></code></pre></div><h3 id="java程序案例">
  java程序案例
  <a class="anchor" href="#java%e7%a8%8b%e5%ba%8f%e6%a1%88%e4%be%8b">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Properties props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//给程序一个唯一标识符，用于区分和同一个kafka对话的其他程序。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    props<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>StreamsConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_ID_CONFIG</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;streams-pipe&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//kafka的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    props<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>StreamsConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;localhost:9092&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    props<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>StreamsConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">DEFAULT_KEY_SERDE_CLASS_CONFIG</span><span style="color:#f92672">,</span> Serdes<span style="color:#f92672">.</span><span style="color:#a6e22e">String</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    props<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>StreamsConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">DEFAULT_VALUE_SERDE_CLASS_CONFIG</span><span style="color:#f92672">,</span> Serdes<span style="color:#f92672">.</span><span style="color:#a6e22e">String</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//使用topology构建器构建一个topology
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> StreamsBuilder builder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StreamsBuilder<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建源流，KStream会不断地从my-input中获取数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    KStream<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> source <span style="color:#f92672">=</span> builder<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;my-input&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//将输入的键和值随意更改，类型也可以修改，返回新的键值对
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    source<span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> KeyValueMapper<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">,</span> KeyValue<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;&gt;()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> KeyValue<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">apply</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;====&gt; key {}, value{}&#34;</span><span style="color:#f92672">,</span> key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> KeyValue<span style="color:#f92672">&lt;&gt;(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//将数据写入到my-output，TopicNameExtractor可以动态指定topic，但topic必须存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    source<span style="color:#f92672">.</span><span style="color:#a6e22e">to</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TopicNameExtractor<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">extract</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String value<span style="color:#f92672">,</span> RecordContext recordContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----&gt;key {}, value {},recordContext {}&#34;</span><span style="color:#f92672">,</span> key<span style="color:#f92672">,</span> value<span style="color:#f92672">,</span> recordContext<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;my-output&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> Topology topology <span style="color:#f92672">=</span> builder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//使用上面的两个组件topology和props来构建streams客户端。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> KafkaStreams streams <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaStreams<span style="color:#f92672">(</span>topology<span style="color:#f92672">,</span> props<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//程序结束前能关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Runtime<span style="color:#f92672">.</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">addShutdownHook</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;streams-shutdown-hook&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            streams<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//执行此客户端
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    streams<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/spring/spring%E6%B3%A8%E8%A7%A3/">spring注解</a>
    </h2>
    
  <h5>2021-10-16</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><ul>
<li>@Autowired默认按照Bean的类型进行装配，如果要按照名称来装配，则需要和@Qualifier注解一起使用。</li>
<li>@Qualifier与@Autowired注解配合使用，Bean的实例的名称由@Qualifier注解的参数指定。</li>
<li>@Resource和@Autowired的功能一样，区别在于该注解默认按照名称来装配注入的，只有当找不到与名称匹配的Bean时才会按照类型来装配注入。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/javaee/spring/springaop/">springaop</a>
    </h2>
    
  <h5>2021-10-12</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  




    <p><h3 id="通知类型">
  通知类型
  <a class="anchor" href="#%e9%80%9a%e7%9f%a5%e7%b1%bb%e5%9e%8b">#</a>
</h3>
<ol>
<li>环绕通知@Around：在目标方法执行前和执行后实施增强；</li>
<li>前置通知@Before：在目标方法执行前实施增强；</li>
<li>后置返回通知@AfterReturning：在目标方法执行<strong>成功</strong>后实施增强；</li>
<li>后置通知@After：在目标方法执行后实施增强，不论是否发生异常都执行该类通知；</li>
<li>异常通知@AfterThrowing：方法抛出异常后实施增强；</li>
<li>引入通知：在目标类中添加一些新的方法和属性，用于修改目标类。</li>
</ol>
<p>
  <img src="/img/javaee/springaop/1.png" alt="" /></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E7%80%9A%E9%AB%98/">瀚高</a>
    </h2>
    
  <h5>2021-09-27</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><ul>
<li><code>psql --username highgo  --host 127.0.0.1 --port 5866 --password</code> 登录到数据库
<ul>
<li>-U (&ndash;username), -h(&ndash;host), -p(&ndash;port), -W(&ndash;password)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">关闭三权分立，能解决很多的权限问题，生产环境不建议关闭</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">以</span>syssso<span style="color:#960050;background-color:#1e0010">登录，修改后重启，默认为</span><span style="color:#66d9ef">on</span><span style="color:#960050;background-color:#1e0010">，可以改为</span><span style="color:#66d9ef">off</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> set_secure_param(<span style="color:#e6db74">&#39;hg_sepofpowers&#39;</span>,<span style="color:#e6db74">&#39;off&#39;</span>);
</span></span></code></pre></div><ul>
<li>开启远程连接</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#修改postgresql.conf</span>
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0.0.0.0&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#修改pg_hba.conf，加上</span>
</span></span><span style="display:flex;"><span>host    all             all             0.0.0.0/0               sm3
</span></span></code></pre></div><h2 id="postgresql">
  postgresql
  <a class="anchor" href="#postgresql">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 配置步骤</span>
</span></span><span style="display:flex;"><span>adduser postgres
</span></span><span style="display:flex;"><span>mkdir /usr/local/pgsql/data
</span></span><span style="display:flex;"><span>chown postgres /usr/local/pgsql/data
</span></span><span style="display:flex;"><span>su - postgres
</span></span><span style="display:flex;"><span>/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
</span></span><span style="display:flex;"><span>/usr/local/pgsql/bin/postgres -D /usr/local/pgsql/data &gt;logfile 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</span></span><span style="display:flex;"><span>/usr/local/pgsql/bin/createdb test
</span></span><span style="display:flex;"><span>/usr/local/pgsql/bin/pgsql test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#启动psql</span>
</span></span><span style="display:flex;"><span>postgres -D /usr/local/pgsql/data &gt;logfile 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</span></span><span style="display:flex;"><span>pg_ctl start -l logfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#psql登录后</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\d</span>n 查看模式
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\l</span> 查看数据库
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\d</span>t myschema.* 列出table
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\d</span>g 列出所有角色
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#密码永不失效 valid until &#39;infinity&#39;;</span>
</span></span><span style="display:flex;"><span>create user davide with createdb password <span style="color:#e6db74">&#39;1234!@#$QWERqwer&#39;</span>  valid <span style="color:#66d9ef">until</span> <span style="color:#e6db74">&#39;2005-01-01&#39;</span>;
</span></span><span style="display:flex;"><span>alter role davide with password <span style="color:#e6db74">&#39;1234qwer!&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#设置到期时间</span>
</span></span><span style="display:flex;"><span>alter role syssso valid <span style="color:#66d9ef">until</span> <span style="color:#e6db74">&#39;infinity&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建数据库，并指定拥有者</span>
</span></span><span style="display:flex;"><span>CREATE DATABASE sales <span style="color:#f92672">[</span>OWNER salesapp<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建数据库</span>
</span></span><span style="display:flex;"><span>create database koal_database
</span></span><span style="display:flex;"><span><span style="color:#75715e">#创建一个模式</span>
</span></span><span style="display:flex;"><span>CREATE SCHEMA myschema;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将数据库的权限分给别人</span>
</span></span><span style="display:flex;"><span>grant all privileges on database  koal_database to koal;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#移除权限</span>
</span></span><span style="display:flex;"><span>revoke all privileges on database koal_database from koal;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#导出一个数据库</span>
</span></span><span style="display:flex;"><span>pg_dump mydb &gt; db.sql
</span></span><span style="display:flex;"><span><span style="color:#75715e">#导入一个脚本到新建的数据库newdb</span>
</span></span><span style="display:flex;"><span>psql -d newdb -f db.sql
</span></span></code></pre></div><ul>
<li>psql有些不属于sql的内部命令，它们以反斜线开头，获取帮助<code>\h</code>，退出命令<code>\q</code>。</li>
</ul>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/4/" aria-label="Page 4" class="page-link" role="button">4</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Page 5" class="page-link" role="button">5</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 6" class="page-link" role="button">6</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Page 7" class="page-link" role="button">7</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/8/" aria-label="Page 8" class="page-link" role="button">8</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/7/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  
<a href="https://beian.miit.gov.cn" target="_blank" style="color:gray;">备案号：陕ICP备2022008774号</a>

 
      </footer>
    </div>

  </main>

</body>
</html>











