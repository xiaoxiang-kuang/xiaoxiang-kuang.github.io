<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/">clickhouse集群配置</a>
    </h2>
    
  <h5>2021-03-17</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><ul>
<li>查看集群<code>select * from system.clusters</code></li>
<li>分片shard是指包含数据不同部分的服务器。要读取所有数据，必须访问所有分片。</li>
<li>副本replica是存储复制数据的服务器，要读取所有数据，访问一个切片上的任意副本上的数据即可。</li>
</ul>
<h2 id="集群部署">
  集群部署
  <a class="anchor" href="#%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2">#</a>
</h2>
<ol>
<li>
<p>在群集的所有机器上安装clickhouse服务端</p>
</li>
<li>
<p>在配置文件中设置群集配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;remote_servers&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;perftest_1shards_1replicas&gt;</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#f92672">&lt;shard&gt;</span>
</span></span><span style="display:flex;"><span>        	<span style="color:#f92672">&lt;replica&gt;</span>
</span></span><span style="display:flex;"><span>            	<span style="color:#f92672">&lt;host&gt;</span>localhost<span style="color:#f92672">&lt;/host&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;port&gt;</span>9000<span style="color:#f92672">&lt;/port&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/replica&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/shard&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/perftest_1shards_1replicas&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/remote_servers&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>在集群上创建本地表</p>
</li>
<li>
<p>在集群上创建分布式表</p>
<ul>
<li>分布式表实际上是一种视图（view），从分布式表中执行select查询会使用集群所有分片的资源。</li>
</ul>
</li>
</ol>
<ul>
<li><code>internal_replication</code>：
<ul>
<li>当参数为true时，写操作只选择一个正常的副本写入数据。如果表是复制表Replicated*Merge，请使用此方案。</li>
<li>当为false时，写操作会将数据写入所有副本。因为不会检查副本一致性，随着时间的推移，副本数据可能不一样。</li>
</ul>
</li>
</ul>
<h2 id="数据副本">
  数据副本
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%89%af%e6%9c%ac">#</a>
</h2>
<ul>
<li>对于INSERT和ALTER语句操作数据时会在压缩的情况下被复制。</li>
<li>CREATE、DROP、ATTACH、DETACH和RENAME语句只会在单个服务器上执行，不会被复制。
<ul>
<li>可复制表的不同副本可以有不同的名称</li>
</ul>
</li>
<li>如果配置文件中没有设置ZooKeeper，则无法创建复制表，并且现在任何现有的复制表都将变为只读。</li>
</ul>
<h3 id="创建复制表">
  创建复制表
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e5%a4%8d%e5%88%b6%e8%a1%a8">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">table_name</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>	EventDate DateTime,
</span></span><span style="display:flex;"><span>    CounterID UInt32,
</span></span><span style="display:flex;"><span>    UserID UInt32,
</span></span><span style="display:flex;"><span>    Ver UInt16
</span></span><span style="display:flex;"><span>)ENGINE <span style="color:#f92672">=</span> ReplicatedReplacingMergeTree(zoo_path, replica_name, other_parameters)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#66d9ef">BY</span> toYYYYMM(EventDate)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> (CounterID, EventDate, intHash32(UserID))
</span></span><span style="display:flex;"><span>SAMPLE <span style="color:#66d9ef">BY</span> intHash32(UserID)
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/django%E8%B5%B7%E6%AD%A5/">django起步</a>
    </h2>
    
  <h5>2021-03-16</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="起步">
  起步
  <a class="anchor" href="#%e8%b5%b7%e6%ad%a5">#</a>
</h2>
<ul>
<li>django项目目录</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>mysite<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>    manage<span style="color:#f92672">.</span>py <span style="color:#75715e">#管理django项目的命令行工具</span>
</span></span><span style="display:flex;"><span>    mysite<span style="color:#f92672">/</span>	<span style="color:#75715e">#python包，名字就是当引用它内部任何东西时需要用到的python包名</span>
</span></span><span style="display:flex;"><span>        __init__<span style="color:#f92672">.</span>py	<span style="color:#75715e">#告诉python这个目录应该被认为是一个python包</span>
</span></span><span style="display:flex;"><span>        settings<span style="color:#f92672">.</span>py	<span style="color:#75715e">#项目的配置文件</span>
</span></span><span style="display:flex;"><span>        urls<span style="color:#f92672">.</span>py <span style="color:#75715e">#url声明</span>
</span></span><span style="display:flex;"><span>        asgi<span style="color:#f92672">.</span>py <span style="color:#75715e">#运行在asgi兼容的web服务器上的入口</span>
</span></span><span style="display:flex;"><span>        wsgi<span style="color:#f92672">.</span>py <span style="color:#75715e">#运行在wsgi兼容的web服务器上的入口</span>
</span></span></code></pre></div><ul>
<li>运行项目的命令<code>python manage.py runserver</code></li>
<li>创建一个应用<code>python manage.py startapp polls</code></li>
<li>应用urls.py中使用到的函数path()有四个参数，两个必须参数route和view，两个可选参数kwargs和name
<ul>
<li>route是一个匹配URL的准则，当响应一个请求时，他会从urlpatterns的第一项开始，按顺序依次匹配列表中的项。这些准则不会匹配get和post参数或域名</li>
<li>view：当找到了一个匹配的准则，就会调用这个特定的视图函数，并传入一个HttpRequest对象作为第一个参数，被捕获的参数以关键字参数的形式传入。</li>
<li>kwages：任意个关键字参数可作为一个字典传递给目标视图函数。</li>
<li>name：为url取名</li>
</ul>
</li>
<li>函数include()允许引用其他URLconfs</li>
</ul>
<h2 id="模型">
  模型
  <a class="anchor" href="#%e6%a8%a1%e5%9e%8b">#</a>
</h2>
<h3 id="设置mysitesittingspy">
  设置mysite/sittings.py
  <a class="anchor" href="#%e8%ae%be%e7%bd%aemysitesittingspy">#</a>
</h3>
<ul>
<li>设置时区<code>TIME_ZONE = 'Asia/Shanghai' USE_TZ = True</code>
<ul>
<li>当启用了时区支持（即<code>USE_TZ = True</code>），Django将在数据库中以UTC存储日期信息，而在模板和表单中转化为最终用户的时区</li>
</ul>
</li>
<li>设置数据库</li>
<li><code>INSTALLED_APPS</code>是在项目中启用的Django应用，这里面的某些应用需要数据表，可以用<code>python manage.py migrate</code>生成</li>
</ul>
<h3 id="创建模型">
  创建模型
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e6%a8%a1%e5%9e%8b">#</a>
</h3>
<ul>
<li>模型设真实数据的描述，它包含了存储的数据所必要的字段和行为。</li>
<li>Django的迁移代码是从模型文件中自动生成的</li>
<li>每个模型都是<code>django.db.models.Model</code>类的子类，每个模型有许多的类变量，他们都表示一个数据库的字段，每个字段都是Field类的实例，每个Field类实例变量的名字也是数据库的列名。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#polls/models.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Choice</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    question <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Question, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    choice_text <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>    votes <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(default<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><h3 id="激活和修改模型">
  激活和修改模型
  <a class="anchor" href="#%e6%bf%80%e6%b4%bb%e5%92%8c%e4%bf%ae%e6%94%b9%e6%a8%a1%e5%9e%8b">#</a>
</h3>
<ul>
<li>首先把应用安装到项目中，在<code>INSTALLED_APPS</code>中添加<code>polls.apps.PollsConfig</code></li>
<li>执行<code>python manage.py makemigrations polls</code></li>
<li>迁移数据存放在应用的<code>migrations/0001_initial.py</code>中，可以通过<code>python manage.py sqlmigrate polls 0001</code>来查看对应的sql</li>
<li>运行<code>python manage.py migtate</code>来应用数据库迁移</li>
<li>通过<code>python manage.py shell</code>可进入当前项目对应的命令行</li>
<li>给模型增加<code>__str__</code>方法能带来一些方便</li>
</ul>
<h2 id="django管理页面">
  Django管理页面
  <a class="anchor" href="#django%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2">#</a>
</h2>
<ul>
<li>首先创建一个能登陆管理界面的用户<code>python manage.py createsuperuser</code></li>
<li>将创建的models注册，以便后台可以管理</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#polls/admin.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Question
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Question)
</span></span></code></pre></div><ul>
<li>运行项目<code>python manage.py runserver</code></li>
</ul>
<h2 id="视图view">
  视图view
  <a class="anchor" href="#%e8%a7%86%e5%9b%beview">#</a>
</h2>
<ul>
<li>向应用的views.py中添加视图函数，这些函数的第一个参数是request，也以有第二、第三个参数。每个视图必须做的只有返回一个包含请求页面内容的HttpResponse对象或者抛出一个异常</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">detail</span>(request, question_id):
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;question_id&#39;</span>: question_id,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#template = loader.get_template(&#39;xxx/xxxx.html&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#return HttpResponse(template.render(context, request))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;xxx/xxxx.html&#39;</span>, context)
</span></span></code></pre></div><ul>
<li>
<p>当使用模型的get函数获取对象，如果不存在，可以抛出Http404错误，Django提供了一个快捷函数<code>get_object_or_404</code>，</p>
</li>
<li>
<p>将这些视图添加加到应用的urls.py中</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#为url名称添加命名空间</span>
</span></span><span style="display:flex;"><span>app_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;polls&#39;</span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#int:是一个转换器，决定了应该以什么变量类型匹配这部分url路径</span>
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#39;&lt;int:question_id&gt;/detail/&#39;</span>, views<span style="color:#f92672">.</span>detail, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;detail&#39;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><ul>
<li>当其他人访问网站的某个页面时，比如&rsquo;polls/34/detail&rsquo;，django将会载入项目的urls.py模块，因为这在<strong>ROOT_URLCONF</strong>中配置了，然后django寻找名为urlpatterns变量并按顺序匹配正则表达式，在找到匹配项&rsquo;polls/&rsquo;，它切掉了匹配的文本&rsquo;polls/&rsquo;，将剩余文本'34/detail&rsquo;发送至&rsquo;polls.urls&rsquo;中做进一步处理</li>
</ul>
<h3 id="模板">
  模板
  <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">#</a>
</h3>
<ul>
<li>在应用路径下创建templates目录，项目的<strong>TEMPLATES</strong>配置项描述了django如何载入和渲染模板，默认将<strong>APP_DIRS</strong>设置为True，这一选项让DjangoTemplates能在每个INSTALLED_APPS文件夹中寻找templates子目录。</li>
<li>由于django能直接访问到templates文件夹，为了放置出现模板文件名冲突，最好的方法就是将它们放到一个与自身应用重名的子文件夹里</li>
<li>指向具有命名空间的视图</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;polls:detail&#39; question.id %}&#34;</span>&gt;{{ context.question_id }}&lt;/<span style="color:#f92672">a</span>&gt;
</span></span></code></pre></div><ul>
<li>无论何时，当需要创建一个改变服务器端数据的表单时，请使用post。</li>
<li>django自带了一个非常有用的防御系统，所有针对内部url的post表单都应该使用<code>{% csrf_token %}</code>模板标签。</li>
<li>request.POST是一个字典类型对象，可以通过关键字来获取提交的数据，获取的值永远是字符串。如果key提供错误，将会抛出一个KeyError。</li>
<li>函数reverse()能避免在视图函数中硬编码url，他需要我们给出想要跳转的视图的名字和该视图所对应的url模式中需要给该视图提供的参数。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">python正则表达式</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><ul>
<li><code>\d</code>匹配一个数字</li>
<li><code>\w</code>匹配一个数字或字母</li>
<li><code>.</code>匹配任意字符</li>
<li><code>*</code>匹配0到多个字符，<code>+</code>匹配1到多个字符，<code>?</code>匹配0或1个字符，<code>{n}</code>表示n个字符，<code>{n,m}</code>表示n-m个字符</li>
<li><code>\s</code>匹配一个空格（也包括tab）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>\d{<span style="color:#ae81ff">3</span>}\s<span style="color:#f92672">+</span>\d<span style="color:#f92672">*</span>	<span style="color:#75715e">#匹配3个数字，后面至少有一个空格，再后面有可能有数字，有可能没数字</span>
</span></span></code></pre></div><ul>
<li><code>[]</code>可用于更精确的匹配</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>a<span style="color:#f92672">-</span>z\_] <span style="color:#75715e">#匹配一个数字或一个小写字母或一个下划线</span>
</span></span></code></pre></div><ul>
<li><code>A|B</code>可匹配A或B</li>
<li><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头</li>
<li><code>$</code>表示行的结束，<code>$\d</code>表示必须以数字结束</li>
</ul>
<h2 id="re模块">
  re模块
  <a class="anchor" href="#re%e6%a8%a1%e5%9d%97">#</a>
</h2>
<ul>
<li>因为python字符串本身也用<code>\</code>转义，可以使用<code>r</code>前缀，就可以不用考虑字符串转义了。<code>r'ABC\-001'</code></li>
<li><code>re.match(r'\d{3}\-\d$'),'010-1')</code>，如果匹配成功就返回一个Mache对象，否则返回none。</li>
<li><code>re.split(r'[\s\,]+','a,b, c  d')</code>，切割字符串，能切割出<code>['a','b','c']</code></li>
<li>正则表达式还有提取字串的功能，用<code>()</code>表示的就是要提取的分组。<code>r'(\d{3})-(\d{3,8})'</code>就定义了两个组，可以使用<code>group(n)</code>方法提取出子串</li>
</ul>
<h2 id="贪婪匹配">
  贪婪匹配
  <a class="anchor" href="#%e8%b4%aa%e5%a9%aa%e5%8c%b9%e9%85%8d">#</a>
</h2>
<ul>
<li>正则默认的时贪婪匹配，加个<code>?</code>就可以采用非贪婪匹配。<code>\d+?</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>r <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">&#39;(\d+?)(0*)$&#39;</span>,<span style="color:#e6db74">&#39;1200000&#39;</span>)
</span></span><span style="display:flex;"><span>print(r<span style="color:#f92672">.</span>groups())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果(&#39;12&#39;, &#39;00000&#39;)</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E6%A8%A1%E5%9D%97/">python模块</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="datetime">
  datetime
  <a class="anchor" href="#datetime">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime,timedelta
</span></span></code></pre></div><ul>
<li>获取当前时间<code>datetime.now()</code></li>
<li>指定的某个日期和时间<code>datetime(2021,3,15,19,48)</code></li>
<li>将datetime类型转化为timestamp，（timestamp是一个浮点数，整数位表示秒） <code>datetime(2021,3,15,19,49).timestamp()</code></li>
<li>timestamp转化为datetime <code>datetime.fromtimestamp(1615809156.889315)</code></li>
<li>str转换为datetime <code>datetime.strptime('2021-3-15 19:55:59','%Y-%m-%d %H:%M:%S')</code></li>
<li>datetime转str <code>datetime.now().strftime('%a,%b %d %H:%M')</code></li>
<li>datetime加减 <code>datetime.now() + timedelta(days = 1, hours = 10)</code></li>
<li>时区转换</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>utc_dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>utc_dt<span style="color:#f92672">.</span>astimezone(timezone(timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)))
</span></span></code></pre></div><h2 id="collections">
  collections
  <a class="anchor" href="#collections">#</a>
</h2>
<ul>
<li>namedtuple：是一个函数，可以用来创建一个自定义的tuple对象，同时规定了tuple元素的个数，并可以用属性而不是索引来引用tuple的某个元素。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> namedtuple
</span></span><span style="display:flex;"><span>Point <span style="color:#f92672">=</span> nametuple(<span style="color:#e6db74">&#39;Point&#39;</span>,[<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#e6db74">&#39;y&#39;</span>])
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> Point(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><ul>
<li>deque：双向列表，方法有<code>append()、pop()、appendleft()、popleft()</code></li>
<li>defaultdict：和dict类似，但是在key不存在的时候返回一个默认值。</li>
<li>OrderedDict：key会按照插入的顺序排序</li>
<li>ChainMap：可以把一组dict串起来组成一个逻辑上的dict，本身也是一个dict，但在查找的时候，会按照顺序在内部的dict依次查找。</li>
<li>Counter是一个计数器，可以统计字符出现的个数，实际上也是dict的子类</li>
</ul>
<h2 id="base64">
  base64
  <a class="anchor" href="#base64">#</a>
</h2>
<ul>
<li>base64是一种用64个字符表示任意二进制数据的方法，64个字符指的是<code>A-Z, a-z, 0-9, +, /</code>。实现方法是将3个字节(3x8bit)的二进制数据编码为4字节(4x6bit，6bit的数据刚好能用上面这64个字符表示)的数据。6bit的数据刚好能用这64个字符表示。</li>
<li>编码<code>base64.b64encode(b'binary')</code>；解码<code>base64.b64decode(b'binary')</code></li>
</ul>
<h2 id="hashlib">
  hashlib
  <a class="anchor" href="#hashlib">#</a>
</h2>
<ul>
<li>摘要算法又称为哈希算法，散列算法，它通过一个函数，把任意长度的数据转化为一个固定长度的数据串。它是一个单向函数，对原始数据做一点点的修改都会导致计算出的摘要完全不同。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>md5 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#也可以将串分开，多次调用update方法</span>
</span></span><span style="display:flex;"><span>md5<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;xiaoxiang.space&#34;</span><span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#md5结果是128bit，通常用32位的16进制表示</span>
</span></span><span style="display:flex;"><span>print(md5<span style="color:#f92672">.</span>hexdigest())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sha1 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1()
</span></span><span style="display:flex;"><span>sha1<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;xiaoxiang.space&#34;</span><span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sha1的结果是160bit，通常用一个40位的16进制字符串表示</span>
</span></span><span style="display:flex;"><span>print(sha1<span style="color:#f92672">.</span>hexdigest())
</span></span></code></pre></div><h2 id="itertools">
  itertools
  <a class="anchor" href="#itertools">#</a>
</h2>
<ul>
<li>无限迭代器<code>itertools.count()</code></li>
<li>cycle()会把传入的一个序列无限重复下去<code>itertools.cycle('ABC')</code></li>
<li>repeat()可以把一个元素无限重复下去，提供了第二个参数可以限定重复次数<code>itertools.repeat('A', 3)</code></li>
<li>可通过takewhile()根据函数条件来截取一个有限的序列。</li>
<li>chain()可以把一组迭代对象串联起来，形成一个更大的迭代器。<code>itertools.chain('ABC', 'XYZ')</code></li>
<li>groupby()可以把迭代器中相邻的重复元素挑出来放在一起。挑选规则是通过函数完成的，只要作用于函数的两个元素返回的值相等，这两个元素就被认为是一组的，函数的返回值作为组的key。</li>
</ul>
<h2 id="contextlib">
  contextlib
  <a class="anchor" href="#contextlib">#</a>
</h2>
<ul>
<li>任何对象，只要正确实现了上下文管理，就可以用于with语句。实现上下文管理是通过<code>__enter__</code>和<code>__exit__</code>这两个方法实现的。可以通过contextlib标准库中的<code>@contextmanager</code>来实现上下文管理（更简单）</li>
<li>有时候，我们希望在某段代码执行前后自动执行特定代码，也可以通过@contextmanager实现</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> contextlib
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@contextlib.contextmanager</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tag</span>(name):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;&lt;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&gt;&#34;</span><span style="color:#f92672">%</span>name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;&lt;/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&gt;&#34;</span><span style="color:#f92672">%</span>name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> tag(<span style="color:#e6db74">&#34;h1&#34;</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;world&#34;</span>)
</span></span></code></pre></div><ul>
<li>如果一个对象没有实现上下文，就不能把他用于with语句，可以用closing()来将该对象变成上下文。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E5%BC%82%E5%B8%B8%E5%92%8CIO/">python异常-IO-进程等</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="错误">
  错误
  <a class="anchor" href="#%e9%94%99%e8%af%af">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">/</span> int(<span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ValueError&#34;</span>,e)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ZeroDivisionError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ZeroDivisionError&#34;</span>,e)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#raise如果不带参数，就会把当前错误原样抛出</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;END&#34;</span>)
</span></span></code></pre></div><p>单元测试要用到了再回来补充：
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017604210683936">单元测试</a></p>
<h2 id="io">
  IO
  <a class="anchor" href="#io">#</a>
</h2>
<ul>
<li>
<p>以读的方式打开一个文件对象<code>f = open('test.txt','r')</code></p>
</li>
<li>
<p>文件使用完毕后必须关闭，因为文件对象会占用操作系统的资源。可以使用<code>with open('test.txt','r') as f:</code>，这种形式会自动帮我们调用close()方法。</p>
</li>
<li>
<p>读取二进制文件<code>open('test','rb')</code>，读取非UTF-8编码的文件<code>open('gbk.txt', 'r', encoding = 'gbk')</code>，遇到编码错误后忽略<code>open('test', 'r', encoding = 'gbk', errors = 'ignore')</code>。</p>
</li>
<li>
<p>写文件就是将<code>r</code>参数改为<code>w</code>参数，当在写文件时，操作系统往往不会立刻把数据写入磁盘，而是先缓存起来，只有调用close方法时才会保证把没有写入的数据全部写入磁盘。</p>
</li>
<li>
<p>StringIO和BytesIO是在内存中读写数据。</p>
</li>
<li>
<p>
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017624706151424">序列化</a></p>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">python面向对象</a>
    </h2>
    
  <h5>2021-03-14</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><ul>
<li>python中所有数据类型都可视为对象。</li>
<li>所有的类都会继承object类。</li>
<li>类中定义函数的第一个参数是self，调用时不用传递该参数。</li>
<li>属性前面加<code>__</code>（两个下划线）就变成了一个私有属性。双下划线开头，双下划线结尾的是特殊变量，特殊变量是可以直接访问的，不是private变量。一个下划线开头的变量名是可以被外部访问的，但是按约定俗称的规定，请把它视为私有变量。</li>
<li>双下划线开头的属性不能被外部访问是因为这个属性被改名字了。</li>
<li>判断一个变量是否是某个类型可以用isinstance()判断，判断对象类型可以使用type方法。</li>
<li>使用dir()可获得对象的所有属性和方法。</li>
<li>自己写的类如果也想用len()方法的话，可以自己写一个<code>__len__</code>方法。实际上，当我们使用len()方法的时候，它会自动去调用该对象的<code>__len__()</code>方法。</li>
<li><code>__str__</code>相当于java中的<code>toString</code>，还有一个<code>__repr__</code>是返回开发者看到的字符串。</li>
<li><code>__getitem__</code>可按下标访问数据的项。</li>
<li>任何类只要定义一个<code>__call__</code>方法，就可以对实例进行调用。</li>
</ul>
<h2 id="类的定义">
  类的定义
  <a class="anchor" href="#%e7%b1%bb%e7%9a%84%e5%ae%9a%e4%b9%89">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>(object):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#类属性</span>
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Student&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, name):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#实例属性</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span><span style="color:#75715e">#编写程序不要对实例属性和类属性使用相同的名字，因为相同名称的实例属性将屏蔽掉类属性        </span>
</span></span></code></pre></div><h2 id="动态绑定">
  动态绑定
  <a class="anchor" href="#%e5%8a%a8%e6%80%81%e7%bb%91%e5%ae%9a">#</a>
</h2>
<ul>
<li>当创建了一个对象后，我们可以给该对象绑定任何属性和方法，但是该属性和方法只在当前对象上有效。为了给所有实例都绑定方法，可以给class绑定方法。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>(object):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#可以用来限制class实例能添加的属性，仅对当前类实例起作用，对继承的子类不起作用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#除非在子类中也定义__slots__，这样子类实例允许定义的属性就是自身的__slots__加上父类的__slots__</span>
</span></span><span style="display:flex;"><span>    __slots__ <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;age&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_age</span>(self, age)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> age
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Student()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给对象动态绑定了一个属性</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;xiaoxiang&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给对象动态绑定一个方法，只在该对象上有效</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>set_age <span style="color:#f92672">=</span> MethodType(set_age, s)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给类动态绑定一个方法</span>
</span></span><span style="display:flex;"><span>Student<span style="color:#f92672">.</span>set_age <span style="color:#f92672">=</span> set_age
</span></span></code></pre></div><h2 id="getter和setter">
  getter和setter
  <a class="anchor" href="#getter%e5%92%8csetter">#</a>
</h2>
<ul>
<li>使用@property代替getter，以及创建setter的方法见下面的代码</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@name.setter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self, name):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>student <span style="color:#f92672">=</span> Student()
</span></span><span style="display:flex;"><span>student<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;xiaoxiang&#39;</span>
</span></span><span style="display:flex;"><span>print(student<span style="color:#f92672">.</span>name)
</span></span></code></pre></div><h2 id="__iter__和__next__">
  <code>__iter__</code>和<code>__next__</code>
  <a class="anchor" href="#__iter__%e5%92%8c__next__">#</a>
</h2>
<ul>
<li>如果一个类想被用于for-in，就必须实现<code>__iter__</code>和<code>__next__</code>方法</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fib</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __iter__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#实例自身就是迭代对象</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __next__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a, self<span style="color:#f92672">.</span>b <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>b, self<span style="color:#f92672">.</span>b <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">StopIteration</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#返回下一个值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> Fib():
</span></span><span style="display:flex;"><span>    print(i)
</span></span></code></pre></div><h2 id="__getattr__">
  <code>__getattr__</code>
  <a class="anchor" href="#__getattr__">#</a>
</h2>
<ul>
<li><code>__getattr__</code>用于动态返回一个属性，只在没有找到属性的情况下才会调用该方法。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Url</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, item <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>item <span style="color:#f92672">=</span> item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __getattr__(self, item):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Url(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(self<span style="color:#f92672">.</span>item, item))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    __repr__ <span style="color:#f92672">=</span> __str__
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(Url()<span style="color:#f92672">.</span>xiaoxiang<span style="color:#f92672">.</span>ayu<span style="color:#f92672">.</span>liuchan<span style="color:#f92672">.</span>list)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果：/xiaoxiang/ayu/liuchan/list</span>
</span></span></code></pre></div><h2 id="枚举">
  枚举
  <a class="anchor" href="#%e6%9e%9a%e4%b8%be">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum, unique
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#该注解用于保证没有重复值</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@unique</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Weekday</span>(Enum):
</span></span><span style="display:flex;"><span>    Sun <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Sun的value被设定为0</span>
</span></span><span style="display:flex;"><span>    Mon <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    Tue <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    Wed <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    Thu <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    Fri <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    Sat <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span></code></pre></div><h2 id="type和metaclass">
  type和metaclass
  <a class="anchor" href="#type%e5%92%8cmetaclass">#</a>
</h2>
<ul>
<li>class（类）的类型就是type，对象的类型就是类名</li>
<li>可以通过type()函数依次传入3个参数来创建一个class对象：①class的名称；②继承的父类集合；③class的方法名称与函数绑定。<code>type('hello', (object, ), dict(hello = 'hello world'))</code></li>
<li>通过type()函数创建的类和直接写class是完全一样的，因为python解释器遇到class定义时，仅仅是扫描一下class定义的语法，然后调用type()函数创建出class。</li>
<li>可以把类看作是metaclass（元类）创建出来的实例。</li>
<li>metaclass后面用到了再来看吧，链接在这-&gt;
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">metaclass</a></li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse-statement/">clickhouse-statement</a>
    </h2>
    
  <h5>2021-03-11</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><ul>
<li>可以在system.data_type_families中检查某个数据类型的名称是否大小写敏感，case_insensitive=1表示大小写不敏感。看完后我建议数据类型的命名首字母大写，并采用驼峰命名法。</li>
<li>除了标准sql的关键字和许多其他数据库实现的一些关键字，clickhouse其他的关键字都是大小写敏感的！所以如果你发现语句看上去没错，执行就是有问题，看看是不是大小写出问题了。</li>
<li>关键字不是保留的，它们仅在相应的上下文中才会被处理。</li>
<li>变量名可以使用反引号包含起来。</li>
<li>别名在查询和子查询中是全局可见的。</li>
</ul>
<h3 id="select">
  select
  <a class="anchor" href="#select">#</a>
</h3>
<ul>
<li>
<p>select子句是在 from、where、group by等所有操作完成后计算的，如果select子句中包含聚集函数，<strong>clickhouse会在执行group by期间处理这些聚集函数</strong>。</p>
</li>
<li>
<p>如果要用re2正则表达式匹配列，可以使用COLUMNS（‘xxx’），这样可以一次匹配多个列（对于是否常用我持否定态度）。</p>
</li>
<li>
<p>当FROM被省略时，数据从system.one表中读取</p>
</li>
<li>
<p>ARRAY JOIN</p>
<ul>
<li>对于包含数组列的表来说是一种常见的操作，用于生成一个新表（新表有一列将包含数组中的每一个元素，其他列可能会出现元素重复）。</li>
</ul>
</li>
<li>
<p>DISTINCT</p>
<ul>
<li>不支持select包含有数组的列</li>
<li>当ORDER BY 被省略且LIMIT被定义时，在读取所需数量的不同行后立即停止运行。</li>
<li>DISTINCT在ORDER BY之前执行</li>
</ul>
</li>
</ul>
<h3 id="alter">
  alter
  <a class="anchor" href="#alter">#</a>
</h3>
<ul>
<li>仅支持MergeTree家族，Merge以及Distributed等引擎表。</li>
<li>alter操作会阻塞对表的所有读写操作。</li>
</ul>
<h4 id="列操作">
  列操作
  <a class="anchor" href="#%e5%88%97%e6%93%8d%e4%bd%9c">#</a>
</h4>
<ul>
<li>增加列
<ul>
<li><code>ADD COLUMN [IF NOT EXISTS] name [type]  [default_expr] [codec] [AFTER name_after]</code></li>
<li>使用指定的name、type、codec以及default_expr往表中增加新的列。</li>
<li>如果sql中包含IF NOT EXISTS，执行语句如果已存在，则clickhouse不会报错，不能将新的列添加到表的开始位置，当指定了AFTER name_after，则会将新的列添加到指定列的后面。</li>
<li>添加列仅仅是改变原有表的结构，不会对已有数据产生影响。</li>
</ul>
</li>
<li>删除列
<ul>
<li><code>DROP COLUMN [IF EXISTS] name</code></li>
</ul>
</li>
<li>清空列
<ul>
<li><code>CLEAR COLUMN [IF EXISTS] name IN PARTITION partition_name</code></li>
<li>重置指定分区中的值。</li>
</ul>
</li>
<li>增加注释
<ul>
<li><code>COMMENT COLUMN [IF EXISTS] name 'comment'</code></li>
<li>每个列都可以包含注释，注释信息在DESCRIBE table中查看</li>
</ul>
</li>
<li>改变列的值类型，默认表达式，TTL
<ul>
<li><code>MODIFY COLUMN [IF EXISTS] name [type] [default_expr] [TTL] </code></li>
<li>当改变列的类型时，列的值也被转换了，如同对列使用toType函数一样，执行起来要花费很长时间。</li>
</ul>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse%E8%B5%B7%E6%AD%A5/">clickhouse起步</a>
    </h2>
    
  <h5>2021-03-11</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><ul>
<li>online analytical processing of queries（OLAP）：联机分析</li>
<li>clickhouse是一个用于OLAP的列式数据库管理系统（来自同一列的数据被存储在一起）。</li>
<li><code>sudo service clickhouse-server start</code>启动clickhouse.</li>
<li>clickhouse不要求主键唯一</li>
</ul>
<h3 id="clickhouse连接客户端">
  clickhouse连接客户端
  <a class="anchor" href="#clickhouse%e8%bf%9e%e6%8e%a5%e5%ae%a2%e6%88%b7%e7%ab%af">#</a>
</h3>
<h4 id="clickhouse-client">
  clickhouse-client
  <a class="anchor" href="#clickhouse-client">#</a>
</h4>
<ul>
<li>
  <a href="https://clickhouse.tech/docs/zh/interfaces/cli/#command-line-options">clickhouse-client命令行参数</a></li>
<li><code>clickhouse-client</code>配置文件地址（使用以下第一个配置文件）
<ul>
<li>通过<code>--config-file</code>参数指定</li>
<li><code>./clickhouse-client.xml</code></li>
<li><code>~/.clickhouse-client/config.xml</code></li>
<li><code>/etc/clickhouse-server/config.xml</code></li>
</ul>
</li>
</ul>
<h4 id="mysql">
  mysql
  <a class="anchor" href="#mysql">#</a>
</h4>
<ul>
<li>可以通过mysql命令工具连接，需要在配置文件中配置mysql_port：<code>&lt;mysql_port&gt;9004&lt;/mysql_port&gt;</code></li>
<li>使用命令行工具mysql进行连接：<code>mysql --protocol tcp -u default -P 9004</code></li>
</ul>
<h3 id="数据库引擎">
  数据库引擎
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%bc%95%e6%93%8e">#</a>
</h3>
<h4 id="mysql引擎">
  mysql引擎
  <a class="anchor" href="#mysql%e5%bc%95%e6%93%8e">#</a>
</h4>
<ul>
<li>
<p>用于将远程的mysql服务器中的表映射到clickhouse中，并允许对表进行insert和select查询等，但无法执行rename、create table、alter操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> [<span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span>] db_name [<span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">CLUSTER</span> <span style="color:#66d9ef">cluster</span>] ENGINE <span style="color:#f92672">=</span> MYSQL(<span style="color:#e6db74">&#39;host:port&#39;</span>,[<span style="color:#e6db74">&#39;database&#39;</span><span style="color:#f92672">|</span> <span style="color:#66d9ef">database</span>],<span style="color:#e6db74">&#39;user&#39;</span>,<span style="color:#e6db74">&#39;password&#39;</span>)
</span></span></code></pre></div></li>
<li>
<p>
  <a href="https://clickhouse.tech/docs/en/engines/database-engines/mysql/#data_types-support">类型的对应</a>，其他的mysql数据类型全部转化为字符串</p>
</li>
</ul>
<h3 id="表引擎">
  表引擎
  <a class="anchor" href="#%e8%a1%a8%e5%bc%95%e6%93%8e">#</a>
</h3>
<h4 id="merge-tree">
  merge tree
  <a class="anchor" href="#merge-tree">#</a>
</h4>
<ul>
<li>
<p>MergeTree：设计用于插入大量数据当一张表当中。数据可以以数据片段的形式一个接一个的快速写入，数据片段在后台按照一定的规则进行合并。</p>
</li>
<li>
<p>SummingMergeTree：合并SummingMergeTree表的数据片断时，clickhouse会把所有具有<strong>相同主键的行合并为一行</strong>，该行包含了被合并的行中具有数值数据类型的列的汇总值。如果主键的组合方式使得单个键值对应于大量的行，则可以显著的减少存储空间并加快数据查询的速度。</p>
</li>
<li>
<p>ReplacingMergeTree：该引擎会<strong>删除排序键值相同</strong>的重复项。适用于在后台清除重复的数据以节省空间，但不保证没有重复数据出现。在数据合并的时候，如果制定了Replcaing的参数，当参数未指定，则保留最后一条数据，当参数已指定，则保留ver值最大的版本。数据的去重只会在数据的合并期间进行，所以常常今天数据重复了，明天看数据还没有被去重。</p>
</li>
<li>
<p>AggregateMergeTree：改变了数据片段的合并逻辑。clickhouse会将一个数据片段内所有具有相同主键的行替换为一行，这一行会存储一系列聚合函数的状态。可以使用AggregatingMergeTree表来做增量数据的聚合统计，包括物化视图的数据聚合。</p>
</li>
<li>
<p>CollapsingMergeTree：会异步的删除掉所有字段的值都相等（除了列Sign，该列一个为1，一个为-1）的成对的行，下面这两行就会被删除。</p>
<ul>
<li>
<table>
<thead>
<tr>
<th>UserId</th>
<th>PageViews</th>
<th>Duration</th>
<th>Sign</th>
</tr>
</thead>
<tbody>
<tr>
<td>123</td>
<td>5</td>
<td>146</td>
<td>1</td>
</tr>
<tr>
<td>123</td>
<td>5</td>
<td>146</td>
<td>-1</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>1是状态行，-1是状态取消行</p>
</li>
</ul>
</li>
<li>
<p>VersionedCollapsingMergeTree：用于相同目的的折叠树但使用了不同的折叠算法，允许以多个线程的任何顺序插入数据。Version列有助于正确折叠行，即使他们以错误的顺序插入。而CollapsingMergeTree只允许严格的连续插入。</p>
</li>
</ul>
<h5 id="mergetree">
  MergeTree
  <a class="anchor" href="#mergetree">#</a>
</h5>
<ul>
<li>
<p>数据可以以数据片段的形式一个接一个的快速写入，数据片段在后台按照一定的规则进行合并。</p>
</li>
<li>
<p>存储的数据按主键排序；支持数据分区（如果指定分区键的话）；支持数据副本；支持数据采样。</p>
</li>
<li>
<p>建表（
  <a href="https://clickhouse.tech/docs/zh/engines/table-engines/mergetree-family/mergetree/#table_engine-mergetree-creating-a-table">更多介绍看这里</a>）</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> [<span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span>] [db.]<span style="color:#66d9ef">table_name</span> [<span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">CLUSTER</span> <span style="color:#66d9ef">cluster</span>]
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>	name [type1] [<span style="color:#66d9ef">DEFAULT</span><span style="color:#f92672">|</span>MATERIALIZED<span style="color:#f92672">|</span><span style="color:#66d9ef">ALIAS</span> expr1] [TTL expr1],
</span></span><span style="display:flex;"><span>    name [type2] [<span style="color:#66d9ef">DEFAULT</span><span style="color:#f92672">|</span>MATERIALIZED<span style="color:#f92672">|</span><span style="color:#66d9ef">ALIAS</span> expr2] [TTL expr2]
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> index_name1 expr1 <span style="color:#66d9ef">TYPE</span> type1(...) GRANULARITY value1,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span> index_name2 expr2 <span style="color:#66d9ef">TYPE</span> type2(...) GRANULARITY value2
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#f92672">=</span> MergeTree()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> expr
</span></span><span style="display:flex;"><span>[PARTITION <span style="color:#66d9ef">BY</span> expr]
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> expr]
</span></span><span style="display:flex;"><span>[SAMPLE <span style="color:#66d9ef">BY</span> expr]
</span></span><span style="display:flex;"><span>[TTL expr [<span style="color:#66d9ef">DELETE</span><span style="color:#f92672">|</span><span style="color:#66d9ef">TO</span> DISK <span style="color:#e6db74">&#39;xxx&#39;</span><span style="color:#f92672">|</span><span style="color:#66d9ef">to</span> volume <span style="color:#e6db74">&#39;xxx&#39;</span>],...]
</span></span><span style="display:flex;"><span>[SETTINGS name<span style="color:#f92672">=</span>value,..]
</span></span></code></pre></div></li>
<li>
<p>ENGINE：引擎名和参数</p>
</li>
<li>
<p>ORDER BY：排序键，可以是一组列的元组或任意的表达式。<strong>如果没有用PRIMARY KEY显式指定主键，clickhouse会使用排序键作为主键</strong>，如果不需要排序，可以使用ORDER BY tuple()</p>
</li>
<li>
<p>PARTITION BY：分区键，要按月分区，可以使用表达式toYYYYMM(date_column)，这里date_column是一个Date类型的列，分区的格式会是YYYYMM</p>
</li>
<li>
<p>PRIMARY KEY：主键，如果要选择与排序键不同的主键，可选。大部分时间不需要再专门指定一个primary key</p>
</li>
<li>
<p>SIMPLE BY：用于抽样表达式，如果要用抽样表达式，主键中必须包含这个表达式。如<code>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code></p>
</li>
<li>
<p>TTL：可以为表设置，也可以为每个列单独设置</p>
<ul>
<li>表TTL：表可以设置一个用于移除过期行的表达式，当表中的行过期时，clickhouse会删除所有对应的行。clickhouse在数据片段合并的时候会删除掉过期的数据，如果在合并的过程中执行SELECT查询，则可能得到过期的数据。</li>
</ul>
</li>
<li>
<p>SETTINGS：控制MergeTree行为的额外参数</p>
<ul>
<li>index_granularity：索引力度</li>
</ul>
</li>
</ul>
</li>
<li>
<p>数据存储</p>
<ul>
<li>表由按主键排序的数据片段组成。</li>
<li>当数据被插入到表中时，会创建多个数据片段并按主键的字典排序。</li>
<li>不同分区的数据会被分成不同的片段，clickhouse在后台合并数据片段以便更高效存储。合并机制不保证具有相同主键的行全部合并到同一个数据片中。</li>
<li>数据片段以wide或compact格式存储。wide格式下，每一列都会在文件系统中存储为单独的文件，compact模式下所有列都存储在同一个文件下。</li>
<li>每个数据片段被逻辑分割成颗粒。颗粒是进行数据查询时最小的不可分割数据集。每个颗粒都包含整数个行。</li>
</ul>
</li>
<li>
<p>可以使用ORDER BY tuple()创建没有主键的表，这种情况下，clickhouse会根据数据插入的顺序存储。</p>
</li>
<li>
<p>对于select查询，如果where子句中有下面这些表达式，就可以使用索引</p>
<ul>
<li>包含一个与主键/分区键中的部分字段或全部字段相等或不等的表达式。</li>
<li>主键/分区键 in (xxx,xxx,xxx) 或者 主键/分区键 like &lsquo;xxx&rsquo;。</li>
<li>基于主键/分区键的字段上的某些函数。</li>
<li>基于主键/分区键的表达式的逻辑表达式。</li>
</ul>
</li>
<li>
<p>TTL</p>
<ul>
<li>TTL表达式的计算结果必须是日期或日期时间类型的字段</li>
</ul>
</li>
</ul>
<p>
  <a href="https://clickhouse.tech/docs/zh/engines/table-engines/mergetree-family/mergetree/">MergeTree</a>这一块越看越迷惑，之后再来接着看吧。</p>
<h4 id="日志引擎">
  日志引擎
  <a class="anchor" href="#%e6%97%a5%e5%bf%97%e5%bc%95%e6%93%8e">#</a>
</h4>
<ul>
<li>是为了需要写入许多小数据量（少于一百万行）的表的场景而开发的。</li>
</ul>
<h5 id="该引擎的共同属性">
  该引擎的共同属性
  <a class="anchor" href="#%e8%af%a5%e5%bc%95%e6%93%8e%e7%9a%84%e5%85%b1%e5%90%8c%e5%b1%9e%e6%80%a7">#</a>
</h5>
<ol>
<li>写入时将数据追加到文件末尾。</li>
<li>不支持索引。</li>
<li>非原子地写入数据。</li>
</ol>
<ul>
<li>Log和StripeLog支持并行读取数据，Log引擎将表中的每一列使用不同的文件；StripeLog将所有的数据存储到一个文件中</li>
</ul>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Page 9" class="page-link" role="button">9</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 11" class="page-link" role="button">11</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/12/" aria-label="Page 12" class="page-link" role="button">12</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/12/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  


 
      </footer>
    </div>

  </main>

</body>
</html>











