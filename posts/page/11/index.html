<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>主页 | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<link rel="alternate" type="application/rss+xml" href="/posts/index.xml" title="小象的blog" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/tags/bios/">
        BIOS
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>12</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>主页</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/tags/bios/">
        BIOS
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  
<nav>
  <ul>
  
    
	  
	
  
    
	  
		
		  <li>
			<a href="/tags/bios/"  class="flex justify-between">
			  <span>bios</span>
			  <span>12</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%85%B6%E4%BB%96/"  class="flex justify-between">
			  <span>其他</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/c%E8%AF%AD%E8%A8%80/"  class="flex justify-between">
			  <span>c语言</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/linux/"  class="flex justify-between">
			  <span>linux</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"  class="flex justify-between">
			  <span>信息安全</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"  class="flex justify-between">
			  <span>计算机网络</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/java/"  class="flex justify-between">
			  <span>java</span>
			  <span>53</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/nginx/"  class="flex justify-between">
			  <span>nginx</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"  class="flex justify-between">
			  <span>数据库</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E5%89%8D%E7%AB%AF/"  class="flex justify-between">
			  <span>前端</span>
			  <span>4</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/http/"  class="flex justify-between">
			  <span>http</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/python/"  class="flex justify-between">
			  <span>python</span>
			  <span>6</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/git/"  class="flex justify-between">
			  <span>git</span>
			  <span>1</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex justify-between">
			  <span>设计模式</span>
			  <span>10</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"  class="flex justify-between">
			  <span>数据结构</span>
			  <span>7</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"  class="flex justify-between">
			  <span>操作系统</span>
			  <span>5</span>
			</a>
		  </li>
		
		  <li>
			<a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"  class="flex justify-between">
			  <span>计算机组成原理</span>
			  <span>1</span>
			</a>
		  </li>
		
      
	
  
  </ul>
</nav>


    </aside>
  
 
        </header>
        
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%87%BD%E6%95%B0/">clickhouse类型及函数</a>
    </h2>
    
  <h5>2021-03-25</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><h2 id="类型">
  类型
  <a class="anchor" href="#%e7%b1%bb%e5%9e%8b">#</a>
</h2>
<h3 id="decimalps-decimal32s-decimal64s-decimal128s">
  Decimal(P,S), Decimal32(S), Decimal64(S), Decimal128(S)
  <a class="anchor" href="#decimalps-decimal32s-decimal64s-decimal128s">#</a>
</h3>
<ul>
<li>有符号的<strong>定点数</strong>，可在加减乘中保持精度，除法的最低有效数字会被丢弃（不舍入）</li>
</ul>
<h4 id="参数">
  参数
  <a class="anchor" href="#%e5%8f%82%e6%95%b0">#</a>
</h4>
<ul>
<li>P表示精度，有效范围是[1:38]，决定可以有多少个十进制的数字</li>
<li>S表示规模，有效范围是[0:P]，决定数字的小数部分中包含的小数位数</li>
<li>P[1:9]对应Decimal32(S)</li>
<li>P[10:18]对应Decimal64(S)</li>
<li>P[19:38]对应Decimal128(S)</li>
<li>
  <a href="https://clickhouse.tech/docs/zh/single/#decimalp-s-decimal32s-decimal64s-decimal128s">精度</a></li>
</ul>
<h2 id="函数">
  函数
  <a class="anchor" href="#%e5%87%bd%e6%95%b0">#</a>
</h2>
<h3 id="parsedatetimebestefforttime_string-time_zone">
  parseDateTimeBestEffort(time_string[, time_zone])
  <a class="anchor" href="#parsedatetimebestefforttime_string-time_zone">#</a>
</h3>
<ul>
<li>把其他类型的时间日期转换为DateTime数据类型。</li>
<li>支持的格式：<code>timestamp</code> <code>YYYYMMDDHHMMSS </code> <code>DD/MM/YYYY hh:mm:ss </code> <code>YYYY-MM-DD hh:mm:ss</code>等</li>
</ul>
<h3 id="show-create-table">
  SHOW CREATE TABLE
  <a class="anchor" href="#show-create-table">#</a>
</h3>
<ul>
<li>返回创建该表的语句</li>
</ul>
<h3 id="类型转换">
  类型转换
  <a class="anchor" href="#%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2">#</a>
</h3>
<ul>
<li>clickhouse是强类型，他不会在类型之间进行隐式转换。</li>
</ul>
<h3 id="totypenamex">
  toTypeName(x)
  <a class="anchor" href="#totypenamex">#</a>
</h3>
<ul>
<li>返回该参数的类型</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/http/cors/">CORS</a>
    </h2>
    
  <h5>2021-03-24</h5>



  

  
  <div>
    
      <a href="/tags/http/">http</a>
  </div>
  




    <p><ul>
<li>
<p>跨源资源共享（Cross-Origin Resource Sharing），CORS是一种基于HTTP头的机制，该机制通过允许服务器标识除了它自己以外的其他origin（源是协议、主机名和端口号的组合），这样其他origin就可以加载这些资源。</p>
</li>
<li>
<p>XMLHttpRequest和Fetch API遵循同源策略。</p>
</li>
<li>
<p><code>Access-Control-Allow-Origin: *</code>：允许所有origin访问该资源。</p>
</li>
</ul>
<h2 id="同源策略">
  同源策略
  <a class="anchor" href="#%e5%90%8c%e6%ba%90%e7%ad%96%e7%95%a5">#</a>
</h2>
<ul>
<li>同源是指协议相同、主机名相同、端口相同。</li>
<li>非同源会限制Cookie和Ajax。</li>
</ul>
<h2 id="访问控制场景">
  访问控制场景
  <a class="anchor" href="#%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e5%9c%ba%e6%99%af">#</a>
</h2>
<ul>
<li>浏览器将CORS请求分为两类，简单请求和非简单请求。</li>
</ul>
<h3 id="简单请求">
  简单请求
  <a class="anchor" href="#%e7%ae%80%e5%8d%95%e8%af%b7%e6%b1%82">#</a>
</h3>
<ul>
<li>如果请求的HTTP方法是GET、HEAD、POST，并且HTTP头部除了被用户代理自动设置的首部字段外，只有Accept-Language、Content-Language、Content-Type ；并且Content-Type 的值仅限于下列三者之一： text/plain、multipart/form-data、application/x-www-form-urlencoded。那么Web浏览器发出的是简单请求。发出简单请求时，该请求将像一般请求一样发送到服务器。</li>
<li>简单请求不会触发CORS 预检请求。</li>
</ul>
<h3 id="预检请求">
  预检请求
  <a class="anchor" href="#%e9%a2%84%e6%a3%80%e8%af%b7%e6%b1%82">#</a>
</h3>
<ul>
<li>预检请求会先使用<code>OPTION</code>方法发起一个预检请求到服务器，以获知服务器是否允许该实际请求。预检请求的使用可以避免跨域请求对服务器的用户数据产生未预期的影响。当预检不通过，实际的请求将不会发送。</li>
</ul>
<h2 id="http响应首部">
  HTTP响应首部
  <a class="anchor" href="#http%e5%93%8d%e5%ba%94%e9%a6%96%e9%83%a8">#</a>
</h2>
<h3 id="access-control-allow-origin">
  Access-Control-Allow-Origin
  <a class="anchor" href="#access-control-allow-origin">#</a>
</h3>
<pre tabindex="0"><code>Access-Control-Allow-Origin: &lt;origin&gt; | *
</code></pre><ul>
<li>origin参数的值指定了允许访问该资源的外域URL，对不需要携带身份凭证的请求，服务器可以指定该字段的值为通配符，表示允许来自所有域的请求。</li>
<li>如果服务器指定了具体的域名而非&quot;*&quot;，那么响应首部中的Vary字段的值必须包含Origin。这将告诉客户端，服务器对不同的源站返回不同的内容。</li>
</ul>
<h3 id="accsess-control-expose-headers">
  Accsess-Control-Expose-Headers
  <a class="anchor" href="#accsess-control-expose-headers">#</a>
</h3>
<ul>
<li>在跨源访问时，XMLHttpRequest对象的getResponseHeaders方法只能拿到Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，需要服务器设置响应头。</li>
<li>Accsess-Control-Expose-Headers头让服务器把允许浏览器访问的头放入白名单。</li>
</ul>
<pre tabindex="0"><code>Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header
</code></pre><h3 id="access-control-max-age">
  Access-Control-Max-Age
  <a class="anchor" href="#access-control-max-age">#</a>
</h3>
<ul>
<li>指定了预检的请求的结果能被缓存多久，单位是秒。</li>
</ul>
<pre tabindex="0"><code>Access-Control-Max-Age: 3600
</code></pre><h3 id="access-control-allow-credentials">
  Access-Control-Allow-Credentials
  <a class="anchor" href="#access-control-allow-credentials">#</a>
</h3>
<ul>
<li>Access-Control-Allow-Credentials 头指定了当浏览器的 credentials 设置为 true 时是否允许浏览器读取 response 的内容。当用在 预检测请求的响应中时，它指定了实际的请求是否可以使用 credentials。简单 GET 请求不会被预检。</li>
</ul>
<h3 id="access-control-allow-methods">
  Access-Control-Allow-Methods
  <a class="anchor" href="#access-control-allow-methods">#</a>
</h3>
<ul>
<li>Access-Control-Allow-Methods 首部字段用于预检请求的响应。其指明了实际请求所允许使用的 HTTP 方法。</li>
</ul>
<pre tabindex="0"><code>Access-Control-Allow-Methods: &lt;method&gt;[, &lt;method&gt;]*
</code></pre><h3 id="access-control-allow-headers">
  Access-Control-Allow-Headers
  <a class="anchor" href="#access-control-allow-headers">#</a>
</h3>
<ul>
<li>Access-Control-Allow-Headers 首部字段用于预检请求的响应。其指明了实际请求中允许携带的首部字段。</li>
</ul>
<p>参考链接：
  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">跨资源共享（CORS）</a></p>
<p>参考链接：
  <a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">跨域资源共享 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/clickhouse%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/">clickhouse集群配置</a>
    </h2>
    
  <h5>2021-03-17</h5>



  

  
  <div>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
  




    <p><ul>
<li>查看集群<code>select * from system.clusters</code></li>
<li>分片shard是指包含数据不同部分的服务器。要读取所有数据，必须访问所有分片。</li>
<li>副本replica是存储复制数据的服务器，要读取所有数据，访问一个切片上的任意副本上的数据即可。</li>
</ul>
<h2 id="集群部署">
  集群部署
  <a class="anchor" href="#%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2">#</a>
</h2>
<ol>
<li>
<p>在群集的所有机器上安装clickhouse服务端</p>
</li>
<li>
<p>在配置文件中设置群集配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;remote_servers&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;perftest_1shards_1replicas&gt;</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#f92672">&lt;shard&gt;</span>
</span></span><span style="display:flex;"><span>        	<span style="color:#f92672">&lt;replica&gt;</span>
</span></span><span style="display:flex;"><span>            	<span style="color:#f92672">&lt;host&gt;</span>localhost<span style="color:#f92672">&lt;/host&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;port&gt;</span>9000<span style="color:#f92672">&lt;/port&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/replica&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/shard&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/perftest_1shards_1replicas&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/remote_servers&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>在集群上创建本地表</p>
</li>
<li>
<p>在集群上创建分布式表</p>
<ul>
<li>分布式表实际上是一种视图（view），从分布式表中执行select查询会使用集群所有分片的资源。</li>
</ul>
</li>
</ol>
<ul>
<li><code>internal_replication</code>：
<ul>
<li>当参数为true时，写操作只选择一个正常的副本写入数据。如果表是复制表Replicated*Merge，请使用此方案。</li>
<li>当为false时，写操作会将数据写入所有副本。因为不会检查副本一致性，随着时间的推移，副本数据可能不一样。</li>
</ul>
</li>
</ul>
<h2 id="数据副本">
  数据副本
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%89%af%e6%9c%ac">#</a>
</h2>
<ul>
<li>对于INSERT和ALTER语句操作数据时会在压缩的情况下被复制。</li>
<li>CREATE、DROP、ATTACH、DETACH和RENAME语句只会在单个服务器上执行，不会被复制。
<ul>
<li>可复制表的不同副本可以有不同的名称</li>
</ul>
</li>
<li>如果配置文件中没有设置ZooKeeper，则无法创建复制表，并且现在任何现有的复制表都将变为只读。</li>
</ul>
<h3 id="创建复制表">
  创建复制表
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e5%a4%8d%e5%88%b6%e8%a1%a8">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">table_name</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>	EventDate DateTime,
</span></span><span style="display:flex;"><span>    CounterID UInt32,
</span></span><span style="display:flex;"><span>    UserID UInt32,
</span></span><span style="display:flex;"><span>    Ver UInt16
</span></span><span style="display:flex;"><span>)ENGINE <span style="color:#f92672">=</span> ReplicatedReplacingMergeTree(zoo_path, replica_name, other_parameters)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#66d9ef">BY</span> toYYYYMM(EventDate)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> (CounterID, EventDate, intHash32(UserID))
</span></span><span style="display:flex;"><span>SAMPLE <span style="color:#66d9ef">BY</span> intHash32(UserID)
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/django%E8%B5%B7%E6%AD%A5/">django起步</a>
    </h2>
    
  <h5>2021-03-16</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="起步">
  起步
  <a class="anchor" href="#%e8%b5%b7%e6%ad%a5">#</a>
</h2>
<ul>
<li>django项目目录</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>mysite<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>    manage<span style="color:#f92672">.</span>py <span style="color:#75715e">#管理django项目的命令行工具</span>
</span></span><span style="display:flex;"><span>    mysite<span style="color:#f92672">/</span>	<span style="color:#75715e">#python包，名字就是当引用它内部任何东西时需要用到的python包名</span>
</span></span><span style="display:flex;"><span>        __init__<span style="color:#f92672">.</span>py	<span style="color:#75715e">#告诉python这个目录应该被认为是一个python包</span>
</span></span><span style="display:flex;"><span>        settings<span style="color:#f92672">.</span>py	<span style="color:#75715e">#项目的配置文件</span>
</span></span><span style="display:flex;"><span>        urls<span style="color:#f92672">.</span>py <span style="color:#75715e">#url声明</span>
</span></span><span style="display:flex;"><span>        asgi<span style="color:#f92672">.</span>py <span style="color:#75715e">#运行在asgi兼容的web服务器上的入口</span>
</span></span><span style="display:flex;"><span>        wsgi<span style="color:#f92672">.</span>py <span style="color:#75715e">#运行在wsgi兼容的web服务器上的入口</span>
</span></span></code></pre></div><ul>
<li>运行项目的命令<code>python manage.py runserver</code></li>
<li>创建一个应用<code>python manage.py startapp polls</code></li>
<li>应用urls.py中使用到的函数path()有四个参数，两个必须参数route和view，两个可选参数kwargs和name
<ul>
<li>route是一个匹配URL的准则，当响应一个请求时，他会从urlpatterns的第一项开始，按顺序依次匹配列表中的项。这些准则不会匹配get和post参数或域名</li>
<li>view：当找到了一个匹配的准则，就会调用这个特定的视图函数，并传入一个HttpRequest对象作为第一个参数，被捕获的参数以关键字参数的形式传入。</li>
<li>kwages：任意个关键字参数可作为一个字典传递给目标视图函数。</li>
<li>name：为url取名</li>
</ul>
</li>
<li>函数include()允许引用其他URLconfs</li>
</ul>
<h2 id="模型">
  模型
  <a class="anchor" href="#%e6%a8%a1%e5%9e%8b">#</a>
</h2>
<h3 id="设置mysitesittingspy">
  设置mysite/sittings.py
  <a class="anchor" href="#%e8%ae%be%e7%bd%aemysitesittingspy">#</a>
</h3>
<ul>
<li>设置时区<code>TIME_ZONE = 'Asia/Shanghai' USE_TZ = True</code>
<ul>
<li>当启用了时区支持（即<code>USE_TZ = True</code>），Django将在数据库中以UTC存储日期信息，而在模板和表单中转化为最终用户的时区</li>
</ul>
</li>
<li>设置数据库</li>
<li><code>INSTALLED_APPS</code>是在项目中启用的Django应用，这里面的某些应用需要数据表，可以用<code>python manage.py migrate</code>生成</li>
</ul>
<h3 id="创建模型">
  创建模型
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e6%a8%a1%e5%9e%8b">#</a>
</h3>
<ul>
<li>模型设真实数据的描述，它包含了存储的数据所必要的字段和行为。</li>
<li>Django的迁移代码是从模型文件中自动生成的</li>
<li>每个模型都是<code>django.db.models.Model</code>类的子类，每个模型有许多的类变量，他们都表示一个数据库的字段，每个字段都是Field类的实例，每个Field类实例变量的名字也是数据库的列名。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#polls/models.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Choice</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    question <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Question, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    choice_text <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>    votes <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(default<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><h3 id="激活和修改模型">
  激活和修改模型
  <a class="anchor" href="#%e6%bf%80%e6%b4%bb%e5%92%8c%e4%bf%ae%e6%94%b9%e6%a8%a1%e5%9e%8b">#</a>
</h3>
<ul>
<li>首先把应用安装到项目中，在<code>INSTALLED_APPS</code>中添加<code>polls.apps.PollsConfig</code></li>
<li>执行<code>python manage.py makemigrations polls</code></li>
<li>迁移数据存放在应用的<code>migrations/0001_initial.py</code>中，可以通过<code>python manage.py sqlmigrate polls 0001</code>来查看对应的sql</li>
<li>运行<code>python manage.py migtate</code>来应用数据库迁移</li>
<li>通过<code>python manage.py shell</code>可进入当前项目对应的命令行</li>
<li>给模型增加<code>__str__</code>方法能带来一些方便</li>
</ul>
<h2 id="django管理页面">
  Django管理页面
  <a class="anchor" href="#django%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2">#</a>
</h2>
<ul>
<li>首先创建一个能登陆管理界面的用户<code>python manage.py createsuperuser</code></li>
<li>将创建的models注册，以便后台可以管理</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#polls/admin.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Question
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Question)
</span></span></code></pre></div><ul>
<li>运行项目<code>python manage.py runserver</code></li>
</ul>
<h2 id="视图view">
  视图view
  <a class="anchor" href="#%e8%a7%86%e5%9b%beview">#</a>
</h2>
<ul>
<li>向应用的views.py中添加视图函数，这些函数的第一个参数是request，也以有第二、第三个参数。每个视图必须做的只有返回一个包含请求页面内容的HttpResponse对象或者抛出一个异常</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">detail</span>(request, question_id):
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;question_id&#39;</span>: question_id,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#template = loader.get_template(&#39;xxx/xxxx.html&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#return HttpResponse(template.render(context, request))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;xxx/xxxx.html&#39;</span>, context)
</span></span></code></pre></div><ul>
<li>
<p>当使用模型的get函数获取对象，如果不存在，可以抛出Http404错误，Django提供了一个快捷函数<code>get_object_or_404</code>，</p>
</li>
<li>
<p>将这些视图添加加到应用的urls.py中</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#为url名称添加命名空间</span>
</span></span><span style="display:flex;"><span>app_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;polls&#39;</span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#int:是一个转换器，决定了应该以什么变量类型匹配这部分url路径</span>
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#39;&lt;int:question_id&gt;/detail/&#39;</span>, views<span style="color:#f92672">.</span>detail, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;detail&#39;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><ul>
<li>当其他人访问网站的某个页面时，比如&rsquo;polls/34/detail&rsquo;，django将会载入项目的urls.py模块，因为这在<strong>ROOT_URLCONF</strong>中配置了，然后django寻找名为urlpatterns变量并按顺序匹配正则表达式，在找到匹配项&rsquo;polls/&rsquo;，它切掉了匹配的文本&rsquo;polls/&rsquo;，将剩余文本'34/detail&rsquo;发送至&rsquo;polls.urls&rsquo;中做进一步处理</li>
</ul>
<h3 id="模板">
  模板
  <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">#</a>
</h3>
<ul>
<li>在应用路径下创建templates目录，项目的<strong>TEMPLATES</strong>配置项描述了django如何载入和渲染模板，默认将<strong>APP_DIRS</strong>设置为True，这一选项让DjangoTemplates能在每个INSTALLED_APPS文件夹中寻找templates子目录。</li>
<li>由于django能直接访问到templates文件夹，为了放置出现模板文件名冲突，最好的方法就是将它们放到一个与自身应用重名的子文件夹里</li>
<li>指向具有命名空间的视图</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;polls:detail&#39; question.id %}&#34;</span>&gt;{{ context.question_id }}&lt;/<span style="color:#f92672">a</span>&gt;
</span></span></code></pre></div><ul>
<li>无论何时，当需要创建一个改变服务器端数据的表单时，请使用post。</li>
<li>django自带了一个非常有用的防御系统，所有针对内部url的post表单都应该使用<code>{% csrf_token %}</code>模板标签。</li>
<li>request.POST是一个字典类型对象，可以通过关键字来获取提交的数据，获取的值永远是字符串。如果key提供错误，将会抛出一个KeyError。</li>
<li>函数reverse()能避免在视图函数中硬编码url，他需要我们给出想要跳转的视图的名字和该视图所对应的url模式中需要给该视图提供的参数。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">python正则表达式</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><ul>
<li><code>\d</code>匹配一个数字</li>
<li><code>\w</code>匹配一个数字或字母</li>
<li><code>.</code>匹配任意字符</li>
<li><code>*</code>匹配0到多个字符，<code>+</code>匹配1到多个字符，<code>?</code>匹配0或1个字符，<code>{n}</code>表示n个字符，<code>{n,m}</code>表示n-m个字符</li>
<li><code>\s</code>匹配一个空格（也包括tab）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>\d{<span style="color:#ae81ff">3</span>}\s<span style="color:#f92672">+</span>\d<span style="color:#f92672">*</span>	<span style="color:#75715e">#匹配3个数字，后面至少有一个空格，再后面有可能有数字，有可能没数字</span>
</span></span></code></pre></div><ul>
<li><code>[]</code>可用于更精确的匹配</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>a<span style="color:#f92672">-</span>z\_] <span style="color:#75715e">#匹配一个数字或一个小写字母或一个下划线</span>
</span></span></code></pre></div><ul>
<li><code>A|B</code>可匹配A或B</li>
<li><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头</li>
<li><code>$</code>表示行的结束，<code>$\d</code>表示必须以数字结束</li>
</ul>
<h2 id="re模块">
  re模块
  <a class="anchor" href="#re%e6%a8%a1%e5%9d%97">#</a>
</h2>
<ul>
<li>因为python字符串本身也用<code>\</code>转义，可以使用<code>r</code>前缀，就可以不用考虑字符串转义了。<code>r'ABC\-001'</code></li>
<li><code>re.match(r'\d{3}\-\d$'),'010-1')</code>，如果匹配成功就返回一个Mache对象，否则返回none。</li>
<li><code>re.split(r'[\s\,]+','a,b, c  d')</code>，切割字符串，能切割出<code>['a','b','c']</code></li>
<li>正则表达式还有提取字串的功能，用<code>()</code>表示的就是要提取的分组。<code>r'(\d{3})-(\d{3,8})'</code>就定义了两个组，可以使用<code>group(n)</code>方法提取出子串</li>
</ul>
<h2 id="贪婪匹配">
  贪婪匹配
  <a class="anchor" href="#%e8%b4%aa%e5%a9%aa%e5%8c%b9%e9%85%8d">#</a>
</h2>
<ul>
<li>正则默认的时贪婪匹配，加个<code>?</code>就可以采用非贪婪匹配。<code>\d+?</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>r <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">&#39;(\d+?)(0*)$&#39;</span>,<span style="color:#e6db74">&#39;1200000&#39;</span>)
</span></span><span style="display:flex;"><span>print(r<span style="color:#f92672">.</span>groups())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果(&#39;12&#39;, &#39;00000&#39;)</span>
</span></span></code></pre></div>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E6%A8%A1%E5%9D%97/">python模块</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="datetime">
  datetime
  <a class="anchor" href="#datetime">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime,timedelta
</span></span></code></pre></div><ul>
<li>获取当前时间<code>datetime.now()</code></li>
<li>指定的某个日期和时间<code>datetime(2021,3,15,19,48)</code></li>
<li>将datetime类型转化为timestamp，（timestamp是一个浮点数，整数位表示秒） <code>datetime(2021,3,15,19,49).timestamp()</code></li>
<li>timestamp转化为datetime <code>datetime.fromtimestamp(1615809156.889315)</code></li>
<li>str转换为datetime <code>datetime.strptime('2021-3-15 19:55:59','%Y-%m-%d %H:%M:%S')</code></li>
<li>datetime转str <code>datetime.now().strftime('%a,%b %d %H:%M')</code></li>
<li>datetime加减 <code>datetime.now() + timedelta(days = 1, hours = 10)</code></li>
<li>时区转换</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>utc_dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>utc_dt<span style="color:#f92672">.</span>astimezone(timezone(timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)))
</span></span></code></pre></div><h2 id="collections">
  collections
  <a class="anchor" href="#collections">#</a>
</h2>
<ul>
<li>namedtuple：是一个函数，可以用来创建一个自定义的tuple对象，同时规定了tuple元素的个数，并可以用属性而不是索引来引用tuple的某个元素。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> namedtuple
</span></span><span style="display:flex;"><span>Point <span style="color:#f92672">=</span> nametuple(<span style="color:#e6db74">&#39;Point&#39;</span>,[<span style="color:#e6db74">&#39;x&#39;</span>, <span style="color:#e6db74">&#39;y&#39;</span>])
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> Point(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><ul>
<li>deque：双向列表，方法有<code>append()、pop()、appendleft()、popleft()</code></li>
<li>defaultdict：和dict类似，但是在key不存在的时候返回一个默认值。</li>
<li>OrderedDict：key会按照插入的顺序排序</li>
<li>ChainMap：可以把一组dict串起来组成一个逻辑上的dict，本身也是一个dict，但在查找的时候，会按照顺序在内部的dict依次查找。</li>
<li>Counter是一个计数器，可以统计字符出现的个数，实际上也是dict的子类</li>
</ul>
<h2 id="base64">
  base64
  <a class="anchor" href="#base64">#</a>
</h2>
<ul>
<li>base64是一种用64个字符表示任意二进制数据的方法，64个字符指的是<code>A-Z, a-z, 0-9, +, /</code>。实现方法是将3个字节(3x8bit)的二进制数据编码为4字节(4x6bit，6bit的数据刚好能用上面这64个字符表示)的数据。6bit的数据刚好能用这64个字符表示。</li>
<li>编码<code>base64.b64encode(b'binary')</code>；解码<code>base64.b64decode(b'binary')</code></li>
</ul>
<h2 id="hashlib">
  hashlib
  <a class="anchor" href="#hashlib">#</a>
</h2>
<ul>
<li>摘要算法又称为哈希算法，散列算法，它通过一个函数，把任意长度的数据转化为一个固定长度的数据串。它是一个单向函数，对原始数据做一点点的修改都会导致计算出的摘要完全不同。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>md5 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#也可以将串分开，多次调用update方法</span>
</span></span><span style="display:flex;"><span>md5<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;xiaoxiang.space&#34;</span><span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#md5结果是128bit，通常用32位的16进制表示</span>
</span></span><span style="display:flex;"><span>print(md5<span style="color:#f92672">.</span>hexdigest())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sha1 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1()
</span></span><span style="display:flex;"><span>sha1<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;xiaoxiang.space&#34;</span><span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sha1的结果是160bit，通常用一个40位的16进制字符串表示</span>
</span></span><span style="display:flex;"><span>print(sha1<span style="color:#f92672">.</span>hexdigest())
</span></span></code></pre></div><h2 id="itertools">
  itertools
  <a class="anchor" href="#itertools">#</a>
</h2>
<ul>
<li>无限迭代器<code>itertools.count()</code></li>
<li>cycle()会把传入的一个序列无限重复下去<code>itertools.cycle('ABC')</code></li>
<li>repeat()可以把一个元素无限重复下去，提供了第二个参数可以限定重复次数<code>itertools.repeat('A', 3)</code></li>
<li>可通过takewhile()根据函数条件来截取一个有限的序列。</li>
<li>chain()可以把一组迭代对象串联起来，形成一个更大的迭代器。<code>itertools.chain('ABC', 'XYZ')</code></li>
<li>groupby()可以把迭代器中相邻的重复元素挑出来放在一起。挑选规则是通过函数完成的，只要作用于函数的两个元素返回的值相等，这两个元素就被认为是一组的，函数的返回值作为组的key。</li>
</ul>
<h2 id="contextlib">
  contextlib
  <a class="anchor" href="#contextlib">#</a>
</h2>
<ul>
<li>任何对象，只要正确实现了上下文管理，就可以用于with语句。实现上下文管理是通过<code>__enter__</code>和<code>__exit__</code>这两个方法实现的。可以通过contextlib标准库中的<code>@contextmanager</code>来实现上下文管理（更简单）</li>
<li>有时候，我们希望在某段代码执行前后自动执行特定代码，也可以通过@contextmanager实现</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> contextlib
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@contextlib.contextmanager</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tag</span>(name):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;&lt;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&gt;&#34;</span><span style="color:#f92672">%</span>name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;&lt;/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&gt;&#34;</span><span style="color:#f92672">%</span>name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> tag(<span style="color:#e6db74">&#34;h1&#34;</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;world&#34;</span>)
</span></span></code></pre></div><ul>
<li>如果一个对象没有实现上下文，就不能把他用于with语句，可以用closing()来将该对象变成上下文。</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E5%BC%82%E5%B8%B8%E5%92%8CIO/">python异常-IO-进程等</a>
    </h2>
    
  <h5>2021-03-15</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><h2 id="错误">
  错误
  <a class="anchor" href="#%e9%94%99%e8%af%af">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">/</span> int(<span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ValueError&#34;</span>,e)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ZeroDivisionError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ZeroDivisionError&#34;</span>,e)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#raise如果不带参数，就会把当前错误原样抛出</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;END&#34;</span>)
</span></span></code></pre></div><p>单元测试要用到了再回来补充：
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017604210683936">单元测试</a></p>
<h2 id="io">
  IO
  <a class="anchor" href="#io">#</a>
</h2>
<ul>
<li>
<p>以读的方式打开一个文件对象<code>f = open('test.txt','r')</code></p>
</li>
<li>
<p>文件使用完毕后必须关闭，因为文件对象会占用操作系统的资源。可以使用<code>with open('test.txt','r') as f:</code>，这种形式会自动帮我们调用close()方法。</p>
</li>
<li>
<p>读取二进制文件<code>open('test','rb')</code>，读取非UTF-8编码的文件<code>open('gbk.txt', 'r', encoding = 'gbk')</code>，遇到编码错误后忽略<code>open('test', 'r', encoding = 'gbk', errors = 'ignore')</code>。</p>
</li>
<li>
<p>写文件就是将<code>r</code>参数改为<code>w</code>参数，当在写文件时，操作系统往往不会立刻把数据写入磁盘，而是先缓存起来，只有调用close方法时才会保证把没有写入的数据全部写入磁盘。</p>
</li>
<li>
<p>StringIO和BytesIO是在内存中读写数据。</p>
</li>
<li>
<p>
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017624706151424">序列化</a></p>
</li>
</ul>
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/posts/python/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">python面向对象</a>
    </h2>
    
  <h5>2021-03-14</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  




    <p><ul>
<li>python中所有数据类型都可视为对象。</li>
<li>所有的类都会继承object类。</li>
<li>类中定义函数的第一个参数是self，调用时不用传递该参数。</li>
<li>属性前面加<code>__</code>（两个下划线）就变成了一个私有属性。双下划线开头，双下划线结尾的是特殊变量，特殊变量是可以直接访问的，不是private变量。一个下划线开头的变量名是可以被外部访问的，但是按约定俗称的规定，请把它视为私有变量。</li>
<li>双下划线开头的属性不能被外部访问是因为这个属性被改名字了。</li>
<li>判断一个变量是否是某个类型可以用isinstance()判断，判断对象类型可以使用type方法。</li>
<li>使用dir()可获得对象的所有属性和方法。</li>
<li>自己写的类如果也想用len()方法的话，可以自己写一个<code>__len__</code>方法。实际上，当我们使用len()方法的时候，它会自动去调用该对象的<code>__len__()</code>方法。</li>
<li><code>__str__</code>相当于java中的<code>toString</code>，还有一个<code>__repr__</code>是返回开发者看到的字符串。</li>
<li><code>__getitem__</code>可按下标访问数据的项。</li>
<li>任何类只要定义一个<code>__call__</code>方法，就可以对实例进行调用。</li>
</ul>
<h2 id="类的定义">
  类的定义
  <a class="anchor" href="#%e7%b1%bb%e7%9a%84%e5%ae%9a%e4%b9%89">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>(object):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#类属性</span>
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Student&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, name):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#实例属性</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span><span style="color:#75715e">#编写程序不要对实例属性和类属性使用相同的名字，因为相同名称的实例属性将屏蔽掉类属性        </span>
</span></span></code></pre></div><h2 id="动态绑定">
  动态绑定
  <a class="anchor" href="#%e5%8a%a8%e6%80%81%e7%bb%91%e5%ae%9a">#</a>
</h2>
<ul>
<li>当创建了一个对象后，我们可以给该对象绑定任何属性和方法，但是该属性和方法只在当前对象上有效。为了给所有实例都绑定方法，可以给class绑定方法。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>(object):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#可以用来限制class实例能添加的属性，仅对当前类实例起作用，对继承的子类不起作用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#除非在子类中也定义__slots__，这样子类实例允许定义的属性就是自身的__slots__加上父类的__slots__</span>
</span></span><span style="display:flex;"><span>    __slots__ <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;age&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_age</span>(self, age)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> age
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Student()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给对象动态绑定了一个属性</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;xiaoxiang&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给对象动态绑定一个方法，只在该对象上有效</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>set_age <span style="color:#f92672">=</span> MethodType(set_age, s)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#给类动态绑定一个方法</span>
</span></span><span style="display:flex;"><span>Student<span style="color:#f92672">.</span>set_age <span style="color:#f92672">=</span> set_age
</span></span></code></pre></div><h2 id="getter和setter">
  getter和setter
  <a class="anchor" href="#getter%e5%92%8csetter">#</a>
</h2>
<ul>
<li>使用@property代替getter，以及创建setter的方法见下面的代码</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@name.setter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self, name):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>student <span style="color:#f92672">=</span> Student()
</span></span><span style="display:flex;"><span>student<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;xiaoxiang&#39;</span>
</span></span><span style="display:flex;"><span>print(student<span style="color:#f92672">.</span>name)
</span></span></code></pre></div><h2 id="__iter__和__next__">
  <code>__iter__</code>和<code>__next__</code>
  <a class="anchor" href="#__iter__%e5%92%8c__next__">#</a>
</h2>
<ul>
<li>如果一个类想被用于for-in，就必须实现<code>__iter__</code>和<code>__next__</code>方法</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fib</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __iter__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#实例自身就是迭代对象</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __next__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a, self<span style="color:#f92672">.</span>b <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>b, self<span style="color:#f92672">.</span>b <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">StopIteration</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#返回下一个值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> Fib():
</span></span><span style="display:flex;"><span>    print(i)
</span></span></code></pre></div><h2 id="__getattr__">
  <code>__getattr__</code>
  <a class="anchor" href="#__getattr__">#</a>
</h2>
<ul>
<li><code>__getattr__</code>用于动态返回一个属性，只在没有找到属性的情况下才会调用该方法。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Url</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, item <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>item <span style="color:#f92672">=</span> item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __getattr__(self, item):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Url(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(self<span style="color:#f92672">.</span>item, item))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    __repr__ <span style="color:#f92672">=</span> __str__
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(Url()<span style="color:#f92672">.</span>xiaoxiang<span style="color:#f92672">.</span>ayu<span style="color:#f92672">.</span>liuchan<span style="color:#f92672">.</span>list)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#结果：/xiaoxiang/ayu/liuchan/list</span>
</span></span></code></pre></div><h2 id="枚举">
  枚举
  <a class="anchor" href="#%e6%9e%9a%e4%b8%be">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum, unique
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#该注解用于保证没有重复值</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@unique</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Weekday</span>(Enum):
</span></span><span style="display:flex;"><span>    Sun <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Sun的value被设定为0</span>
</span></span><span style="display:flex;"><span>    Mon <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    Tue <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    Wed <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    Thu <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    Fri <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    Sat <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span></code></pre></div><h2 id="type和metaclass">
  type和metaclass
  <a class="anchor" href="#type%e5%92%8cmetaclass">#</a>
</h2>
<ul>
<li>class（类）的类型就是type，对象的类型就是类名</li>
<li>可以通过type()函数依次传入3个参数来创建一个class对象：①class的名称；②继承的父类集合；③class的方法名称与函数绑定。<code>type('hello', (object, ), dict(hello = 'hello world'))</code></li>
<li>通过type()函数创建的类和直接写class是完全一样的，因为python解释器遇到class定义时，仅仅是扫描一下class定义的语法，然后调用type()函数创建出class。</li>
<li>可以把类看作是metaclass（元类）创建出来的实例。</li>
<li>metaclass后面用到了再来看吧，链接在这-&gt;
  <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">metaclass</a></li>
</ul>
    </p>
  </article>
  

  
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/9/" aria-label="Page 9" class="page-link" role="button">9</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 11" class="page-link" role="button">11</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/12/" aria-label="Page 12" class="page-link" role="button">12</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/12/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/19/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
 
	    </div>

      <footer class="page-footer">
        
  


 
      </footer>
    </div>

  </main>

</body>
</html>











