<!DOCTYPE html>
<html dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark">

<title>gradle | 小象的blog</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e24d94cf619e7e6705439036ee43e77f243d24ac89100b59375379bc4d659d87.css" >
  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">

    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>小象的blog</span>
  </a>
</h2>


















  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


  <div class="split-line"></div>
  
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li></li>
          </ul>
        </li>
        <li><a href="#构建">构建</a>
          <ul>
            <li><a href="#tasks">tasks</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>

    <div class="book-page">
      <div>
	      <header class="book-header">
          
  <div class="flex align-center justify-between">
   <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
  
  <strong>gradle</strong>
</div>


  
    <aside class="hidden clearfix">
      <nav>
        




        








        

  
<ul>
  
  <li>
    <a href="/posts/">
        主页
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/linux%E5%91%BD%E4%BB%A4/">
        linux命令总结
      </a>
  </li>
  
  <li>
    <a href="/posts/linux/shell%E8%84%9A%E6%9C%AC/">
        shell脚本
      </a>
  </li>
  
  <li>
    <a href="/categories/book/">
        书籍笔记
      </a>
  </li>
  
  <li>
    <a href="/about/">
        关于
      </a>
  </li>
  
</ul>





      </nav>
      <div class="split-line"></div>
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li></li>
          </ul>
        </li>
        <li><a href="#构建">构建</a>
          <ul>
            <li><a href="#tasks">tasks</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
        </header>
        
<article class="markdown">
  <h1>
    <a href="/posts/javaee/gradle/">gradle</a>
  </h1>
  
  <h5>2021-08-30</h5>



  

  
  <div>
    
      <a href="/tags/java/">java</a>
  </div>
  



<h5 id="settingsgradle">
  <code>settings.gradle</code>
  <a class="anchor" href="#settingsgradle">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>rootProject<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;demo&#39;</span>
</span></span><span style="display:flex;"><span>include<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;app&#39;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><ul>
<li>rootProject指定了构建的名称，默认以上级目录命名。</li>
<li>include(&rsquo;&hellip;&rsquo;)定义了一个叫app的子项目，子项目包含自己的代码和构建逻辑。</li>
</ul>
<h5 id="gradleproperties">
  <code>gradle.properties</code>
  <a class="anchor" href="#gradleproperties">#</a>
</h5>
<p>最终的配置组合了所有的命令行提供的属性和gradle.properties文件。</p>
<h6 id="配置优先级">
  配置优先级：
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e4%bc%98%e5%85%88%e7%ba%a7">#</a>
</h6>
<ol>
<li>命令行使用-P/&ndash;project-prop传递的参数；</li>
<li>GRADLE_USER_HOME目录的gradle.properties;</li>
<li>项目根目录的gradle.properties;</li>
<li>gradle安装目录的gradle.properties.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e">#指定构建时jvm参数。</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.jvmargs</span><span style="color:#f92672">=</span><span style="color:#e6db74">-Xms2g</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#并行编译，会使用org.gradle.workers.max参数</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.parallel</span><span style="color:#f92672">=</span><span style="color:#e6db74">(true,false)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#默认为CPU的数量</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">org.gradle.workers.max</span><span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#使用systemProp.前缀可在gradle.properties中配置系统属性，或者命令行中使用-D（不加systemProp，有多个project时，只有根路径下的以systemProp开头的属性会被使用，其他的都会被忽略。</span>
</span></span></code></pre></div><p><strong>参考链接：</strong>
  <a href="https://docs.gradle.org/current/userguide/build_environment.html">Build Environment (gradle.org)</a></p>
<h2 id="构建">
  构建
  <a class="anchor" href="#%e6%9e%84%e5%bb%ba">#</a>
</h2>
<h3 id="tasks">
  tasks
  <a class="anchor" href="#tasks">#</a>
</h3>
<ul>
<li>每个gradle build由多个projects组成，一个project又由多个tasks组成。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;upper&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String someString <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mY_nAmE&#39;</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#34;Original: $someString&#34;</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#34;Upper case: ${someString.toUpperCase()}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    dependsOn tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">upper</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#39;hello world&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#执行</span>gradle <span style="color:#f92672">-</span>q hello<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#f92672">-</span>q<span style="color:#960050;background-color:#1e0010">表示抑制日志消息</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Earth&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doFirst <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Venus&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Mars&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">named</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Hello Jupiter&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#执行</span>gradle <span style="color:#f92672">-</span>q hello
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>doFirst<span style="color:#960050;background-color:#1e0010">和</span>doLast<span style="color:#960050;background-color:#1e0010">可以被执行多次，他们被添加到</span>task<span style="color:#960050;background-color:#1e0010">的</span>actions list<span style="color:#960050;background-color:#1e0010">的开始或结束位置，当</span>task<span style="color:#960050;background-color:#1e0010">执行时，在</span>action list<span style="color:#960050;background-color:#1e0010">中的</span>action<span style="color:#960050;background-color:#1e0010">会被按顺序执行。</span>
</span></span></code></pre></div><h4 id="默认task">
  默认task
  <a class="anchor" href="#%e9%bb%98%e8%ae%a4task">#</a>
</h4>
<ul>
<li>gradle允许定义多个默认的task</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>defaultTasks <span style="color:#e6db74">&#39;clean&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;run&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;clean&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Default Cleaning!&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;run&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#e6db74">&#39;Default Running!&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#通过</span>gradle <span style="color:#f92672">-</span>q<span style="color:#960050;background-color:#1e0010">执行</span>
</span></span></code></pre></div><h4 id="为构建脚本添加外部依赖">
  为构建脚本添加外部依赖
  <a class="anchor" href="#%e4%b8%ba%e6%9e%84%e5%bb%ba%e8%84%9a%e6%9c%ac%e6%b7%bb%e5%8a%a0%e5%a4%96%e9%83%a8%e4%be%9d%e8%b5%96">#</a>
</h4>
<ul>
<li>如果构建脚本需要使用外部的库，可以使用buildscript，buildscript中添加的依赖只对构建脚本有效。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#75715e">//使用库中的某个类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">import</span> org.apache.commons.codec.binary.Base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>buildscript <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    repositories <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        mavenCentral<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//将库添加到classpath路径下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classpath group: <span style="color:#e6db74">&#39;commons-codec&#39;</span><span style="color:#f92672">,</span> name: <span style="color:#e6db74">&#39;commons-codec&#39;</span><span style="color:#f92672">,</span> version: <span style="color:#e6db74">&#39;1.2&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tasks<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;encode&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    doLast <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> encodedString <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Base64<span style="color:#f92672">().</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hello world\n&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        println <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">String</span><span style="color:#f92672">(</span>encodedString<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>gradle <span style="color:#f92672">-</span>q encode
</span></span></code></pre></div></article>
 
	    </div>

      <footer class="page-footer">
        
  
<a href="https://beian.miit.gov.cn" target="_blank" style="color:gray;"></a>

 
      </footer>
    </div>

  </main>

</body>
</html>











